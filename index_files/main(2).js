var redhelper;!function(){if("undefined"==typeof redhelper){redhelper={};var requirejs,require,define;!function(global){function isFunction(a){return"[object Function]"===ostring.call(a)}function isArray(a){return"[object Array]"===ostring.call(a)}function each(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}}function hasProp(a,b){return hasOwn.call(a,b)}function getOwn(a,b){return hasProp(a,b)&&a[b]}function eachProp(a,b){var c;for(c in a)if(hasProp(a,c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){(c||!hasProp(a,e))&&(!d||"object"!=typeof b||!b||isArray(b)||isFunction(b)||b instanceof RegExp?a[e]=b:(a[e]||(a[e]={}),mixin(a[e],b,c,d)))}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(a){throw a}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function b(a){var b,c;for(b=0;b<a.length;b++)if(c=a[b],"."===c)a.splice(b,1),b-=1;else if(".."===c){if(0===b||1==b&&".."===a[2]||".."===a[b-1])continue;b>0&&(a.splice(b-1,2),b-=2)}}function c(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q=c&&c.split("/"),r=x.map,s=r&&r["*"];if(a&&(a=a.split("/"),k=a.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(a[k])&&(a[k]=a[k].replace(jsSuffixRegExp,"")),"."===a[0].charAt(0)&&q&&(p=q.slice(0,q.length-1),a=p.concat(a)),b(a),a=a.join("/")),d&&r&&(q||s)){g=a.split("/");a:for(h=g.length;h>0;h-=1){if(j=g.slice(0,h).join("/"),q)for(i=q.length;i>0;i-=1)if(f=getOwn(r,q.slice(0,i).join("/")),f&&(f=getOwn(f,j))){l=f,m=h;break a}!n&&s&&getOwn(s,j)&&(n=getOwn(s,j),o=h)}!l&&n&&(l=n,m=o),l&&(g.splice(0,m,l),a=g.join("/"))}return e=getOwn(x.pkgs,a),e?e:a}function d(a){isBrowser&&each(scripts(),function(b){return b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===u.contextName?(b.parentNode.removeChild(b),!0):void 0})}function e(a){var b=getOwn(x.paths,a);return b&&isArray(b)&&b.length>1?(b.shift(),u.require.undef(a),u.makeRequire(null,{skipMap:!0})([a]),!0):void 0}function f(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function g(a,b,d,e){var g,h,i,j,k=null,l=b?b.name:null,m=a,n=!0,o="";return a||(n=!1,a="_@r"+(F+=1)),j=f(a),k=j[0],a=j[1],k&&(k=c(k,l,e),h=getOwn(C,k)),a&&(k?o=h&&h.normalize?h.normalize(a,function(a){return c(a,l,e)}):-1===a.indexOf("!")?c(a,l,e):a:(o=c(a,l,e),j=f(o),k=j[0],o=j[1],d=!0,g=u.nameToUrl(o))),i=!k||h||d?"":"_unnormalized"+(G+=1),{prefix:k,name:o,parentMap:b,unnormalized:!!i,url:g,originalName:m,isDefine:n,id:(k?k+"!"+o:o)+i}}function h(a){var b=a.id,c=getOwn(y,b);return c||(c=y[b]=new u.Module(a)),c}function i(a,b,c){var d=a.id,e=getOwn(y,d);!hasProp(C,d)||e&&!e.defineEmitComplete?(e=h(a),e.error&&"error"===b?c(e.error):e.on(b,c)):"defined"===b&&c(C[d])}function j(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=getOwn(y,b);c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function k(){globalDefQueue.length&&(apsp.apply(B,[B.length,0].concat(globalDefQueue)),globalDefQueue=[])}function l(a){delete y[a],delete z[a]}function m(a,b,c){var d=a.map.id;a.error?a.emit("error",a.error):(b[d]=!0,each(a.depMaps,function(d,e){var f=d.id,g=getOwn(y,f);!g||a.depMatched[e]||c[f]||(getOwn(b,f)?(a.defineDep(e,C[f]),a.check()):m(g,b,c))}),c[d]=!0)}function n(){var a,b,c=1e3*x.waitSeconds,f=c&&u.startTime+c<(new Date).getTime(),g=[],h=[],i=!1,k=!0;if(!s){if(s=!0,eachProp(z,function(a){var c=a.map,j=c.id;if(a.enabled&&(c.isDefine||h.push(a),!a.error))if(!a.inited&&f)e(j)?(b=!0,i=!0):(g.push(j),d(j));else if(!a.inited&&a.fetched&&c.isDefine&&(i=!0,!c.prefix))return k=!1}),f&&g.length)return a=makeError("timeout","Load timeout for modules: "+g,null,g),a.contextName=u.contextName,j(a);k&&each(h,function(a){m(a,{},{})}),f&&!b||!i||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,n()},50)),s=!1}}function o(a){hasProp(C,a[0])||h(g(a[0],null,!0)).init(a[1],a[2])}function p(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function q(a){var b=a.currentTarget||a.srcElement;return p(b,u.onScriptLoad,"load","onreadystatechange"),p(b,u.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}function r(){var a;for(k();B.length;){if(a=B.shift(),null===a[0])return j(makeError("mismatch","Mismatched anonymous redhelper.define() module: "+a[a.length-1]));o(a)}}var s,t,u,v,w,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},y={},z={},A={},B=[],C={},D={},E={},F=1,G=1;return v={require:function(a){return a.require?a.require:a.require=u.makeRequire(a.map)},exports:function(a){return a.usingExports=!0,a.map.isDefine?a.exports?C[a.map.id]=a.exports:a.exports=C[a.map.id]={}:void 0},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return getOwn(x.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}},t=function(a){this.events=getOwn(A,a.id)||{},this.map=a,this.shim=getOwn(x.shim,a.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},t.prototype={init:function(a,b,c,d){d=d||{},this.inited||(this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check())},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0,u.startTime=(new Date).getTime();var a=this.map;return this.shim?void u.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()})):a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;D[a]||(D[a]=!0,u.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id,d=this.depExports,e=this.exports,f=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(f)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{e=u.execCb(c,f,d,e)}catch(g){a=g}else e=u.execCb(c,f,d,e);if(this.map.isDefine&&void 0===e&&(b=this.module,b?e=b.exports:this.usingExports&&(e=this.exports)),a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",j(this.error=a)}else e=f;this.exports=e,this.map.isDefine&&!this.ignore&&(C[c]=e,req.onResourceLoad&&req.onResourceLoad(u,this.map,this.depMaps)),l(c),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=g(a.prefix);this.depMaps.push(d),i(d,"defined",bind(this,function(d){var e,f,k,m=getOwn(E,this.map.id),n=this.map.name,o=this.map.parentMap?this.map.parentMap.name:null,p=u.makeRequire(a.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(d.normalize&&(n=d.normalize(n,function(a){return c(a,o,!0)})||""),f=g(a.prefix+"!"+n,this.map.parentMap),i(f,"defined",bind(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),k=getOwn(y,f.id),void(k&&(this.depMaps.push(f),this.events.error&&k.on("error",bind(this,function(a){this.emit("error",a)})),k.enable()))):m?(this.map.url=u.nameToUrl(m),void this.load()):(e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(y,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&l(a.map.id)}),j(a)}),e.fromText=bind(this,function(c,d){var f=a.name,i=g(f),k=useInteractive;d&&(c=d),k&&(useInteractive=!1),h(i),hasProp(x.config,b)&&(x.config[f]=x.config[b]);try{req.exec(c)}catch(l){return j(makeError("fromtexteval","fromText eval for "+b+" failed: "+l,l,[b]))}k&&(useInteractive=!0),this.depMaps.push(i),u.completeLoad(f),p([f],e)}),void d.load(a.name,p,e,x))})),u.enable(d,this),this.pluginMaps[d.id]=d},enable:function(){z[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,d,e;if("string"==typeof a){if(a=g(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[b]=a,e=getOwn(v,a.id))return void(this.depExports[b]=e(this));this.depCount+=1,i(a,"defined",bind(this,function(a){this.defineDep(b,a),this.check()})),this.errback&&i(a,"error",bind(this,this.errback))}c=a.id,d=y[c],hasProp(v,c)||!d||d.enabled||u.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=getOwn(y,a.id);b&&!b.enabled&&u.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),"error"===a&&delete this.events[a]}},u={config:x,contextName:a,registry:y,defined:C,urlFetched:D,defQueue:B,Module:t,makeModuleMap:g,nextTick:req.nextTick,onError:j,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=x.shim,c={paths:!0,bundles:!0,config:!0,map:!0};eachProp(a,function(a,b){c[b]?(x[b]||(x[b]={}),mixin(x[b],a,!0,!0)):x[b]=a}),a.bundles&&eachProp(a.bundles,function(a,b){each(a,function(a){a!==b&&(E[a]=b)})}),a.shim&&(eachProp(a.shim,function(a,c){isArray(a)&&(a={deps:a}),!a.exports&&!a.init||a.exportsFn||(a.exportsFn=u.makeShimExports(a)),b[c]=a}),x.shim=b),a.packages&&each(a.packages,function(a){var b,c;a="string"==typeof a?{name:a}:a,c=a.name,b=a.location,b&&(x.paths[c]=a.location),x.pkgs[c]=a.name+"/"+(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(y,function(a,b){a.inited||a.map.unnormalized||(a.map=g(b))}),(a.deps||a.callback)&&u.require(a.deps||[],a.callback)},makeShimExports:function(a){function b(){var b;return a.init&&(b=a.init.apply(global,arguments)),b||a.exports&&getGlobal(a.exports)}return b},makeRequire:function(b,e){function f(c,d,i){var k,l,m;return e.enableBuildCallback&&d&&isFunction(d)&&(d.__requireJsBuild=!0),"string"==typeof c?isFunction(d)?j(makeError("requireargs","Invalid require call"),i):b&&hasProp(v,c)?v[c](y[b.id]):req.get?req.get(u,c,b,f):(l=g(c,b,!1,!0),k=l.id,hasProp(C,k)?C[k]:j(makeError("notloaded",'Module name "'+k+'" has not been loaded yet for context: '+a+(b?"":". Use redhelper.require([])")))):(r(),u.nextTick(function(){r(),m=h(g(null,b)),m.skipMap=e.skipMap,m.init(c,d,i,{enabled:!0}),n()}),f)}return e=e||{},mixin(f,{isBrowser:isBrowser,toUrl:function(a){var d,e=a.lastIndexOf("."),f=a.split("/")[0],g="."===f||".."===f;return-1!==e&&(!g||e>1)&&(d=a.substring(e,a.length),a=a.substring(0,e)),u.nameToUrl(c(a,b&&b.id,!0),d,!0)},defined:function(a){return hasProp(C,g(a,b,!1,!0).id)},specified:function(a){return a=g(a,b,!1,!0).id,hasProp(C,a)||hasProp(y,a)}}),b||(f.undef=function(a){k();var c=g(a,b,!0),e=getOwn(y,a);d(a),delete C[a],delete D[c.url],delete A[a],eachReverse(B,function(b,c){b[0]===a&&B.splice(c,1)}),e&&(e.events.defined&&(A[a]=e.events),l(a))}),f},enable:function(a){var b=getOwn(y,a.id);b&&h(a).enable()},completeLoad:function(a){var b,c,d,f=getOwn(x.shim,a)||{},g=f.exports;for(k();B.length;){if(c=B.shift(),null===c[0]){if(c[0]=a,b)break;b=!0}else c[0]===a&&(b=!0);o(c)}if(d=getOwn(y,a),!b&&!hasProp(C,a)&&d&&!d.inited){if(!(!x.enforceDefine||g&&getGlobal(g)))return e(a)?void 0:j(makeError("nodefine","No define call for "+a,null,[a]));o([a,f.deps||[],f.exportsFn])}n()},nameToUrl:function(a,b,c){var d,e,f,g,h,i,j,k=getOwn(x.pkgs,a);if(k&&(a=k),j=getOwn(E,a))return u.nameToUrl(j,b,c);if(req.jsExtRegExp.test(a))h=a+(b||"");else{for(d=x.paths,e=a.split("/"),f=e.length;f>0;f-=1)if(g=e.slice(0,f).join("/"),i=getOwn(d,g)){isArray(i)&&(i=i[0]),e.splice(0,f,i);break}h=e.join("/"),h+=b||(/^data\:|\?/.test(h)||c?"":".js"),h=("/"===h.charAt(0)||h.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+h}return x.urlArgs?h+((-1===h.indexOf("?")?"?":"&")+x.urlArgs):h},load:function(a,b){req.load(u,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=q(a);u.completeLoad(b.id)}},onScriptError:function(a){var b=q(a);return e(b.id)?void 0:j(makeError("scripterror","Script error for: "+b.id,a,[b.id]))}},u.require=u.makeRequire(),u}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(a){return"interactive"===a.readyState?interactiveScript=a:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.14",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(a,b,c,d){var e,f,g=defContextName;return isArray(a)||"string"==typeof a||(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=getOwn(contexts,g),e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},req.nextTick="undefined"!=typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(a){req[a]=function(){var b=contexts[defContextName];return b.require[a].apply(b,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(a){var b=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return b.type=a.scriptType||"text/javascript",b.charset="utf-8",b.async=!0,b},req.load=function(a,b,c){var d,e=a&&a.config||{};if(isBrowser)return d=req.createNode(e,b,c),d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&d.attachEvent.toString().indexOf("[native code")<0||isOpera?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(useInteractive=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,currentlyAddingScript=d,baseElement?head.insertBefore(d,baseElement):head.appendChild(d),currentlyAddingScript=null,d;if(isWebWorker)try{importScripts(c),a.completeLoad(b)}catch(f){a.onError(makeError("importscripts","importScripts failed for "+b+" at "+c,f,[b]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(a){return head||(head=a.parentNode),dataMain=a.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(a,b,c){var d,e;"string"!=typeof a&&(c=b,b=a,a=null),isArray(b)||(c=b,b=null),!b&&isFunction(c)&&(b=[],c.length&&(c.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(a,c){b.push(c)}),b=(1===c.length?["require"]:["require","exports","module"]).concat(b))),useInteractive&&(d=currentlyAddingScript||getInteractiveScript(),d&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")])),(e?e.defQueue:globalDefQueue).push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),redhelper.requirejs=requirejs,redhelper.require=require,redhelper.define=define}}(),redhelper.define("almond",function(){}),redhelper.requirejs.config({baseUrl:"/chat/js",paths:{jquery:window.location.protocol+"//"+window.location.host+"/vendor/jquery.min"}}),redhelper.define("application/main.prod",function(){}),redhelper.define("common/extensions/compatibility",[],function(){"function"!=typeof Date.now&&(Date.now=function(){return(new Date).getTime()}),"bind"in Function.prototype||(Function.prototype.bind=function(a){var b=this;if(arguments.length<=1)return function(){return b.apply(a,arguments)};var c=Array.prototype.slice.call(arguments,1);return function(){return b.apply(a,0===arguments.length?c:c.concat(Array.prototype.slice.call(arguments)))}}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),"indexOf"in Array.prototype&&"function"==typeof Array.prototype.indexOf&&-1==[].indexOf(0)||(Array.prototype.indexOf=function(a,b){void 0===b&&(b=0),0>b&&(b+=this.length),0>b&&(b=0);for(var c=this.length;c>b;b++)if(this[b]===a)return b;return-1}),"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(a,b){for(void 0===b&&(b=this.length-1),0>b&&(b+=this.length),b>this.length-1&&(b=this.length-1),b++;b-->0;)if(b in this&&this[b]===a)return b;return-1}),"forEach"in Array.prototype||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d>c;c++)c in this&&a.call(b,this[c],c,this)}),"map"in Array.prototype||(Array.prototype.map=function(a,b){for(var c=new Array(this.length),d=0,e=this.length;e>d;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c}),"filter"in Array.prototype||(Array.prototype.filter=function(a,b){for(var c,d=[],e=0,f=this.length;f>e;e++)e in this&&a.call(b,c=this[e],e,this)&&d.push(c);return d}),"every"in Array.prototype||(Array.prototype.every=function(a,b){for(var c=0,d=this.length;d>c;c++)if(c in this&&!a.call(b,this[c],c,this))return!1;return!0}),"some"in Array.prototype||(Array.prototype.some=function(a,b){for(var c=0,d=this.length;d>c;c++)if(c in this&&a.call(b,this[c],c,this))return!0;return!1}),"reduce"in Array.prototype||(Array.prototype.reduce=function(a,b){if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof a)throw new TypeError(a+" is not a function");var c,d,e=this.length>>>0,f=!1;for(1<arguments.length&&(d=b,f=!0),c=0;e>c;++c)this.hasOwnProperty(c)&&(f?d=a(d,this[c],c,this):(d=this[c],f=!0));if(!f)throw new TypeError("Reduce of empty array with no initial value");return d}),JSON&&"function"!=typeof JSON.stringify&&(JSON.stringify=JSON.encode),JSON&&"function"!=typeof JSON.parse&&(JSON.parse=JSON.decode),window.rhlpSetInterval=function(a,b){var c=function(){try{a()}catch(d){}setTimeout(c,b)};c()},window.rhlpSetRealInterval=function(a,b){var c=Math.ceil(1e3/b),d=function(){setTimeout(d,c*b);for(var e=0;c>e;e++)setTimeout(function(){a()},e*b)};d()}}),redhelper.define("common/extensions/browserDetect",[],function(){var a={init:function(){this.browser=this.searchString(this.dataBrowser)||"-",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"",this.OS=this.searchString(this.dataOS)||"-","Opera"===this.browser&&(this.version=navigator.userAgent.split("Version/")[1]?navigator.userAgent.split("Version/")[1]:parseFloat(navigator.userAgent.split("OPR/")[1]).toFixed(1)),this.isMobile=navigator.userAgent.indexOf("Mobile")>-1},searchString:function(a){var b;for(b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!==c.indexOf(a[b].subString))return a[b].identity+(a[b].version?" "+a[b].version():"")}else if(d)return a[b].identity+(a[b].version?" "+a[b].version():"")}return void 0},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);return-1===b?void 0:parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"OPR/",identity:"Opera"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko/",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"like Gecko",identity:"Explorer",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.userAgent,subString:"Android",identity:"android",version:function(){return navigator.userAgent.substr(navigator.userAgent.indexOf("Android ")+8,3)}},{string:navigator.platform,subString:"Win",identity:"windows",version:function(){var a=navigator.userAgent.substr(navigator.userAgent.indexOf("NT ")+3,3);switch(a){case"6.3":return"8.1";case"6.2":return"8";case"6.1":return"7";case"6.0":return"Vista";case"5.1":return"XP";case"5.0":return"2000";case"4.1":return"NT 4.1";default:return""}}},{string:navigator.platform,subString:"Mac",identity:"mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:navigator.userAgent,subString:"iPad",identity:"iOS"},{string:navigator.userAgent,subString:"iPod",identity:"iOS"},{string:navigator.platform,subString:"Linux",identity:"linux"}],isMobile:!1};return a.init(),a}),redhelper.define("common/extensions/debug",[],function(){return{log:function(){},eventLog:function(){},sessionLog:function(){},info:function(){},clear:function(){},debug:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},error:function(){},assert:function(){}}}),redhelper.define("common/application/eventTarget",["common/extensions/debug"],function(a){function b(a,b){this.message=b,this.name="Custom Event Exception",this.target=a}var c=function(a){this._listeners={},this.targetName=a};return c.prototype={addEventListener:function(c,d){var e="dispatcher_"+c;if(void 0===c||""===c||"number"==typeof c&&isNaN(c)||null===c)throw new b(this.targetName,"empty type");if("function"!=typeof d)throw new b(this.targetName,"provided listener for event type "+c+" is not a function");this._listeners[e]instanceof Array||(this._listeners[e]=[]);for(var f in this._listeners[e])if(this._listeners[f]===d)return void a.eventLog("Listener already exists:\ntargetName="+this.targetName+", type="+c);this._listeners[e].push(d);try{a.eventLog("New event listener added:\ntargetName="+this.targetName+", type="+c)}catch(g){}},addOneShotEventListener:function(a,b){var c=function(){this.removeEventListener(a,c),b.apply(this,arguments)};this.addEventListener(a,c)},removeAllEventListeners:function(b){var c="dispatcher_"+b;if(this._listeners[c]){this._listeners[c]=[];try{a.eventLog("All listeners were removed\ntargetName="+this.targetName+", type="+b)}catch(d){}}},removeEventListener:function(b,c){var d="dispatcher_"+b;if(this._listeners[d]){var e=this._listeners[d].indexOf(c);if(-1!==e){this._listeners[d].splice(e,1);try{a.eventLog("One listener was removed\ntargetName="+this.targetName+", type="+b)}catch(f){}}}},fire:function(c,d,e){var f=c;if("string"==typeof c&&(c={type:c}),c._target||(c._target=this),!c.type)throw new b(this.targetName,"Event missing 'type' property");if("object"==typeof d)for(var g in d)"webkitStorageInfo"!=g&&(d.hasOwnProperty=d.hasOwnProperty||Object.prototype.hasOwnProperty,d.hasOwnProperty(g)&&(c[g]=d[g]));else"function"==typeof d&&(e=d,d=null);var h=0,i="dispatcher_"+("string"==typeof f?f:c.type);if(this._listeners[i])for(var j=this._listeners[i].slice(0),k=j.length;k>h;h++)if(j[h])try{j[h].call(this,c)}catch(l){a.error(l)}if("*"!==c.type){var m="*";if(this._listeners[m])for(var j=this._listeners[m],k=j.length;k>h;h++)try{j[h].call(this,c)}catch(l){a.error(l)}}if("function"==typeof e)try{e()}catch(l){a.error(l)}if(d&&!d.isMessageTarget)try{a.eventLog("Event was fired, "+h+" listeners was called:\ntargetName="+this.targetName+", type="+c.type)}catch(l){}}},c}),redhelper.define("application/dispatcher",["common/application/eventTarget"],function(a){var b=new a("Chat");return b}),redhelper.define("common/extensions/customScrollbar",["jquery"],function(a){!function(b,c){function d(a,c,d){a._eventHandlers=a._eventHandlers||[{element:a.scroller,handler:function(b){a.scroll(b)},type:"scroll"},{element:a.scroller,handler:function(){a.update()},type:"keyup"},{element:a.bar,handler:function(b){b.preventDefault(),a.selection(),a.drag.now=1},type:"touchstart mousedown"},{element:document,handler:function(){a.selection(1),a.drag.now=0},type:"mouseup blur touchend"},{element:document,handler:function(b){2!=b.button&&a._pos0(b)},type:"touchstart mousedown"},{element:document,handler:function(b){a.drag.now&&a.drag(b)},type:"mousemove touchmove"},{element:b,handler:function(){a.update()},type:"resize"},{element:a.root,handler:function(){a.update()},type:"sizeChange"}],m(a._eventHandlers,function(a){a.element&&c(a.element,a.type,a.handler,d)})}function e(a,b,c){var d="data-baron-"+b;if("on"==c)a.setAttribute(d,"inited");else{if("off"!=c)return a.getAttribute(d);a.removeAttribute(d)}}function f(a){if(e(a.root,a.direction))throw new Error("Second baron initialization");var b=new o.prototype.constructor(a);return d(b,a.event,"on"),e(b.root,a.direction,"on"),b.update({initMode:!0}),b}function g(a){var b={};a=a||{};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function h(a){var b=g(a);b.direction=b.direction||"v";var c=a.event||function(a,c,d,e){b.$(a)[e||"on"](c,d)};return b.event=function(a,b,d,e){m(a,function(a){c(a,b,d,e)})},b}function i(a){if(this.events&&this.events[a])for(var b=0;b<this.events[a].length;b++){var c=Array.prototype.slice.call(arguments,1);this.events[a][b].apply(this,c)}}if(b){var j=n,k=["left","top","right","bottom","width","height"],l={v:{x:"Y",pos:k[1],oppos:k[3],crossPos:k[0],crossOpPos:k[2],size:k[5],crossSize:k[4],client:"clientHeight",crossClient:"clientWidth",crossScroll:"scrollWidth",offset:"offsetHeight",crossOffset:"offsetWidth",offsetPos:"offsetTop",scroll:"scrollTop",scrollSize:"scrollHeight"},h:{x:"X",pos:k[0],oppos:k[2],crossPos:k[1],crossOpPos:k[3],size:k[4],crossSize:k[5],client:"clientWidth",crossClient:"clientHeight",crossScroll:"scrollHeight",offset:"offsetWidth",crossOffset:"offsetHeight",offsetPos:"offsetLeft",scroll:"scrollLeft",scrollSize:"scrollWidth"}},m=function(a,d){var e=0;for((a.length===c||a===b)&&(a=[a]);a[e];)d.call(this,a[e],e),e++},n=function(a){var c,d,e;return a=a||{},e=a.$||b.jQuery,c=this instanceof e,c?a.root=d=this:d=e(a.root||a.scroller),new n.fn.constructor(d,a,e)};n.fn={constructor:function(a,b,c){var d=h(b);d.$=c,m.call(this,a,function(a,b){var c=g(d);d.root&&d.scroller?(c.scroller=d.$(d.scroller,a),c.scroller.length||(c.scroller=a)):c.scroller=a,c.root=a,this[b]=f(c),this.length=b+1}),this.params=d},dispose:function(){var a=this.params;m(this,function(b){b.dispose(a)}),this.params=null},update:function(){for(var a=0;this[a];)this[a].update.apply(this[a],arguments),a++},baron:function(a){return a.root=[],a.scroller=this.params.scroller,m.call(this,this,function(b){a.root.push(b.root)}),a.direction="v"==this.params.direction?"h":"v",a._chain=!0,n(a)}};var o={};o.prototype={constructor:function(a){function b(a,b){return k(a,b)[0]}function d(a){var b=this.barMinSize||20;a>0&&b>a&&(a=b),this.bar&&k(this.bar).css(this.origin.size,parseInt(a,10)+"px")}function e(a){this.bar&&k(this.bar).css(this.origin.pos,+a+"px")}function f(){return o[this.origin.client]-this.barTopLimit-this.bar[this.origin.offset]}function g(a){return a*f.call(this)+this.barTopLimit}function h(a){return(a-this.barTopLimit)/f.call(this)}function j(){return!1}var k,m,n,o,p,q,r,s,t,u,v;return u=t=(new Date).getTime(),k=this.$=a.$,this.event=a.event,this.events={},this.root=a.root,this.scroller=b(a.scroller),this.bar=b(a.bar,this.root),o=this.track=b(a.track,this.root),!this.track&&this.bar&&(o=this.bar.parentNode),this.clipper=this.scroller.parentNode,this.direction=a.direction,this.origin=l[this.direction],this.barOnCls=a.barOnCls,this.scrollingCls=a.scrollingCls,this.barTopLimit=0,s=1e3*a.pause||0,this.cursor=function(a){return a["client"+this.origin.x]||(((a.originalEvent||a).touches||{})[0]||{})["page"+this.origin.x]},this.pos=function(a){var b="page"+this.origin.x+"Offset",d=this.scroller[b]?b:this.origin.scroll;return a!==c&&(this.scroller[d]=a),this.scroller[d]},this.rpos=function(a){var b,c=this.scroller[this.origin.scrollSize]-this.scroller[this.origin.client];return b=a?this.pos(a*c):this.pos(),b/(c||1)},this.barOn=function(a){this.barOnCls&&(a||this.scroller[this.origin.client]>=this.scroller[this.origin.scrollSize]?k(this.root).removeClass(this.barOnCls):k(this.root).addClass(this.barOnCls))},this._pos0=function(a){n=this.cursor(a)-m},this.drag=function(a){this.scroller[this.origin.scroll]=h.call(this,this.cursor(a)-n)*(this.scroller[this.origin.scrollSize]-this.scroller[this.origin.client])},this.selection=function(a){this.event(document,"selectpos selectstart",j,a?"off":"on")},this.resize=function(){function b(){var b,d;c.barOn(),d=c.scroller[c.origin.crossClient],b=c.scroller[c.origin.crossOffset]-d,a.freeze&&!c.clipper.style[c.origin.crossSize]&&k(c.clipper).css(c.origin.crossSize,c.clipper[c.origin.crossClient]-b+"px"),k(c.scroller).css(c.origin.crossSize,c.clipper[c.origin.crossClient]+b+"px"),Array.prototype.unshift.call(arguments,"resize"),i.apply(c,arguments),u=(new Date).getTime()}var c=this,d=0;(new Date).getTime()-u<s&&(clearTimeout(p),d=s),d?p=setTimeout(b,d):b()},this.updatePositions=function(){var a,b=this;b.bar&&(a=(o[b.origin.client]-b.barTopLimit)*b.scroller[b.origin.client]/b.scroller[b.origin.scrollSize],parseInt(v,10)!=parseInt(a,10)&&(d.call(b,a),v=a),m=g.call(b,b.rpos()),e.call(b,m)),Array.prototype.unshift.call(arguments,"scroll"),i.apply(b,arguments),t=(new Date).getTime()},this.scroll=function(){var a=0,b=this;(new Date).getTime()-t<s&&(clearTimeout(q),a=s),(new Date).getTime()-t<s&&(clearTimeout(q),a=s),a?q=setTimeout(function(){b.updatePositions()},a):b.updatePositions(),b.scrollingCls&&(r||this.$(this.scroller).addClass(this.scrollingCls),clearTimeout(r),r=setTimeout(function(){b.$(b.scroller).removeClass(b.scrollingCls),r=c},300))},this},update:function(a){return i.call(this,"upd",a),this.resize(1),this.updatePositions(),this},dispose:function(b){d(this,this.event,"off"),e(this.root,b.direction,"off"),a(this.scroller).css(this.origin.crossSize,""),this.barOn(!0),i.call(this,"dispose")
},on:function(a,b,c){for(var d=a.split(" "),e=0;e<d.length;e++)"init"==d[e]?b.call(this,c):(this.events[d[e]]=this.events[d[e]]||[],this.events[d[e]].push(function(a){b.call(this,a||c)}))}},n.fn.constructor.prototype=n.fn,o.prototype.constructor.prototype=o.prototype,n.noConflict=function(){return b.baron=j,n},n.version="0.7.7",a&&a.fn&&(a.fn.baron=n),b.baron=n,b.module&&module.exports&&(module.exports=n.noConflict())}}(window),function(a,b){var c=function(a){function c(a,c,d){var e=1==d?"pos":"oppos";g<(h.minView||0)&&(c=b),this.$(f[a]).css(this.origin.pos,"").css(this.origin.oppos,"").removeClass(h.outside),c!==b&&(c+="px",this.$(f[a]).css(this.origin[e],c).addClass(h.outside))}function d(a){try{i=document.createEvent("WheelEvent"),i.initWebKitWheelEvent(a.originalEvent.wheelDeltaX,a.originalEvent.wheelDeltaY),m.dispatchEvent(i),a.preventDefault()}catch(a){}}function e(a){var b;for(var c in a)h[c]=a[c];if(f=this.$(h.elements,this.scroller)){g=this.scroller[this.origin.client];for(var e=0;e<f.length;e++)b={},b[this.origin.size]=f[e][this.origin.offset],f[e].parentNode!==this.scroller&&this.$(f[e].parentNode).css(b),b={},b[this.origin.crossSize]=f[e].parentNode[this.origin.crossClient],this.$(f[e]).css(b),g-=f[e][this.origin.offset],l[e]=f[e].parentNode[this.origin.offsetPos],j[e]=j[e-1]||0,k[e]=k[e-1]||Math.min(l[e],0),f[e-1]&&(j[e]+=f[e-1][this.origin.offset],k[e]+=f[e-1][this.origin.offset]),(0!=e||0!=l[e])&&(this.event(f[e],"mousewheel",d,"off"),this.event(f[e],"mousewheel",d));h.limiter&&f[0]&&(this.track&&this.track!=this.scroller?(b={},b[this.origin.pos]=f[0].parentNode[this.origin.offset],this.$(this.track).css(b)):this.barTopLimit=f[0].parentNode[this.origin.offset],this.scroll()),h.limiter===!1&&(this.barTopLimit=0)}var i={element:f,handler:function(){for(var a,b=o(this)[0].parentNode,c=b.offsetTop,d=0;d<f.length;d++)f[d]===this&&(a=d);var e=c-j[a];h.scroll?h.scroll({x1:p.scroller.scrollTop,x2:e}):p.scroller.scrollTop=e},type:"click"};h.clickable&&(this._eventHandlers.push(i),n(i.element,i.type,i.handler,"on"))}var f,g,h={outside:"",inside:"",before:"",after:"",past:"",future:"",radius:0,minView:0},j=[],k=[],l=[],m=this.scroller,n=this.event,o=this.$,p=this;this.on("init",e,a);var q=[],r=[];this.on("init scroll",function(){var a,d,e;if(f){for(var i,m=0;m<f.length;m++)a=0,l[m]-this.pos()<k[m]+h.radius?(a=1,d=j[m]):l[m]-this.pos()>k[m]+g-h.radius?(a=2,d=this.scroller[this.origin.client]-f[m][this.origin.offset]-j[m]-g):(a=3,d=b),e=!1,(l[m]-this.pos()<k[m]||l[m]-this.pos()>k[m]+g)&&(e=!0),(a!=q[m]||e!=r[m])&&(c.call(this,m,d,a),q[m]=a,r[m]=e,i=!0);if(i)for(m=0;m<f.length;m++)1==q[m]&&h.past&&this.$(f[m]).addClass(h.past).removeClass(h.future),2==q[m]&&h.future&&this.$(f[m]).addClass(h.future).removeClass(h.past),3==q[m]?((h.future||h.past)&&this.$(f[m]).removeClass(h.past).removeClass(h.future),h.inside&&this.$(f[m]).addClass(h.inside)):h.inside&&this.$(f[m]).removeClass(h.inside),q[m]!=q[m+1]&&1==q[m]&&h.before?this.$(f[m]).addClass(h.before).removeClass(h.after):q[m]!=q[m-1]&&2==q[m]&&h.after?this.$(f[m]).addClass(h.after).removeClass(h.before):this.$(f[m]).removeClass(h.before).removeClass(h.after),h.grad&&(r[m]?this.$(f[m]).addClass(h.grad):this.$(f[m]).removeClass(h.grad))}}),this.on("resize upd",function(a){e.call(this,a&&a.fix)})};baron.fn.fix=function(a){for(var b=0;this[b];)c.call(this[b],a),b++;return this}}(window),function(){var a=function(a){var b,c,d,e,f,g=this;e=a.screen||.9,a.forward&&(b=this.$(a.forward,this.clipper),f={element:b,handler:function(){var b=g.pos()-a.delta||30;g.pos(b)},type:"click"},this._eventHandlers.push(f),this.event(f.element,f.type,f.handler,"on")),a.backward&&(c=this.$(a.backward,this.clipper),f={element:c,handler:function(){var b=g.pos()+a.delta||30;g.pos(b)},type:"click"},this._eventHandlers.push(f),this.event(f.element,f.type,f.handler,"on")),a.track&&(d=a.track===!0?this.track:this.$(a.track,this.clipper)[0],d&&(f={element:d,handler:function(a){var b=a["offset"+g.origin.x],c=g.bar[g.origin.offsetPos],d=0;c>b?d=-1:b>c+g.bar[g.origin.offset]&&(d=1);var f=g.pos()+d*e*g.scroller[g.origin.client];g.pos(f)},type:"mousedown"},this._eventHandlers.push(f),this.event(f.element,f.type,f.handler,"on")))};baron.fn.controls=function(b){for(var c=0;this[c];)a.call(this[c],b),c++;return this}}(window),function(){var a=function(a){function b(){return r.scroller[r.origin.scroll]+r.scroller[r.origin.offset]}function c(){return r.scroller[r.origin.scrollSize]}function d(){return r.scroller[r.origin.client]}function e(a,b){var c=5e-4*a;return Math.floor(b-c*(a+550))}function f(a){k=a,a?(g(),h=setInterval(g,200)):clearInterval(h)}function g(){var g,h,k={},w=b(),x=c(),y=1==s;if(h=0,s>0&&(h=40),g=e(u,h),w>=x-u&&s>-1?y&&(u+=g):u=0,0>u&&(u=0),k[m]=u+"px",d()<=c()){r.$(l).css(k);for(var z=0;z<p.length;z++)r.$(p[z].self).css(p[z].property,Math.min(u/n*100,100)+"%")}q&&u&&r.$(r.root).addClass(q),0==u&&a.onCollapse&&a.onCollapse(),s=0,i=setTimeout(function(){s=-1},v),o&&u>n&&!j&&(o(),j=!0),0==u?t++:t=0,t>1&&(f(!1),j=!1,q&&r.$(r.root).removeClass(q))}var h,i,j,k,l=this.$(a.block),m=a.size||this.origin.size,n=a.limit||80,o=a.onExpand,p=a.elements||[],q=a.inProgress||"",r=this,s=0,t=0,u=0,v=a.waiting||500;this.on("init",function(){f(!0)}),this.on("dispose",function(){f(!1)}),this.event(this.scroller,"mousewheel DOMMouseScroll",function(a){var d=a.wheelDelta<0||a.originalEvent&&a.originalEvent.wheelDelta<0||a.detail>0;d&&(s=1,clearTimeout(i),!k&&b()>=c()&&f(!0))})};baron.fn.pull=function(b){for(var c=0;this[c];)a.call(this[c],b),c++;return this}}(window),function(a){var b=a.MutationObserver||a.WebKitMutationObserver||a.MozMutationObserver||null,c=function(){var a=this;this._observer=new MutationObserver(function(){a.update()}),this.on("init",function(){a._observer.observe(a.root,{childList:!0,subtree:!0,characterData:!0})}),this.on("dispose",function(){a._observer.dissconect(),delete a._observer})};baron.fn.autoUpdate=function(a){if(!b)return this;for(var d=0;this[d];)c.call(this[d],a),d++;return this}}(window)}),redhelper.define("common/extensions/jquery.disableSelection",["jquery","common/extensions/browserDetect"],function(a,b){"Firefox"===b.browser?(a.fn.disableTextSelect=function(){return this.each(function(){a(this).css("MozUserSelect","none")})},a.fn.enableTextSelect=function(){return this.each(function(){a(this).css("MozUserSelect","")})}):navigator&&navigator.userAgent&&navigator.userAgent.indexOf("WebKit")>-1?(a.fn.disableTextSelect=function(){return this.each(function(){a(this).css("-webkit-user-select","none")})},a.fn.enableTextSelect=function(){return this.each(function(){a(this).css("-webkit-user-select","")})}):"Explorer"===b.browser?(a.fn.disableTextSelect=function(){return this.each(function(){a(this).bind("selectstart.disableTextSelect",function(){return!1})})},a.fn.enableTextSelect=function(){return this.each(function(){a(this).unbind("selectstart.disableTextSelect")})}):(a.fn.disableTextSelect=function(){return this.each(function(){a(this).bind("mousedown.disableTextSelect",function(){return!1})})},a.fn.enableTextSelect=function(){return this.each(function(){a(this).unbind("mousedown.disableTextSelect")})})}),redhelper.define("common/extensions/jquery.easing",["jquery"],function(a){a.easing.rh_expIn=function(a,b,c,d){return 0==b?c:c+d*Math.pow(2,10*(a-1))},a.easing.rh_expOut=function(a,b,c,d){return 1==a?c+d:c+d*(1-Math.pow(2,-10*a))},a.easing.rh_in=function(a,b,c,d){return c+d*a*a*(3*a-2)},a.easing.rh_out=function(a,b,c,d){return c+d*((a-1)*(a-1)*(3*(a-1)+2)+1)},a.easing.rh_bounce=function(a,b,c,d){var e=1/2.75;return e>a?c+7.5625*d*a*a:2*e>a?c+d*(7.5625*(a-1.5*e)*(a-1.5*e)+.75):2.5*e>a?c+d*(7.5625*(a-2.25*e)*(a-2.25*e)+.9375):c+d*(7.5625*(a-2.625*e)*(a-2.625*e)+.984375)}}),redhelper.define("common/extensions/jquery.fix",["jquery"],function(a){function b(a){return"object"==typeof Node?a instanceof Node:a&&"object"==typeof a&&"number"==typeof a.nodeType&&"string"==typeof a.nodeName}a.fn.oldIs=a.fn.oldIs||a.fn.is,a.fn.is=function(a){return":visible"==a?"none"!=this.css("display")&&this.oldIs(":visible"):this.oldIs(a)},a.fn.oldFind=a.fn.oldFind||a.fn.find,a.fn.find=function(a){var c=this.oldFind(a),d=c[0];return d&&d[0]&&!b(d)&&(c=d),c},a.fn.oldHeight=a.fn.oldHeight||a.fn.height,a.fn.height=function(){return this[0]===window?window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight:this.oldHeight()},a.acceptData=function(b){if("string"==typeof b.nodeName){var c=a.noData[b.nodeName.toLowerCase()];if(c)return!(c===!0||b.getAttribute("classid")!==c)}return!0}}),redhelper.define("common/extensions/jquery.getpath",["jquery"],function(a){function b(a){for(var b=[],c=[],d=a,e=Number(new Date);d.length;){var f=d[0];if(void 0!==f.path&&e-f.pathTime<1e3){c.push(f.path);break}var g=f.localName||f.tagName||f.nodeName;if(!g||"#document"==g)break;g=g.toLowerCase();var h=d.parent(),i=h.children(g);i.length>1&&(g+=":eq("+i.index(d)+")"),b.push(d[0]),c.push(g),d=h}var j=b.length,k=c.pop();c.length===b.length&&c.length>0&&(k=k+">"+c.pop());for(var l=j-1;l>=0;l--)b[l].path=k,b[l].pathTime=e,l>0&&(k+=">"+c[l-1]);return k}a.fn.getPath=function(){if(0==this.length)throw"Requires one element.";return b(this)}}),redhelper.define("common/extensions/jquery.getvisible",["jquery"],function(a){return a.fn.getVisible=function(){if(this.length<=1)return this;var b=function(b){if(!a(b).is(":visible"))return{top:0,left:0,width:0,height:0};var c={left:parseInt(a(b).css("padding-left")),right:parseInt(a(b).css("padding-right")),top:parseInt(a(b).css("padding-top")),bottom:parseInt(a(b).css("padding-bottom"))};for(var d in c)c[d]!=c[d]&&(c[d]=0);var e={left:parseInt(a(b).css("border-left-width")),right:parseInt(a(b).css("border-right-width")),top:parseInt(a(b).css("border-top-width")),bottom:parseInt(a(b).css("border-bottom-width"))};for(d in e)e[d]!=e[d]&&(e[d]=0);var f=a(b).offset();return f.width=a(b).width()+c.left+c.right+e.left+e.right,f.height=a(b).height()+c.top+c.bottom+e.top+e.bottom,f},c=function(a,b){return a.left+a.width>b.left&&b.left+b.width>a.left&&a.top+a.height>b.top&&b.top+b.height>a.top},d={left:a(window).scrollLeft(),top:a(window).scrollTop(),width:a(window).width(),height:a(window).height()},e=null;return a.each(this,function(a,f){return c(d,b(f))?(e=f,!1):void 0}),a(e)},a}),redhelper.define("common/extensions/jquery.maskedinput",["jquery"],function(a){return function(a){function b(){var a=document.createElement("input"),b="onpaste";return a.setAttribute(b,""),"function"==typeof a[b]?"paste":"input"}var c,d=b()+".mask",e=navigator.userAgent,f=/iphone/i.test(e),g=/android/i.test(e);a.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},a.fn.extend({caret:function(a,b){var c;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof a?(b="number"==typeof b?b:a,this.each(function(){this.setSelectionRange?this.setSelectionRange(a,b):this.createTextRange&&(c=this.createTextRange(),c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select())})):(this[0].setSelectionRange?(a=this[0].selectionStart,b=this[0].selectionEnd):document.selection&&document.selection.createRange&&(c=document.selection.createRange(),a=0-c.duplicate().moveStart("character",-1e5),b=a+c.text.length),{begin:a,end:b})},unmask:function(){return this.trigger("unmask")},mask:function(b,e){var h,i,j,k,l,m;return!b&&this.length>0?(h=a(this[0]),h.data(a.mask.dataName)()):(e=a.extend({placeholder:a.mask.placeholder,completed:null},e),i=a.mask.definitions,j=[],k=m=b.length,l=null,a.each(b.split(""),function(a,b){"?"==b?(m--,k=a):i[b]?(j.push(new RegExp(i[b])),null===l&&(l=j.length-1)):j.push(null)}),this.trigger("unmask").each(function(){function h(a){for(;++a<m&&!j[a];);return a}function n(a){for(;--a>=0&&!j[a];);return a}function o(a,b){var c,d;if(!(0>a)){for(c=a,d=h(b);m>c;c++)if(j[c]){if(!(m>d&&j[c].test(w[d])))break;w[c]=w[d],w[d]=e.placeholder,d=h(d)}t(),v.caret(Math.max(l,a))}}function p(a){var b,c,d,f;for(b=a,c=e.placeholder;m>b;b++)if(j[b]){if(d=h(b),f=w[b],w[b]=c,!(m>d&&j[d].test(f)))break;c=f}}function q(a){var b,c,d,e=a.which;8===e||46===e||f&&127===e?(b=v.caret(),c=b.begin,d=b.end,d-c===0&&(c=46!==e?n(c):d=h(c-1),d=46===e?h(d):d),s(c,d),o(c,d-1),a.preventDefault()):27==e&&(v.val(x),v.caret(0,u()),a.preventDefault())}function r(b){var c,d,f,i=b.which,k=v.caret();b.ctrlKey||b.altKey||b.metaKey||32>i||i&&(k.end-k.begin!==0&&(s(k.begin,k.end),o(k.begin,k.end-1)),c=h(k.begin-1),m>c&&(d=String.fromCharCode(i),j[c].test(d)&&(p(c),w[c]=d,t(),f=h(c),g?setTimeout(a.proxy(a.fn.caret,v,f),0):v.caret(f),e.completed&&f>=m&&e.completed.call(v))),b.preventDefault())}function s(a,b){var c;for(c=a;b>c&&m>c;c++)j[c]&&(w[c]=e.placeholder)}function t(){v.val(w.join(""))}function u(a){var b,c,d=v.val(),f=-1;for(b=0,pos=0;m>b;b++)if(j[b]){for(w[b]=e.placeholder;pos++<d.length;)if(c=d.charAt(pos-1),j[b].test(c)){w[b]=c,f=b;break}if(pos>d.length)break}else w[b]===d.charAt(pos)&&b!==k&&(pos++,f=b);return a?t():k>f+1?(v.val(""),s(0,m)):(t(),v.val(v.val().substring(0,f+1))),k?b:l}var v=a(this),w=a.map(b.split(""),function(a){return"?"!=a?i[a]?e.placeholder:a:void 0}),x=v.val();v.data(a.mask.dataName,function(){return a.map(w,function(a,b){return j[b]&&a!=e.placeholder?a:null}).join("")}),v.attr("readonly")||v.one("unmask",function(){v.unbind(".mask").removeData(a.mask.dataName)}).bind("focus.mask",function(){v.removeClass("placeholder"),clearTimeout(c);var a;x=v.val(),a=u(),c=setTimeout(function(){t(),a==b.length?v.caret(0,a):v.caret(a)},10)}).bind("blur.mask",function(){u(),v.val()!=x?v.change():v.addClass("placeholder")}).bind("keydown.mask",q).bind("keypress.mask",r).bind(d,function(){setTimeout(function(){var a=u(!0);v.caret(a),e.completed&&a==v.val().length&&e.completed.call(v)},0)}),u()}))}})}(a),a}),redhelper.define("common/extensions/jquery.minbox",["jquery"],function(a){var b=function(a){var b={"font-family":a.css("font-family"),"font-size":a.css("font-size"),"font-weight":a.css("font-weight"),"line-height":a.css("line-height")};return b},c=function(c,d,e){e=e||4048;var f=0,g=b(c),h=a("<div/>").css(g).html(c.html());h.css("float","left"),h.css("height",d+"px"),h.appendTo("body"),f=h.width(),h.css("height","auto"),h.css("float","none"),h.css("width",e/2);var i=1,j=e,k=j;for(j/=2;Math.abs(k-j)>i;)h.height()<=d?(k=j,j/=2):j=(k+j)/2,h.css("width",j);var l;return l=h.height()>d?k:j,h.remove(),l>1?l:f};a.fn.minBox=function(a){return c(this,a)}}),redhelper.define("common/extensions/jquery.placeholder",["jquery"],function(a){!function(a,b,c){function d(a){var b={},d=/^jQuery\d+$/;return c.each(a.attributes,function(a,c){c.specified&&!d.test(c.name)&&(b[c.name]=c.value)}),b}function e(a,b){var d=this,e=c(d);if(e.hasClass("placeholder"))if(e.data("placeholder-password")){if(e=e.hide().next().show().attr("id",e.removeAttr("id").data("placeholder-id")),a===!0)return e[0].value=b;e.focus()}else d.value="",e.removeClass("placeholder"),d==g()&&d.select()}function f(){var a,b=this,f=c(b),g=this.id;if(""==b.value){if("password"==b.type){if(!f.data("placeholder-textinput")){try{a=f.clone().attr({type:"text"})}catch(h){a=c("<input>").attr(c.extend(d(this),{type:"text"}))}a.removeAttr("name").data({"placeholder-password":f,"placeholder-id":g}).bind("focus.placeholder",e),f.data({"placeholder-textinput":a,"placeholder-id":g}).before(a)}f=f.removeAttr("id").hide().prev().attr("id",g).show()}f.addClass("placeholder"),f[0].value=f.attr("placeholder")}else f.removeClass("placeholder")}function g(){try{return b.activeElement}catch(a){}}var h,i,j="placeholder"in b.createElement("input"),k="placeholder"in b.createElement("textarea"),l=c.fn,m=c.valHooks,n=c.propHooks;j&&k?(i=l.placeholder=function(){return this},i.input=i.textarea=!0):(i=l.placeholder=function(){var a=this;return a.filter((j?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":e,"blur.placeholder":f}).data("placeholder-enabled",!0).trigger("blur.placeholder"),a},i.input=j,i.textarea=k,h={get:function(a){var b=c(a),d=b.data("placeholder-password");return d?d[0].value:b.data("placeholder-enabled")&&b.hasClass("placeholder")?"":a.value},set:function(a,b){var d=c(a),h=d.data("placeholder-password");return h?h[0].value=b:d.data("placeholder-enabled")?(""==b?(a.value=b,a!=g()&&f.call(a)):d.hasClass("placeholder")?e.call(a,!0,b)||(a.value=b):a.value=b,d):a.value=b}},j||(m.input=h,n.value=h),k||(m.textarea=h,n.value=h),c(function(){c(b).delegate("form","submit.placeholder",function(){var a=c(".placeholder",this).each(e);setTimeout(function(){a.each(f)},10)})}),c(a).bind("beforeunload.placeholder",function(){c(".placeholder").each(function(){this.value=""})}))}(window,document,a)}),redhelper.define("common/extensions/jquery.postMessage",["jquery"],function(a){window.postMessage&&(a.postMessage=function(a,b,c){a.postMessage(b,c)},a.receiveMessage=function(a){window.addEventListener?window.addEventListener("message",a,!1):window.attachEvent&&window.attachEvent("onmessage",a)})}),redhelper.define("common/extensions/jquery.pulse",["jquery"],function(a){a.fn.pulse=function(b){var c=a(this).css("opacity");a(this).animate({opacity:0},{duration:100,queue:!0}).animate({opacity:c},{duration:120,queue:!0}).animate({opacity:0},{duration:150,queue:!0}).animate({opacity:c},{duration:170,queue:!0}).animate({opacity:0},{duration:200,queue:!0}).animate({opacity:c},{duration:300,queue:!0}).animate({opacity:0},{duration:600,queue:!0,complete:function(){a(this).hide().css("opacity",c),b()}})}}),redhelper.define("common/extensions/jquery.plugins",["jquery","common/extensions/customScrollbar","common/extensions/jquery.disableSelection","common/extensions/jquery.easing","common/extensions/jquery.fix","common/extensions/jquery.getpath","common/extensions/jquery.getvisible","common/extensions/jquery.maskedinput","common/extensions/jquery.minbox","common/extensions/jquery.placeholder","common/extensions/jquery.postMessage","common/extensions/jquery.pulse"],function(a){return a}),redhelper.define("common/constants/type",{STRING:0,BOOLEAN:1,INTEGER:2,OBJECT:3}),redhelper.define("common/extensions/base64",[],function(){var a={CA:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",CAS:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",IA:new Array(256),IAS:new Array(256),isUtf8:function(a){for(var b=!1,c=0;c<a.length;c++)if(a.charCodeAt(c)>255){b=!0;break}return b},toByteArray:function(a,b){var c,d,e=[];for(b="undefined"!=typeof b?b:!0,c=0;c<a.length;c++)d=a.charCodeAt(c),127>=d||!b?e.push(d):2047>=d?(e.push(d>>6|192),e.push(63&d|128)):65535>=d?(e.push(d>>12|224),e.push(d>>6&63|128),e.push(63&d|128)):(e.push(d>>18|240),e.push(d>>12&63|128),e.push(d>>6&63|128),e.push(63&d|128));return e},fromByteArray:function(a,b){var c,d="",e=0;for(b="undefined"!=typeof b?b:!0,e=0;e<a.length;e++)c=a[e],127>=c||!b||(192==(224&c)?(c=(31&c)<<6,c+=63&a[++e]):224==(240&c)?(c=(15&c)<<12,c+=(63&a[++e])<<6,c+=63&a[++e]):(c=(7&c)<<18,c+=(63&a[++e])<<12,c+=(63&a[++e])<<6,c+=63&a[++e])),0!==c&&(d+=String.fromCharCode(c));return d},init:function(){var b;for(b=0;256>b;b++)a.IA[b]=-1,a.IAS[b]=-1;for(b=0,iS=a.CA.length;iS>b;b++)a.IA[a.CA.charCodeAt(b)]=b,a.IAS[a.CAS.charCodeAt(b)]=b;a.IA["="]=a.IAS["="]=0},encode:function(b,c){var d,e,f,g,h,i,j,k,l,m;for(d=c?a.CAS:a.CA,f=b.constructor==Array?b:a.toByteArray(b),g=f.length,h=g/3*3,i=(g-1)/3+1<<2,e=new Array(i),j=0,k=0;h>j;)m=(255&f[j++])<<16|(255&f[j++])<<8|255&f[j++],e[k++]=d.charAt(m>>18&63),e[k++]=d.charAt(m>>12&63),e[k++]=d.charAt(m>>6&63),e[k++]=d.charAt(63&m);l=g-h,l>0&&(m=(255&f[h])<<10|(2==l?(255&f[g-1])<<2:0),e[i-4]=d.charAt(m>>12),e[i-3]=d.charAt(m>>6&63),e[i-2]=2==l?d.charAt(63&m):"=",e[i-1]="=");var n=e.join("");return n},decode:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(d=c?a.IAS:a.IA,b.constructor==Array?(f=b,h=!0):(f=a.toByteArray(b),h=!1),g=f.length,i=0,j=g-1;j>i&&d[f[i]]<0;)i++;for(;j>0&&d[f[j]]<0;)j--;for(k="="==f[j]?"="==f[j-1]?2:1:0,l=j-i+1,m=g>76?("\r"==f[76]?l/78:0)<<1:0,n=(6*(l-m)>>3)-k,e=new Array(n),o=0,p=0,eLen=n/3*3;eLen>o;)q=d[f[i++]]<<18|d[f[i++]]<<12|d[f[i++]]<<6|d[f[i++]],e[o++]=q>>16&255,e[o++]=q>>8&255,e[o++]=255&q,m>0&&19==++p&&(i+=2,p=0);if(n>o){for(q=0,r=0;j-k>=i;r++)q|=d[f[i++]]<<18-6*r;for(s=16;n>o;s-=8)e[o++]=q>>s&255}return h?e:a.fromByteArray(e)},_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encodeOld:function(b,c){var d,e,f,g,h,i,j,k="",l=0;for(b=a._UTF8Encode(b,c);l<b.length;)d=b.charCodeAt(l++),e=b.charCodeAt(l++),f=b.charCodeAt(l++),g=d>>2,h=(3&d)<<4|e>>4,i=(15&e)<<2|f>>6,j=63&f,isNaN(e)?i=j=64:isNaN(f)&&(j=64),k=k+this._keyStr.charAt(g)+this._keyStr.charAt(h)+this._keyStr.charAt(i)+this._keyStr.charAt(j);return k},decodeOld:function(b,c){var d,e,f,g,h,i,j,k="",l=0;for(b=b.replace(/[^A-Za-z0-9\+\/=]/g,"");l<b.length;)g=this._keyStr.indexOf(b.charAt(l++)),h=this._keyStr.indexOf(b.charAt(l++)),i=this._keyStr.indexOf(b.charAt(l++)),j=this._keyStr.indexOf(b.charAt(l++)),d=g<<2|h>>4,e=(15&h)<<4|i>>2,f=(3&i)<<6|j,k+=String.fromCharCode(d),64!==i&&(k+=String.fromCharCode(e)),64!==j&&(k+=String.fromCharCode(f));return k=a._UTF8Decode(k,c)},_UTF8Encode:function(a,b){return a=a.replace(/\r\n/g,"\n"),b?encodeURIComponent(a):unescape(encodeURIComponent(a))},_UTF8Decode:function(a,b){return decodeURIComponent(b?a:escape(a))}};return a.init(),a}),redhelper.define("common/constants/scope",{LOCAL:0,SESSION:1,STORAGE:2}),redhelper.define("common/application/session",["common/extensions/jquery.plugins","common/application/eventTarget","common/constants/type","common/extensions/debug","common/extensions/base64","common/constants/scope"],function(a,b,c,d,e,f){function g(a){return a===f.STORAGE?localStorage:a===f.LOCAL?o:sessionStorage}function h(a,b,d){var e;switch("undefined"==typeof b&&(b=c.STRING),!a&&d&&(a=p.get(d)),b){case c.BOOLEAN:var f=a.toLowerCase();e="true"===f||"yes"===f||"ok"===f||"1"===f;break;case c.INTEGER:e=+a,!e&&d&&(e=+p.get(d)),e!==e&&(e=0);break;case c.OBJECT:try{if(e=JSON.parse(a),"string"==typeof e)try{e=JSON.parse(e)}catch(g){}}catch(g){e=void 0}break;default:e=a}return e}if(!window.sessionStorage||!window.localStorage)return{};var i=null,j=function(){},k=null,l="",m=!1,n="",o={setItem:function(a,b){o[a+""]=b+""},getItem:function(a){return o[a+""]?o[a+""]:null}},p=a.extend(new Image,{dispatcher:new b("Session"),init:function(a,b){n="rhlp."+a+".",i=b,p.fields=[];for(var e in i)i.hasOwnProperty(e)&&!function(a){var b=function(){var b=p.get(a),c=h(b,i[a].type,i[a].fallback);return i[a].value&&""===b?i[a].value:c},d=function(b){if(b===b&&void 0!==b&&null!==b){var d=i[a].scope,e=i[a].type;e===c.OBJECT&&(b=JSON.stringify(b)),void 0===d&&(d=f.SESSION),p.set(a,b,d)}};!Object.__defineGetter__&&Object.defineProperty?Object.defineProperty(p,a,{get:b,set:d}):p.__defineGetter__&&(p.__defineGetter__(a,b),p.__defineSetter__(a,d)),p.fields.push(a)}(e);var g=function(a){if((!a.storageArea||a.storageArea!==sessionStorage)&&"key"in a&&0===a.key.indexOf(n)){var b=a.key.substr(n.length);p.dispatcher.fire("on"+b.charAt(0).toUpperCase()+b.substr(1)+"Changed",{inCurrentTab:!1})}};window.addEventListener?(window.addEventListener("storage",g,!1),window.addEventListener("onstorage",g,!1)):(window.attachEvent("onstorage",g),document.attachEvent("onstorage",g)),d.sessionLog(["INIT | ",n])},onLoad:function(a){"function"==typeof a&&(j=a),(!k||m)&&j()},get:function(a){if(!i[a])return"";var b=a;a=n+a;var c=g(i[b].scope);return null!==c.getItem(a)?c.getItem(a):""},set:function(a,b,c,e){if(!e&&k&&k.send("updateSession",{name:a,value:b,scope:c}),p.get(a)!==""+b){var f=a;a=n+a;var h=g(c);h.setItem(a,b),p.dispatcher.fire("on"+f.charAt(0).toUpperCase()+f.substr(1)+"Changed",{inCurrentTab:!0}),d.sessionLog("STORAGE | "+a+" = "+b)}},attachTo:function(a,b,d){k=a,l=d,k.addHandler("initSession",function(a){a=JSON.parse(a.value);for(var d in a)a.hasOwnProperty(d)&&(b[d].priority||(b[d].priority="external"),b[d]&&l!==b[d].priority&&(b[d].type===c.OBJECT&&(a[d]=JSON.stringify(a[d])),p.set(d,a[d],b[d].scope,!0)));m=!0,"function"==typeof j&&j()}),k.addHandler("requestSession",function(a){a=JSON.parse(a.value);var b={};for(var c in a)a.hasOwnProperty(c)&&"undefined"!=typeof p[c]&&(b[c]=p[c]);k.send("initSession",{value:JSON.stringify(b)})}),k.addHandler("updateSession",function(a){b[a.name]&&(b[a.name].type===c.OBJECT&&(a.value=JSON.stringify(a.value)),p.set(a.name,a.value,a.scope,!0))})},clear:function(a){for(var b in i)if(i.hasOwnProperty(b)){if(!a&&"vid"===b)continue;p[b]=i[b].value||""}},sendRequest:function(){k.send("requestSession",{value:JSON.stringify(i)})}});return p}),redhelper.define("common/communication/encoder",["common/extensions/base64"],function(a){return{serialize:function(a){return JSON.stringify(a)},parse:function(a){return JSON.parse(a)},compress:function(b){return a.encodeOld(JSON.stringify(b))},decompress:function(b){return JSON.parse(a.decodeOld(b))}}}),redhelper.define("config/setup",["common/communication/encoder"],function(a){var b;try{b=a.decompress(location.hash.split("#")[1])}catch(c){b={url:"http://rhlp.net"+location.search}}var d=location.href.indexOf("test.")>-1?"test.":"",e={DEBUG:!1,SHOW_EVENTS:!1,SHOW_SESSION:!1,WEBSOCKET:!1,XMPP_DOMAIN:"xmpp.redhelper.ru",DATA_URL:location.protocol+"//dh7xgsr9ech2h.cloudfront.net",BOSH_SERVICE:location.protocol+"//"+location.host+"/http-bind/",NX_URL:location.protocol+"//"+d+"web.redhelper.ru/nx/",APP_URL:location.protocol+"//"+location.host+"/",CLIENT_NAME:location.href.split("?")[1].split("c=")[1].split("&")[0].split("#")[0].toLowerCase(),PARENT_URI:b.url,PARENT_URL:b.url.split("//")[0]+"//"+b.url.split("//")[1].split("/")[0],STANDALONE:location.href.indexOf("&standalone")>-1,REQUIRE_OPERATOR:null,CURRENT_URL:"",CURRENT_TITLE:"",QUEUE_DELAY_COUNT:0,COMPANY_ID:b.companyId};e.FILE_UPLOAD=e.APP_URL+"nx/upload",e.FILE_FRAME=e.APP_URL+"chat/upload.html",e.RATE_URL=e.APP_URL+"nx/rate";try{localStorage.getItem("rhlp.debug")&&(e.DEBUG=!0)}catch(c){}return e.getImageUrl=function(a){var b=["Ava_default.png","Ava_man_1.jpg","Ava_woman_1.jpg","Ava_def_man.png","Ava_man_2.jpg","Ava_woman_2.jpg","Ava_def_woman.png","Ava_man_3.jpg","Ava_woman_3.jpg"];return-1!==b.indexOf(a)?e.APP_URL+"container/images/common/avatar/"+a:e.DATA_URL+"/images/"+a},e.empty=function(a){return void 0===a||""===a||"number"==typeof a&&isNaN(a)||null===a},Number.prototype.toVisitorJid=function(){return this+"@visitor."+e.XMPP_DOMAIN},String.prototype.toVisitorJid=function(){return this+"@visitor."+e.XMPP_DOMAIN},String.prototype.toOperatorJid=function(){return this.split("@")[0]+"@operator."+e.XMPP_DOMAIN},String.prototype.extractNode=function(){var a=this.indexOf("@");return a>-1?this.slice(0,a):this},e}),redhelper.define("common/constants/chatState",{MINIMIZED:0,INVITATION:1,MAXIMIZED:2,WINDOW:3}),redhelper.define("common/constants/chatWindowStage",{UNKNOWN:-1,OFFLINE_FORM:0,ONLINE:1,DEPARTMENTS:2}),redhelper.define("common/communication/messageTarget",["common/extensions/jquery.plugins","common/application/eventTarget","common/communication/encoder","common/extensions/debug"],function(a,b,c,d){function e(){this._dispatcher=new b("MessageTarget"),this._fireCounter=1;var a=[],c=!1;this.queueMessage=function(b,c){a.push({type:b,obj:c})},this.startMessaging=function(){c=!0;for(var b=0,d=a.length;d>b;b++)this.send(a[b].type,a[b].obj)},this.isAllowed=function(){return c},this.allow=function(){c=!0}}return e.prototype={init:function(b,c,e,f){this._targetUri=e,this._targetWindow=b,this._origin=c,f&&this.allow();var g=this;try{a.receiveMessage(function(a){g._handle(a)})}catch(h){d.error(h)}},_handle:function(a){try{if("string"!=typeof a.data||-1===a.data.indexOf("__rh__"))return}catch(b){return void d.log(b)}var e=c.parse(a.data.replace("__rh__",""));if(e._messageType)if(e.isMessageTarget=!0,e._messageId){var f=this;this._dispatcher.fire(e._messageType,{type:e._messageType,obj:e},function(){f.send("msg-handlers-completed-"+e._messageId)})}else this._dispatcher.fire(e._messageType,{type:e._messageType,obj:e})},setOrigin:function(a){this._origin=a},addHandler:function(a,b){this._dispatcher.addEventListener(a,function(a){b(a.obj)})},removeHandler:function(a,b){this._dispatcher.removeEventListener(a,b)},removeHandlers:function(a){this._dispatcher.removeAllEventListeners(a)},send:function(b,d,e){if(!this.isAllowed())return void this.queueMessage(b,d);if("undefined"==typeof d?d={}:"function"==typeof d&&"undefined"==typeof e?(e=d,d={}):"object"!=typeof d&&(d={value:d}),d._messageType=b,"function"==typeof e){d._messageId=this._fireCounter++;var f=this,g=function(){f.removeHandlers("msg-handlers-completed-"+d._messageId),e()};this.addHandler("msg-handlers-completed-"+d._messageId,g)}var h="__rh__"+c.serialize(d);a.postMessage(this._targetWindow,h,this._origin,this._targetUri)}},e}),redhelper.define("application/parent",["common/communication/messageTarget","config/setup"],function(a,b){var c=new a;return b.STANDALONE||(c.init(parent,b.PARENT_URL,b.PARENT_URI,!0),c.startMessaging()),c}),redhelper.define("application/session.objects",["application/dispatcher","common/application/session","config/setup","common/constants/scope","common/constants/type","common/constants/chatState","common/constants/chatWindowStage","common/extensions/jquery.plugins","application/parent"],function(a,b,c,d,e,f,g,h,i){var j={activeSalesShown:{type:e.BOOLEAN,value:!1,scope:d.STORAGE,priority:"internal"},allowed:{type:e.BOOLEAN,scope:d.STORAGE,value:!0},audioEnabled:{value:!0,type:e.BOOLEAN,scope:d.STORAGE,priority:"internal"},badge:{value:"badge1.png",scope:d.LOCAL},badgeColor:{},badgeFontSize:{type:e.INTEGER,value:0},badgePadding:{type:e.INTEGER,value:0},badgePosition:{value:"left",scope:d.LOCAL},badgeText:{},badgeX:{value:"70%"},badgeY:{value:"40%"},byEnter:{value:!1,type:e.BOOLEAN},cachedEvent:{},chatColor:{},chatHeight:{type:e.INTEGER,fallback:"defaultChatHeight"},chatIntensity:{},chatStarted:{value:"",scope:d.STORAGE,priority:"internal"},chatState:{type:e.INTEGER,value:f.MINIMIZED},chatWidth:{type:e.INTEGER,fallback:"defaultChatWidth"},chatWindowStage:{type:e.INTEGER,scope:d.STORAGE,priority:"internal",value:g.UNKNOWN},chatX:{type:e.INTEGER},chatY:{type:e.INTEGER},chosenOperators:{},city:{scope:d.SESSION},city_ru:{scope:d.SESSION},cloneSession:{type:e.BOOLEAN},companyId:{type:e.INTEGER,value:0},compress:{type:e.BOOLEAN,value:!1},contactsGot:{type:e.BOOLEAN,scope:d.STORAGE},country:{scope:d.SESSION},country_ru:{scope:d.SESSION},currentChatHeight:{type:e.INTEGER},currentChatWidth:{type:e.INTEGER},currentChatX:{type:e.INTEGER},currentChatY:{type:e.INTEGER},currentDepartment:{type:e.INTEGER,value:0,scope:d.STORAGE,priority:"internal"},currentDepartmentName:{scope:d.STORAGE},currentFirstMessage:{},currentHeader:{},currentOfflineHeader:{},currentOfflineText:{},currentOperator:{scope:d.STORAGE,priority:"internal"},currentOperAvatar:{scope:d.SESSION},currentTopText:{},currentTypedText:{},customFields:{scope:d.SESSION},customName:{scope:d.STORAGE},defaultChatHeight:{type:e.INTEGER,value:420},defaultChatWidth:{type:e.INTEGER,value:300},defaultFace:{},defaultHeader:{},defaultText:{},defaultWelcome:{},departments:{type:e.OBJECT,value:[]},departmentsShown:{scope:d.STORAGE,type:e.BOOLEAN},departmentsType:{},disableCobrowse:{type:e.BOOLEAN,value:!1},disableForms:{type:e.BOOLEAN,value:!1},extraAuth:{value:""},firstMessage:{},free:{value:!1,type:e.BOOLEAN},hideLeaveContacts:{type:e.BOOLEAN,scope:d.STORAGE},holdMessage:{type:e.OBJECT,value:{}},invitationsShown:{value:0,type:e.INTEGER,priority:"internal",scope:d.STORAGE},inviteState:{value:"none",priority:"internal"},ip:{scope:d.STORAGE},isCloneSessionActive:{type:e.BOOLEAN,scope:d.STORAGE},isOnline:{type:e.BOOLEAN},isPartiallyOnline:{type:e.BOOLEAN,value:!1},isSendMouseActive:{type:e.BOOLEAN,value:!1,scope:d.STORAGE},jid:{scope:d.STORAGE},lastActivity:{type:e.INTEGER,scope:d.STORAGE},lastChat:{type:e.INTEGER,value:0,scope:d.STORAGE,priority:"internal"},lastInvitationTime:{scope:d.STORAGE,priority:"interval",type:e.INTEGER},lastMessageFrom:{scope:d.STORAGE},lastMessageTime:{scope:d.STORAGE,priority:"internal"},lastMouseOperator:{scope:d.STORAGE,priority:"internal"},lastOperatorChat:{type:e.INTEGER,scope:d.STORAGE},lastVisit:{value:"1/1/2000",scope:d.STORAGE},lastVisitTime:{type:e.INTEGER,value:0,scope:d.STORAGE},lastXMPPTransfer:{type:e.INTEGER,scope:d.STORAGE},leaveContactsSuggestions:{type:e.OBJECT},locale:{scope:d.STORAGE},messageQueue:{type:e.OBJECT,scope:d.STORAGE,value:[]},mouseOperators:{scope:d.STORAGE,priority:"internal"},offlineEnabled:{type:e.BOOLEAN,value:!0,scope:d.STORAGE},offlineFields:{value:["name","email","message"],type:e.OBJECT},offlineHeader:{},offlineText:{},onlineOperators:{value:[],type:e.OBJECT},openApi:{type:e.BOOLEAN,value:!0},operatorRates:{value:{},type:e.OBJECT,scope:d.STORAGE},operAvatar:{scope:d.STORAGE,fallback:"defaultFace"},operDisplayName:{scope:d.STORAGE},preferredOperator:{value:""},preferredOperatorError:{value:""},previousDay:{value:"1/1/2000",scope:d.STORAGE},previousOperator:{},rateEnabled:{type:e.BOOLEAN},realDepartment:{type:e.INTEGER,value:0,scope:d.STORAGE,priority:"internal"},reconnecting:{value:!1,type:e.BOOLEAN},reconnects:{type:e.INTEGER,value:0},referrer:{scope:d.STORAGE,priority:"internal"},referrerStored:{scope:d.STORAGE,priority:"internal",type:e.BOOLEAN,value:!1},region:{scope:d.SESSION},requiredOperator:{value:""},responsible:{type:e.OBJECT,value:[]},rid:{value:0,type:e.INTEGER,priority:"internal",scope:d.STORAGE},sessionViewers:{type:e.OBJECT,value:[]},showHoldMessage:{type:e.BOOLEAN,scope:d.STORAGE,value:!1},showLeaveContacts:{type:e.BOOLEAN,scope:d.STORAGE},sid:{value:"",priority:"internal",scope:d.STORAGE},siteVisitLastTime:{value:0,type:e.INTEGER,priority:"internal",scope:d.STORAGE},skin:{},stringChatState:{scope:d.STORAGE,priority:"internal",value:"browse"},time:{type:e.INTEGER,value:0},trigger:{scope:d.STORAGE,priority:"internal"},userLocale:{value:""},vid:{scope:d.STORAGE,type:e.INTEGER,priority:"internal"},viewedPages:{type:e.INTEGER,value:0,scope:d.STORAGE,noNaN:!0},visits:{type:e.INTEGER,value:0,scope:d.STORAGE}},k=c.CLIENT_NAME+(c.COMPANY_ID?"."+c.COMPANY_ID:"");
c.STANDALONE?b.init(k,j):(b.attachTo(i,j,"internal"),b.init(k,j),-1!==c.COMPANY_ID&&b.sendRequest());var l=function(a){b.dispatcher.addEventListener("on"+a.charAt(0).toUpperCase()+a.substr(1)+"Changed",function(){h("span.redhlp_"+a).html(b[a])})};for(var m in j)j.hasOwnProperty(m)&&l(m);return b.dispatcher.addEventListener("onVidChanged",function(){h(".redhlp_code").text((b.vid+"").substr((b.vid+"").length-4))}),h(".redhlp_code").text((b.vid+"").substr((b.vid+"").length-4)),b}),redhelper.define("application/distribution",["application/dispatcher","application/session.objects","common/constants/chatWindowStage"],function(a,b,c){var d={isOperatorOnline:function(a){for(var c=b.onlineOperators,d=0,e=c.length;e>d;d++)if(c[d].name===a)return"offline"!==c[d].status;return!1},isDepartmentOnline:function(a,c){c||(c="");for(var d=b.onlineOperators,e=0,f=d.length;f>e;e++)if("offline"!==d[e].status&&(d[e].onPage||d[e].name===c))for(var g=0,h=d[e].departments.length;h>g;g++)if(d[e].departments[g]===a)return!0;return!1},initializeChatWindowStage:function(){var e=b.currentOperator||"",f=b.currentDepartment;e&&"-"!=e&&d.isOperatorOnline(e)?b.chatWindowStage=c.ONLINE:f&&d.isDepartmentOnline(f,e)?(b.currentOperator&&"-"!=b.currentOperator||(b.currentOperator="",a.fire("refreshOperator")),b.chatWindowStage=c.ONLINE):b.chatWindowStage=b.isOnline?c.ONLINE:c.OFFLINE_FORM}};return d}),redhelper.define("config/api",["common/communication/encoder","application/dispatcher"],function(a,b){var c={};try{c=a.decompress(location.hash.split("#")[1]).settings}catch(d){}var e,f,g=[],h=!1;c.waitForTemplate=function(a){return h?void a():void("function"==typeof a&&g.push(a))},b.addEventListener("templateProcessed",function(){for(e=0,f=g.length;f>e;e++)g[e]()});var i=function(){h=!0};return b.addEventListener("templateReceived",i),c}),redhelper.define("locales",{enabled:["az","de","dk","ee","en","es","fa","fi","hu","it","kk","lt","lv","md","pl","ru","sk","uk","zh"],locales:{az:{CHAT_LABEL:"Mətni buraya daxil edin...",YOU_LABEL:"Siz",EMAIL_INCORRECT:"Siz mövcud olmayan e-mail daxil etmisiniz",FAILED_TO_SEND:"Mətni göndərmək mümkün olmadı",INCORRECT_EMAIL:"Email adresi düzgün deyil",NOT_ALL_FIELDS:"Siz bütün xanaları doldurmamısınız",MAIL_SUCCESS:"Mesajınız uğurla göndərildi",MAIL_SENT:"Mesajınız göndərildi",SEND_BUTTON:"Göndər",THROBBER:"Göndərilir...",MESSAGE_LABEL:"Mesajınız:",EMAIL_LABEL:"Sizin e-mail:",NAME_LABEL:"Adınız:",OFFLINE_HEADER:"Offline əlaqə forması",OFFLINE_TEXT:"Hal hazırda bütün operatorlar xətdə deyillər. Lütfən siz öz mesajınızı formadan istifadə edərək göndərin. Yaxın zamanda sizinlə əlaqə saxlanılacaqdır.",PAGE_TITLE:"Online Məsləhətçi",URL_NEW_TAB:"ayrı bir səhifədə",TITLE_NEW_TAB:"ayrı bir səhifədə",WEBSITE:"http://redhelper.ru",TYPING_LABEL:"cavab yazır",PROMPT_LABEL:"Operator sizə digər səhifəyə keçməyi təklif edir. Keçək?",PROMPT_BUTTON_YES:"Bəli",PROMPT_BUTTON_NO:"Xeyir",NOTIFICATION_HEADER:"Operatorun mesaji",OPERATOR_REDIRECT:"Operator çatı digər operatora yönləndirir",OPERATOR_REDIRECT_OK:"Sizə xidmət edən operator",OPERATOR_CONNECTING:"Sizə operator bağlanır, lütfən gözləyin",NO_PREFERRED_OPERATOR:"Hal hazırdakı operator yerində deyil, siz digər operatora bağlandınız",TOO_LONG:"Mətndə icazə verilən maksimal simvol sayı həddinə çatıb",PHONE_LABEL:"Sizin telefon:",PHONE_MESSAGE:"Telefon",INCORRECT_PHONE:"Telefon formatı düzgün deyil",ALL_OFFLINE:"Bütün operatorlar xətdə deyillər",LEAVE_MESSAGE:"Məktub yaz",DEFAULT_FIRST_MESSAGE:"Salam, Sizə necə kömək edə bilərəm?",COPYRIGHT:"online məsləhətçi",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"Faylı göndərmək üçün buraya dartıb atın",FILE_SENT_OPERATOR:"Sizə göndərilən fayl:",FILE_SENT_VISITOR:"Siz fayl göndərdiniz:",FILE_UPLOAD:"<span>Fayl Yüklə</span> (və ya faylı çat qutusuna atın)",UPLOAD_LEGEND:"Fayl mübadiləsi",UPLOAD_ERROR:"Fayl yükləmə xətası - faylın həcmi böyükdür",UPLOAD_ERROR_TYPE:"Fayl yükləmə xətası - bü növ fayllar dəstəklənmir",UPLOAD_ERROR_UNKNOWN:"Bilinməyən yükləmə xətası. Lütfən bir daha yoxlayınız",BACK_TO_CONVERSATION:"Yazışmaya qayıtmaq",BACK_TO_OFFLINE:"Ofline formaya qayıtmaq",CHOOSE_DEPARTMENT:"Müraciət etmək istədiyiniz bölməni seçiniz:",DEPARTMENTS_BUTTON:"Bölməni seçiniz",CHOOSE_DEPARTMENT_TITLE:"Bölməni seçmək",CHAT_SEND_TITLE:"Mesajı göndər",FILE_SEND_TITLE:"Faylı göndər",RATE_TITLE:"Operatoru qiymətləndir",HOLD_MESSAGE:"Lütfən gözləyin, operator sizə tezliklə cavab yazacaq",LEAVE_CONTACTS:"Operator cavab vermir. Lütfən öz əlaqə vasitələrinizi bizə göndərin. Sizinlə tezliklə əlaqə saxlanılacaq.",PHONE:"Telefon",EMAIL:"e-mail",NAME:"Ad",CONTACTS_SUCCESS:"Təşəkür edirik. Bizim nümayəndə sizinlə əlaqə saxlayacaq.",INCORRECT_CONTACTS:"Məlumatların düzgünlüyünü yoxlayın",OPERATOR:"Operator"},de:{CHAT_LABEL:"Geben Sie hier Ihre Nachricht ein",YOU_LABEL:"Sie",EMAIL_INCORRECT:"Die  E-Mail-Adresse, die Sie eingegeben haben, ist ungültig",FAILED_TO_SEND:"Ihre Nachricht wurde nicht gesendet",INCORRECT_EMAIL:"Ihr email ist nicht korrekt",NOT_ALL_FIELDS:"Füllen Sie, bitte, alle Felder aus",MAIL_SUCCESS:"Ihre Nachricht wurde erfolgreich gesendet",MAIL_SENT:"Die Nachricht wurde gesendet",SEND_BUTTON:"Senden",THROBBER:"Bitte warten...",MESSAGE_LABEL:"Ihre Nachricht",EMAIL_LABEL:"Ihr E-mail",NAME_LABEL:"Ihr Name",OFFLINE_HEADER:"Feedbackformular",OFFLINE_TEXT:"Wir sind momentan nicht erreichbar. Geben Sie hier Ihre Nachricht ein und wir beantworten sie per E-Mail.",PAGE_TITLE:"Onlineberater",URL_NEW_TAB:"In einem separaten Tabulator",TITLE_NEW_TAB:"In einem separaten Tabulator",WEBSITE:"http://redhelper.com",TYPING_LABEL:"schreibt",PROMPT_LABEL:"Berater möchte Sie auf eine  andere  Seite  weiterleiten, erlauben Sie?",PROMPT_BUTTON_YES:"Ja",PROMPT_BUTTON_NO:"Nein",NOTIFICATION_HEADER:"Nachricht von dem Berater",OPERATOR_REDIRECT:"Berater möchte Sie an einen anderen Berater weiterleiten",OPERATOR_REDIRECT_OK:"Sie stehen mit dem Berater in Verbindung",OPERATOR_CONNECTING:"Wir leiten Sie  an einen Berater weiter. Warten Sie bitte",NO_PREFERRED_OPERATOR:"Ihr Berater ist nicht erreichbar, wir leiten Sie weiter, warten Sie bitte",TOO_LONG:"Maximale Länge der Nachricht ist überschritten",PHONE_LABEL:"Ihr Telefon",PHONE_MESSAGE:"Telefon",INCORRECT_PHONE:"Die Telefonnummer ist nicht korrekt",ALL_OFFLINE:"Alle Berater sind momentan nicht erreichbar",LEAVE_MESSAGE:"Hier eine Nachricht eingeben",DEFAULT_FIRST_MESSAGE:"Guten Tag! Kann ich Ihnen helfen?",COPYRIGHT:"Berater von",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"Um eine Datei zu senden, ziehen Sie sie hierher",FILE_SENT_OPERATOR:"Datei wurde an Sie gesendet:",FILE_SENT_VISITOR:"Sie haben eine Datei gesendet:",FILE_UPLOAD:"<span>Datei hochladen</span> (oder ziehen Sie sie ins Dialogfenster)",UPLOAD_LEGEND:"Hochladen der Datei",UPLOAD_ERROR:"Fehler beim Hochladen. Datei ist zu groß",UPLOAD_ERROR_TYPE:"Fehler beim Hochladen. Dateityp wird nicht unterstützt",UPLOAD_ERROR_UNKNOWN:"Ein unbekannter Fehler beim Hochladen der Daten. Bitte probieren Sie noch einmal",BACK_TO_CONVERSATION:"Zurück zum Dialog",BACK_TO_OFFLINE:"Zurück zum Feedbackformular",CHOOSE_DEPARTMENT:"Wählen Sie eine Abteilung, woran Sie sich wenden möchten:",DEPARTMENTS_BUTTON:"Wählen Sie eine Abteilung",HOLD_MESSAGE:"Bitte warten Sie, ein Betreiber werden Sie bald beantworten",LEAVE_CONTACTS:"Bediener nicht beantworten, lassen Sie Ihre Kontaktdaten und wir werden Sie umgehend kontaktieren.",PHONE:"Telefon",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",EMAIL:"e-mail",NAME:"Name",CONTACTS_SUCCESS:"Vielen Dank, unsere Mitarbeiter werden Sie umgehend kontaktieren.",INCORRECT_CONTACTS:"Bitte überprüfen Sie Ihre Eingabe",OPERATOR:"Bediener"},dk:{CHAT_LABEL:"Skriv venligst din meddelelse her",YOU_LABEL:"Dig",EMAIL_INCORRECT:"Fejl i den indtastede e-mail adresse",FAILED_TO_SEND:"Meddelelsen blev ikke sendt",INCORRECT_EMAIL:"The email is incorrect",NOT_ALL_FIELDS:"Udfyld venligst alle felter",MAIL_SUCCESS:"Din meddelelse er blevet sendt",MAIL_SENT:"Din meddelelse er blevet sendt",SEND_BUTTON:"Send",THROBBER:"Vent venligst",MESSAGE_LABEL:"Meddelelse",EMAIL_LABEL:"Din e-mail",NAME_LABEL:"Dit navn",OFFLINE_HEADER:"Feedback form",OFFLINE_TEXT:"Vi er desv?rre ikke online i ojeblikket. Efterlad en besked og vi svarer tilbage pa e-mail",PAGE_TITLE:"Live Chat",URL_NEW_TAB:"in a separate tab",TITLE_NEW_TAB:"in a separate tab",WEBSITE:"http://redhelper.com",TYPING_LABEL:" skriver",PROMPT_LABEL:"'Du bliver nu stillet videre til en ny side. Tillad'",PROMPT_BUTTON_YES:"Ja",PROMPT_BUTTON_NO:"Nej",NOTIFICATION_HEADER:"Besked fra operator",OPERATOR_REDIRECT:"Operator wants to switch you",OPERATOR_REDIRECT_OK:"Du chatter nu med",OPERATOR_CONNECTING:"Operator logger pa, vent venligst",NO_PREFERRED_OPERATOR:"Denne operator er desv?rre optaget. Stiller om til anden",TOO_LONG:"Maxl?ngde pa beskeden er overskredet",LEAVE_MESSAGE:"Efterlade en besked",DROP_HERE:"Træk og slip filer her",FILE_UPLOAD:"Hent filen (eller trække en fil til chat)",UPLOAD_LEGEND:"Hent fil",UPLOAD_ERROR:"Upload fejl - filen for stor",UPLOAD_ERROR_TYPE:"Upload fejl - filtype understøttes ikke",UPLOAD_ERROR_UNKNOWN:"Ukendt upload fejl",BACK_TO_CONVERSATION:"Tilbage til samtale",BACK_TO_OFFLINE:"Back to offline formular",CHOOSE_DEPARTMENT:"Vælg den sektion, hvor du ønsker at anvende",DEPARTMENTS_BUTTON:"Vælg afdeling",CHOOSE_DEPARTMENT_TITLE:"Vælg afdeling",CHAT_SEND_TITLE:"Send besked",FILE_SEND_TITLE:"Send fil",RATE_TITLE:"Rate operatør",HOLD_MESSAGE:"Vent venligst, en operatør vil svare dig hurtigt",LEAVE_CONTACTS:"operatør ikke svarer, forlade din kontakt, og vi vil kontakte dig snarest.",PHONE:"Telephone",PHONE_LABEL:"Telephone",PHONE_MESSAGE:"Telephone",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",EMAIL:"e-mail",NAME:"Navn",CONTACTS_SUCCESS:"Tak, vores personale vil kontakte dig snarest.",INCORRECT_CONTACTS:"Kontroller din indtastning",OPERATOR:"Operatør"},ee:{CHAT_LABEL:"Sisestage oma sõnum siia",YOU_LABEL:"Teie",EMAIL_INCORRECT:"Sisestatud e-postiaadress pole õige",FAILED_TO_SEND:"Sõnumi saatmine ebaõnnestus",INCORRECT_EMAIL:"Sisestatud mailiaadress pole korrektne",NOT_ALL_FIELDS:"Osad väljad on täitmata",MAIL_SUCCESS:"Teie sõnum saadeti ära",MAIL_SENT:"Sõnum on saadetud",SEND_BUTTON:"Saada",THROBBER:"Palun oodake...",MESSAGE_LABEL:"Sõnum",EMAIL_LABEL:"Teie e-postiaadress",NAME_LABEL:"Teie nimi",OFFLINE_HEADER:"Tagasiside vorm",OFFLINE_TEXT:"Me oleme hetkel offlainis. Palun jätke meile sõnum ja me vastame teile e-kirjaga.",PAGE_TITLE:"Vestlus",URL_NEW_TAB:"teisel vahelehel",TITLE_NEW_TAB:" teisel vahelehel",WEBSITE:"http://redhelper.com",TYPING_LABEL:" kirjutab",PROMPT_LABEL:"Operaator suunab teid teisele lehele. Kas lubate?",PROMPT_BUTTON_YES:"Jah",PROMPT_BUTTON_NO:"Ei",NOTIFICATION_HEADER:"Sõnum operaatorilt",OPERATOR_REDIRECT:"Operaator tahab teid ümber suunata",OPERATOR_REDIRECT_OK:"Te vestlete praegu",OPERATOR_CONNECTING:"Operaator võtab ühendust, palun oodake",NO_PREFERRED_OPERATOR:"Praegune operaator pole kättesaadav, valige mõni teine",TOO_LONG:"Sõnumi maksimumpikkus on ületatud",PHONE_LABEL:"Teie telefoninumber",PHONE_MESSAGE:"Telefoninumber",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",INCORRECT_PHONE:"Teie telefoninumber pole õige",ALL_OFFLINE:"Operaatorid on offlainis",LEAVE_MESSAGE:"Jätke sõnum",DEFAULT_FIRST_MESSAGE:"Tere! Kuidas ma saan teid aidata?",COPYRIGHT:"powered by",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"Lohistage fail siia",FILE_SENT_OPERATOR:"Teile saadetud fail:",FILE_SENT_VISITOR:"Teie saadetud fail:",FILE_UPLOAD:"Laadi fail üles (või lohista see vestlusaknasse)",UPLOAD_LEGEND:"Faili üleslaadimine",UPLOAD_ERROR:" Üleslaadimisviga – fail on liiga suur",UPLOAD_ERROR_TYPE:"Üleslaadimisviga – failitüüp pole toetatud",UPLOAD_ERROR_UNKNOWN:"Tundmatu üleslaadimise viga. Proovi uuesti",BACK_TO_CONVERSATION:"Tagasi vestlus",BACK_TO_OFFLINE:"Tagasi offline vorm",CHOOSE_DEPARTMENT:"Valige lõik, milles soovite taotleda",DEPARTMENTS_BUTTON:"Vali osakond",CHOOSE_DEPARTMENT_TITLE:"Vali osakond",CHAT_SEND_TITLE:"Saada sõnum",FILE_SEND_TITLE:"Saada fail",RATE_TITLE:"Hinda käitaja",HOLD_MESSAGE:"Palun oota, operaator vastab sulle varsti",LEAVE_CONTACTS:"operaator ei vasta, jätke oma kontaktandmed ning me võtame teiega peagi ühendust.",PHONE:"Telefon",EMAIL:"e-mail",NAME:"Nimi",CONTACTS_SUCCESS:"Tänan teid, meie töötajad võtame teiega peagi ühendust.",INCORRECT_CONTACTS:"Palun kontrollige oma panuse",OPERATOR:"Operaator"},en:{CHAT_LABEL:"Type your message here",YOU_LABEL:"You",EMAIL_INCORRECT:"The email you specified is incorrect",FAILED_TO_SEND:"Failed to send message",INCORRECT_EMAIL:"The email is incorrect",NOT_ALL_FIELDS:"Not all fields filled",MAIL_SUCCESS:"Your message has been sent successfully",MAIL_SENT:"The message has been sent",SEND_BUTTON:"Send",THROBBER:"Wait please...",MESSAGE_LABEL:"Message",EMAIL_LABEL:"E-mail",NAME_LABEL:"Your name",OFFLINE_HEADER:"Feedback form",OFFLINE_TEXT:"We are offline at the moment. Please leave a message and we will answer it by email.",PAGE_TITLE:"Live Chat",URL_NEW_TAB:"in a separate tab",TITLE_NEW_TAB:"in a separate tab",WEBSITE:"http://redhelper.com",TYPING_LABEL:" is typing",PROMPT_LABEL:"'Operator wants to redirect you to another page. Allow?'",PROMPT_BUTTON_YES:"Yes",PROMPT_BUTTON_NO:"No",NOTIFICATION_HEADER:"Message from operator",OPERATOR_REDIRECT:"Operator wants to switch you",OPERATOR_REDIRECT_OK:"You are now chatting with ",OPERATOR_CONNECTING:"Operator is connecting, please wait",NO_PREFERRED_OPERATOR:"Current operator is unavailable, connected to another",TOO_LONG:"Maximum message length exceed",PHONE_LABEL:"Phone",PHONE_MESSAGE:"Phone",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",INCORRECT_PHONE:"The phone is incorrect",ALL_OFFLINE:"Operators offline",LEAVE_MESSAGE:"Leave message",DEFAULT_FIRST_MESSAGE:"Hello! How can I help you?",COPYRIGHT:"powered by",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"Drop file here",FILE_SENT_OPERATOR:"Sent file to you:",FILE_SENT_VISITOR:"You sent file:",FILE_SENT_DOWNLOAD:"Download the file",MOVE_TO_DEPARTMENTS:"Choose another department",FILE_UPLOAD:"<span>Upload a file</span> (or drag it into chat)",UPLOAD_LEGEND:"Uploading file",UPLOAD_ERROR:"Upload error - file too large",UPLOAD_ERROR_TYPE:"Upload error - file type not supported",UPLOAD_ERROR_UNKNOWN:"Unknown upload error. Try again",BACK_TO_CONVERSATION:"Back to conversation",BACK_TO_OFFLINE:"Back to offline form",CHOOSE_DEPARTMENT:"Please choose department:",DEPARTMENTS_BUTTON:"Choose department",CHOOSE_DEPARTMENT_TITLE:"Choose department",CHAT_SEND_TITLE:"Send message",FILE_SEND_TITLE:"Send file",RATE_TITLE:"Rate operator",HOLD_MESSAGE:"Please wait, operator will answer you as soon as possible",LEAVE_CONTACTS:"Operator is not responding, please leave your contacts",PHONE:"Phone",EMAIL:"e-mail",NAME:"Name",CONTACTS_SUCCESS:"Thank you, our manager will contact you soon",INCORRECT_CONTACTS:"Please check highlighted fields",OPERATOR:"Operator"},fa:{CHAT_LABEL:"پيغامتان را اينجا تايپ کنيد",YOU_LABEL:" شما",EMAIL_INCORRECT:" ایمیلی که وارد کرده اید اشتباه است",FAILED_TO_SEND:" “ارسال ناموفق پیغام",INCORRECT_EMAIL:"ایمیل اشتباه است",NOT_ALL_FIELDS:"همه گزینه ها پر نشده است",MAIL_SUCCESS:"ایمیل شما با موفقیت ارسال شد",MAIL_SENT:"پیغام فرستاده شد",SEND_BUTTON:"ارسال",THROBBER:"لطفا صبر کنید ...",MESSAGE_LABEL:"پیغام:",EMAIL_LABEL:"ایمیل شما:",NAME_LABEL:"نام شما",OFFLINE_HEADER:"فرم نظرسنجی",OFFLINE_TEXT:"در حال حاضر در دسترس نیستیم. لطفا پیغام خود را بگذارید ما از طریق ایمیل به شما پاسخ خواهیم داد",PAGE_TITLE:"چت آنلاین",URL_NEW_TAB:"در یک تب جداگانه",TITLE_NEW_TAB:" در یک تب جداگانه",WEBSITE:"http://redhelper.com",TYPING_LABEL:"در حال تایپ",PROMPT_LABEL:"'اجازه می دهید اپراتور شما را به صفحه دیگری منتقل کند؟'",PROMPT_BUTTON_YES:"بله",PROMPT_BUTTON_NO:"خیر",NOTIFICATION_HEADER:"پیغام از اپراتور ",OPERATOR_REDIRECT:"اپراتور می خواهد شما را جابه جا کند",OPERATOR_REDIRECT_OK:"شما در حال چت با",OPERATOR_CONNECTING:"اپراتور در حال اتصال است، لطفا صبر کنید",NO_PREFERRED_OPERATOR:"اپراتور فعلی در دسترس نیست، به اپراتور دیگر وصل شوید",TOO_LONG:"طول پیام از حد مجاز بیش تر شده است ",PHONE_LABEL:"شماره تلفن شما:",PHONE_MESSAGE:"تلفن",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",INCORRECT_PHONE:"شماره تلفن صحیح نمی باشد",ALL_OFFLINE:"اپراتورها افلاین هستند",LEAVE_MESSAGE:"پیغام بگذارید",DEFAULT_FIRST_MESSAGE:"سلام، چه کمکی می توانم به شما بکنم؟",COPYRIGHT:"طراحی شده توسط",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"فایل را اینجا بگذارید",FILE_SENT_OPERATOR:"فایلی برای شما ارسال شد:",FILE_SENT_VISITOR:"شما فایلی را ارسال کردید:",FILE_UPLOAD:"<span>یک فایل بارگذاری کنید</span> (یا آن را داخل چت بگذارید)",UPLOAD_LEGEND:"بارگذاری فایل",UPLOAD_ERROR:"خطای بارگذاری- فایل خیلی بزرگ است",UPLOAD_ERROR_TYPE:"خطای بارگذاری- نوع فایل پشتیبانی نمی شود",UPLOAD_ERROR_UNKNOWN:"خطای ناشناخته بارگذاری. دوباره تلاش کنید",BACK_TO_CONVERSATION:"بازگشت به مکالمه",BACK_TO_OFFLINE:"بازگشت به فرم آفلاین",CHOOSE_DEPARTMENT:"لطفا گروه را انتخاب کنید",DEPARTMENTS_BUTTON:"انتخاب گروه",CHOOSE_DEPARTMENT_TITLE:"انتخاب گروه",CHAT_SEND_TITLE:"ارسال پیام",FILE_SEND_TITLE:"ارسال فایل",RATE_TITLE:"اپراتور امتیاز",RTL:"RTL",OPERATOR:""},es:{CHAT_LABEL:"Escriba un mensaje...",YOU_LABEL:"Usted",EMAIL_INCORRECT:"El correo electrónico especificada no es correcto",FAILED_TO_SEND:"No se pudo enviar mensaje",INCORRECT_EMAIL:"El correo electrónico no es correcto",NOT_ALL_FIELDS:"Hay campos sin rellenar",MAIL_SUCCESS:"Tu mensaje ha sido enviado",MAIL_SENT:"El mensaje ha sido enviado",SEND_BUTTON:"Enviar",THROBBER:"Envío...",MESSAGE_LABEL:"Mensaje",EMAIL_LABEL:"Email",NAME_LABEL:"Nombre",OFFLINE_HEADER:"Formulario de contacto",OFFLINE_TEXT:"Todos nuestros operadores están actualmente desconectados. Dejar un mensaje y te responderemos en breve.",PAGE_TITLE:"Chat en vivo",URL_NEW_TAB:"en una pestaña independiente",TITLE_NEW_TAB:"en una pestaña independiente",WEBSITE:"http://redhelper.com",TYPING_LABEL:" responde",PROMPT_LABEL:"El operador ofrece ir a otra página. Acceder",PROMPT_BUTTON_YES:"Si",PROMPT_BUTTON_NO:"No",NOTIFICATION_HEADER:"Mensaje del operador",OPERATOR_REDIRECT:"El operador envía el chat a otro operador",OPERATOR_REDIRECT_OK:"Esta conectando el operador",OPERATOR_CONNECTING:"Esta conectando el operador, espera",NO_PREFERRED_OPERATOR:"El actual operador no está, usted se conecta a otro operador",TOO_LONG:"Supera longitud máxima del mensaje",PHONE_LABEL:"Vuestro teléfono",PHONE_MESSAGE:"Teléfono",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",INCORRECT_PHONE:"Formato de número no válido",ALL_OFFLINE:"Todos los operadores fuera de línea",LEAVE_MESSAGE:"Publicar un comentario",DEFAULT_FIRST_MESSAGE:"Hola ¿Puedo ayudar?",COPYRIGHT:"consultor online de",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"Para enviar un archivo, arrastre el fichero aquí",FILE_SENT_OPERATOR:"Te envió un archivo:",FILE_SENT_VISITOR:"Usted envía un archivo:",FILE_UPLOAD:"<span>Subir archivo</span> (o arrastrar un archivo en el chat)",UPLOAD_LEGEND:"Subida de archivo",UPLOAD_ERROR:"Error al cargar el archivo - es demasiado grande",UPLOAD_ERROR_TYPE:"Error al cargar el archivo - tipo de archivo no se admite",BACK_TO_CONVERSATION:"Respaldar a la conversación",BACK_TO_OFFLINE:"Realice una copia de forma offline",CHOOSE_DEPARTMENT:"Seleccione la sección en la que desea aplicar",DEPARTMENTS_BUTTON:"Elija departamento",CHOOSE_DEPARTMENT_TITLE:"Escoja departamento",CHAT_SEND_TITLE:"Enviar mensaje",FILE_SEND_TITLE:"Enviar archivo",RATE_TITLE:"Evaluar el operador",HOLD_MESSAGE:"Por favor espere, un operador le contestará en breve",LEAVE_CONTACTS:"operador no responde, deja tu contacto y nos pondremos en contacto con usted en breve.",PHONE:"Teléfono",EMAIL:"e-mail",NAME:"Nombre",CONTACTS_SUCCESS:"Gracias a usted, nuestro personal se comunicará con usted en breve.",INCORRECT_CONTACTS:"Por favor, compruebe su entrada",OPERATOR:"Operador"},fi:{CHAT_LABEL:"Kirjoita viesti...",YOU_LABEL:"Te",EMAIL_INCORRECT:"Annoit olematon e-mail",FAILED_TO_SEND:"Viestin l?hetys ep?onnistui",INCORRECT_EMAIL:"S?hk?postiosoitteen muoto ei kelpaa",NOT_ALL_FIELDS:"Ette t?ytt?nyt kaikki kent?t",MAIL_SUCCESS:"Tejd?n viestinne l?hetetty",MAIL_SENT:"Viesti on l?hetetty",SEND_BUTTON:"L?hett?",THROBBER:"L?hett?...",MESSAGE_LABEL:"Viesti",EMAIL_LABEL:"Teid?n e-mail",NAME_LABEL:"Teid?n nimi",OFFLINE_HEADER:"Palautelomake",OFFLINE_TEXT:"Kaikki operaattorit ovat t?ll? hetkell? kirjautunut. J?t? viesti ja me vastaamme sinulle.",PAGE_TITLE:"Tukineuvoja online tilassa",URL_NEW_TAB:"erillisess? v?lilehdess?",TITLE_NEW_TAB:"erillisess? v?lilehdess?",WEBSITE:"http://redhelper.com",TYPING_LABEL:" vastauksia",PROMPT_LABEL:"Operaattori tarjoaa menn? toiselle sivulle. Menn??",PROMPT_BUTTON_YES:"Kyll?",PROMPT_BUTTON_NO:"Ei",NOTIFICATION_HEADER:"operaattorin viesti",OPERATOR_REDIRECT:"Operaattori l?hett?? chat toiselle operaattorille",OPERATOR_REDIRECT_OK:"operaattori yhdistyy",OPERATOR_CONNECTING:"operaattori yhdistyy, odotaa",NO_PREFERRED_OPERATOR:"Nykyinen operaattori ei ole paikallaan, olet yhteydess? toisen operaattorin",TOO_LONG:"Ylitt?nyt enimm?ispituus viestien l?hett?miseen",PHONE_LABEL:"Teid?n puhelin numero",PHONE_MESSAGE:"puhelin numero",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",INCORRECT_PHONE:"puhelin muoto ei kelpaa",ALL_OFFLINE:"Kaikki operaattorit Ofline",LEAVE_MESSAGE:"J?tt? viestin",DEFAULT_FIRST_MESSAGE:"Hei, voinko auttaa jotenkin?",COPYRIGHT:"Online Konsultti",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"Jos haluat l?hett?? tiedoston, ved? t?h?n",FILE_SENT_OPERATOR:"l?hettin teille tiedoston:",FILE_SENT_VISITOR:"Te l?hettit tiedoston:",FILE_UPLOAD:"<span>Ladatta tiedosaton</span> (tai vet?m?ll? tiedosto chat)",UPLOAD_LEGEND:"ladata tiedosto",UPLOAD_ERROR:"Virhe tiedoston ladattaessa - liian suuri",UPLOAD_ERROR_TYPE:"Virhe tiedoston ladattaessa - tiedostotyyppi? ei tukea",BACK_TO_CONVERSATION:"Takaisin keskusteluun",BACK_TO_OFFLINE:"Takaisin offline muodossa",CHOOSE_DEPARTMENT:"Valitse osio, jonka haluat hakea",DEPARTMENTS_BUTTON:"Valitse osasto",CHOOSE_DEPARTMENT_TITLE:"Valitse osasto",CHAT_SEND_TITLE:"L?het? viesti",FILE_SEND_TITLE:"L?het? tiedosto",RATE_TITLE:"??nest? toimija",HOLD_MESSAGE:"Odota, operaattori vastaa sinulle pian",LEAVE_CONTACTS:"operaattori ei vastaa, j?t? yhteystietosi ja otamme sinuun yhteytt? pian.",PHONE:"Puhelin",EMAIL:"e-mail",NAME:"Nimi",CONTACTS_SUCCESS:"Kiitos, henkil?kunta ottaa sinuun pian yhteytt?.",INCORRECT_CONTACTS:"Tarkista input",OPERATOR:"Operaattori"},hu:{CHAT_LABEL:"Ide írja az üzenetét",YOU_LABEL:"Ön",EMAIL_INCORRECT:"Helytelen e-mail címet adott meg",FAILED_TO_SEND:"Nem sikerült elüldeni az üzenetet",INCORRECT_EMAIL:"Az e-mail cím helytelen",NOT_ALL_FIELDS:"Nincs kitöltve minden mező",MAIL_SUCCESS:"Az üzenetét sikeresen elküldtük",MAIL_SENT:"Az üzenet elküldésre került",SEND_BUTTON:"Küldés",THROBBER:"Kérjük, várjon...",MESSAGE_LABEL:"Üzenet",EMAIL_LABEL:"Az Ön e-mail címe",NAME_LABEL:"Az Ön neve",OFFLINE_HEADER:"Visszajelző",OFFLINE_TEXT:"Jelenleg offline vagyunk. Kérjük, hagyjon egy üzenetet, és e-mailben válaszolunk rá.",PAGE_TITLE:"Éló csevegés",URL_NEW_TAB:"új lapon",TITLE_NEW_TAB:"új lapon",WEBSITE:"http://redhelper.com",TYPING_LABEL:" gépel",PROMPT_LABEL:"'Munkatársunk át szeretné Önt irányítani egy másik weblapra. Megengedi?'",PROMPT_BUTTON_YES:"Igen",PROMPT_BUTTON_NO:"Nem",NOTIFICATION_HEADER:"Üzenet az ügyfélszolgálattól ",OPERATOR_REDIRECT:"Másik munkatárshoz szeretnénk irányítani",OPERATOR_REDIRECT_OK:"Jelenleg a következő munkatársunkkal beszélget: ",OPERATOR_CONNECTING:"A munkatársunk kapcsolódik, türelmét kérjük",NO_PREFERRED_OPERATOR:"Munkatársunk nem elérhető, másik munkatársunkhoz irányítottuk",TOO_LONG:"Az üzenet túl hosszú",PHONE_LABEL:"az Ön telefonszáma",PHONE_MESSAGE:"Telefonszám",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",INCORRECT_PHONE:"A telefonszám helytelen",ALL_OFFLINE:"Munkatársaink nincsenek bejelentkezve",LEAVE_MESSAGE:"Hagyjon üzenetet",DEFAULT_FIRST_MESSAGE:"Üdvözlöm! Miben segíthetek?",COPYRIGHT:"fejlesztette:",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"Ide húzza be a fájlt",FILE_SENT_OPERATOR:"Az Önnek küldött fájl:",FILE_SENT_VISITOR:"Az Ön fájlja:",FILE_UPLOAD:"<span>Fájl feltöltése</span> (vagy húzza be a csevegőablakba)",UPLOAD_LEGEND:"Fájl feltöltése",UPLOAD_ERROR:"Feltöltési hiba - a fájl túl nagy",UPLOAD_ERROR_TYPE:"Feltöltési hiba - a fájltípus nem támogatott",UPLOAD_ERROR_UNKNOWN:"Ismeretlen feltöltési hiba. Próbálja meg újra.",BACK_TO_CONVERSATION:"Vissza a csevegéshez",BACK_TO_OFFLINE:"Vissza az offline űrlaphoz",CHOOSE_DEPARTMENT:"Kérjük, válasszon részleget:",DEPARTMENTS_BUTTON:"Részleg kiválasztása",CHOOSE_DEPARTMENT_TITLE:"Részleg kiválasztása",CHAT_SEND_TITLE:"Üzenet küldése",FILE_SEND_TITLE:"Fájl küldése",RATE_TITLE:"Munkatársunk értékelése",HOLD_MESSAGE:"Please wait, operator will answer you as soon as possible",LEAVE_CONTACTS:"Operator is not responding, please leave your contacts",PHONE:"Telefonszám",EMAIL:"e-mail",NAME:"Name",CONTACTS_SUCCESS:"Thank you, our manager will contact you soon",INCORRECT_CONTACTS:"Please check highlighted fields",OPERATOR:"Operátor"},it:{CHAT_LABEL:"Scrivere messaggio",YOU_LABEL:"Lei",EMAIL_INCORRECT:"Ha inserito una e-mail inesistente",FAILED_TO_SEND:"Il messaggio non e' statto inviato",INCORRECT_EMAIL:"E-mail address e' sbagliato",NOT_ALL_FIELDS:"Non ha compilato tutti i campi",MAIL_SUCCESS:"Il suo messaggio e' stato inviato",MAIL_SENT:"Il messaggio e' stato inviato",SEND_BUTTON:"Inviare",THROBBER:"Invio",MESSAGE_LABEL:"Messaggio",EMAIL_LABEL:"E-mail",NAME_LABEL:"Nome",OFFLINE_HEADER:"Modulo di contatto",OFFLINE_TEXT:"Tutti i nostri assistenti sono offline. Lasci un messaggio e le risponderemo al piu' presto",PAGE_TITLE:"Consulente online",URL_NEW_TAB:"In una nuova finestra",TITLE_NEW_TAB:"In una nuova finestra",WEBSITE:"http://redhelper.com",TYPING_LABEL:" risponde",PROMPT_LABEL:"L'assistente chiede di aprire una nuova finestra",PROMPT_BUTTON_YES:"Si",PROMPT_BUTTON_NO:"No",NOTIFICATION_HEADER:"Messaggio da parte dell'assistente",OPERATOR_REDIRECT:"L'assistente la sta passando ad un altro assistente",OPERATOR_REDIRECT_OK:"L'assistente si e' collegato con lei:",OPERATOR_CONNECTING:"Aspettare che l'assistente si sta collegando con lei",NO_PREFERRED_OPERATOR:"Questo assistente e' assente, lei e' stato collegato ad un altro assistente",TOO_LONG:"Ha superato il numero di caratteri per questo messaggio",PHONE_LABEL:"Numero di telefono",PHONE_MESSAGE:"Numero di telefono",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",INCORRECT_PHONE:"Il numero di telefono e' sbagliato",ALL_OFFLINE:"Tutti gli assistenti sono offline",LEAVE_MESSAGE:"Lasciare un messaggio",DEFAULT_FIRST_MESSAGE:"Salve, come posso aitarla?",COPYRIGHT:"Assistente online di",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"Per inviare ul file trascinarlo qui",FILE_SENT_OPERATOR:"Il file e' stato inviato:",FILE_SENT_VISITOR:"Il suo file e' stato inviato:",FILE_UPLOAD:"<span>scaricare un file</span> (trascinare il file in chat)",UPLOAD_LEGEND:"Il file si sta scaricando",UPLOAD_ERROR:"Errore durante lo scaricamento – supera il volume consentito",UPLOAD_ERROR_TYPE:"Errore durante lo scaricamento – il tipo di file non e' supportato",UPLOAD_ERROR_UNKNOWN:"Errore sconosciuto. Riprovare di nuovo",BACK_TO_CONVERSATION:"Tornare alla conversazione",BACK_TO_OFFLINE:"Titornare al modulo di contatto",CHOOSE_DEPARTMENT:"Selezionare la sezione a cui vuole rivorgersi:",DEPARTMENTS_BUTTON:"Selezionare la sezione",CHOOSE_DEPARTMENT_TITLE:"Selezionare la sezione",CHAT_SEND_TITLE:"Inviare il messaggio",FILE_SEND_TITLE:"Inviare il file",RATE_TITLE:"Dare un voto all'assistente",HOLD_MESSAGE:"Aspettare per favore, l'assistente le rispondera' al piu' presto",LEAVE_CONTACTS:"L'assistente non risponde, lasciare il suo contatto e verra' ricontattato al piu' presto",PHONE:"Numero di telefono",EMAIL:"E-mail",NAME:"Nome",CONTACTS_SUCCESS:"Grazie, il nosto assistente la contattera' al piu' presto",INCORRECT_CONTACTS:"Controllare per favore se i dati sono corretti",OPERATOR:"L'assistente"},kk:{CHAT_LABEL:"Мәлімдеме еңгізу...",YOU_LABEL:"Сіз",EMAIL_INCORRECT:"Сіз жоқ e-mail адресін енгіздіңіз",FAILED_TO_SEND:"Хабарлама жіберлімеді",INCORRECT_EMAIL:"E-mail адресінің форматы дұрыс емес",NOT_ALL_FIELDS:"Сіз барлық алаңды толдырмадыңыз",MAIL_SUCCESS:"Сіздің хабарламаңыз жіберілді",MAIL_SENT:"Хабарлама жіберілді",SEND_BUTTON:"Жіберу",THROBBER:"Жіберу",MESSAGE_LABEL:"Хабарлама",EMAIL_LABEL:"Сіздің e-mail",NAME_LABEL:"Сіздің атыңыз",OFFLINE_HEADER:"Керібайланыстүрі",OFFLINE_TEXT:"Біздің операторлар қазір желіде емес, хабаралама тастап кетіңіз, жақын арада біз жауап қайтарамыз",PAGE_TITLE:"Онлайн кеңесші",URL_NEW_TAB:"Косымша бетте",TITLE_NEW_TAB:"қосымша бетте",WEBSITE:"http://redhelper.ru",TYPING_LABEL:"жауап береді",PROMPT_LABEL:"оператор сізді басқа бетке өтуді ұсынады. Өтесіз бе",PROMPT_BUTTON_YES:"Иә",PROMPT_BUTTON_NO:"Жоқ",NOTIFICATION_HEADER:"Оператордан хабарлама",OPERATOR_REDIRECT:"Оператор чатты басқа операторға береді",OPERATOR_REDIRECT_OK:"Сізге оператор қосылды",OPERATOR_CONNECTING:"Сізге оператор қосылуда, күте тұрыңыз",NO_PREFERRED_OPERATOR:"Ағымдағы оператор орнында емес, сіз басқа операторға қосылдыңыз",TOO_LONG:"Хабарлама жіберудің максималды ұзындығы артыпкетті",PHONE_LABEL:"Сіздің телефоныңыз",PHONE_MESSAGE:"Телефон",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",INCORRECT_PHONE:"Телефонның пішімі дурыс емес",ALL_OFFLINE:"Барлық операторлар желіде емес",LEAVE_MESSAGE:"Хабарлама қалдыру",DEFAULT_FIRST_MESSAGE:"Сәлеметсізбе, мен сізге көмектесе алам ба",COPYRIGHT:"Онлайн кенесші",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"Файлды жіберу үшін оны мына жерге апарыңыз",FILE_SENT_OPERATOR:"Файлды сізге жібердім",FILE_SENT_VISITOR:"Ссіз файылды жібердіңіз",FILE_UPLOAD:"<span> файлды қотару </span>  (немесе файлды чатқа апарыңыз)",UPLOAD_LEGEND:"Файлды қотару",UPLOAD_ERROR:"Файлды қотыру кезіндегі қате-өте улкен ауқым",UPLOAD_ERROR_TYPE:"Файлды қотыру кезіндегі қате-файлдың бұл түрі қолдауға жатпайды",UPLOAD_ERROR_UNKNOWN:"Білгісіз қате, тағы бір тырысып көріңіз",BACK_TO_CONVERSATION:"Диалогке оралу",BACK_TO_OFFLINE:"Офлайн формасына оралу",CHOOSE_DEPARTMENT:"Хабарлама алатын бөлімді таңдаңыз",DEPARTMENTS_BUTTON:"Бөлімді таңдау",CHOOSE_DEPARTMENT_TITLE:"Бөлімді таңдау",CHAT_SEND_TITLE:"Хабарлама жіберу",FILE_SEND_TITLE:"Файл жіберу",RATE_TITLE:"Операторды бағалау",HOLD_MESSAGE:"Етінеміз, күтетұрыңыз, оператор жақын арада сізге жауап береді",LEAVE_CONTACTS:"Оператор жауап бермейді, өзіңіздің байланыс телефоныңызды тастап кетсеңіз біз жақын арада сізбен байланысамыз",PHONE:"Телефон",EMAIL:"Электрондықпоштаадресі (e-mail)",NAME:"Аты",CONTACTS_SUCCESS:"Рахмет, біздің қызметкеріміз сізбен жақын арада байланысады",INCORRECT_CONTACTS:"Өтінеміз, енгізілген мағлұматтардың дұрыстығын тексеріңіз",OPERATOR:"Оператор"},lt:{CHAT_LABEL:"Palikite savo žinutę čia",YOU_LABEL:"Jūs",EMAIL_INCORRECT:"Jūsų nurodėtė neteisingą el.paštą",FAILED_TO_SEND:"Nepavyko išsiųsti žinutės",INCORRECT_EMAIL:"Neteisingas el.paštas",NOT_ALL_FIELDS:"Užpildyti ne visi laukeliai",MAIL_SUCCESS:"Jūsų žinutė buvo sėkmingai išsiųsta",MAIL_SENT:"Žinutė išsiųsta",SEND_BUTTON:"Siųsti",THROBBER:"Prašome palaukti...",MESSAGE_LABEL:"Žinutė",EMAIL_LABEL:"Jūsų el.paštas",NAME_LABEL:"Jūsų vardas",OFFLINE_HEADER:"Atsiliepimo forma",OFFLINE_TEXT:"Šiuo metu mes neprisijungę. Prašome palikti žinutę ir mes atsakysime jums el.laišku.",PAGE_TITLE:"Live Chat",URL_NEW_TAB:"atskiroje kortelėje",TITLE_NEW_TAB:"atskiroje kortelėje",WEBSITE:"http://redhelper.com",TYPING_LABEL:" rašo",PROMPT_LABEL:"'Operatorius nori nukreipti jus į kitą puslapį. Leisti?'",PROMPT_BUTTON_YES:"Taip",PROMPT_BUTTON_NO:"Ne",NOTIFICATION_HEADER:"Žinutė iš operatoriaus",OPERATOR_REDIRECT:"Operatorius nori jus perjungti",OPERATOR_REDIRECT_OK:"Jūs dabar bendraujate su ",OPERATOR_CONNECTING:"Operatorius prisijungia, prašome palaukti",NO_PREFERRED_OPERATOR:"Dabartinis operatorius nepasiekiamas, sujungiama su kitu",TOO_LONG:"Viršijote maksimalų žinutės ilgį",PHONE_LABEL:"Jūsų telefonas",PHONE_MESSAGE:"Telefonas",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",INCORRECT_PHONE:"Neteisingas telefono numeris",ALL_OFFLINE:"Operatoriai neprisijungę",LEAVE_MESSAGE:"Palikite žinutę",DEFAULT_FIRST_MESSAGE:"Sveiki! Kuo galiu padėti?",COPYRIGHT:"sukurta",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"Įmeskite failą čia",FILE_SENT_OPERATOR:"Jums nusiųstas failas:",FILE_SENT_VISITOR:"Jūs nusiuntėte failą:",FILE_UPLOAD:"<span>Įkelti failą</span> (ar nutempkite jį į pokalbį)",UPLOAD_LEGEND:"Keliamas failas",UPLOAD_ERROR:"Nepavyko įkelti - failas per didelis",UPLOAD_ERROR_TYPE:"Nepavyko įkelti - nepalaikomas failo tipas",UPLOAD_ERROR_UNKNOWN:"Nežinoma įkėlimo klaida. Pabandykite dar kartą",BACK_TO_CONVERSATION:"Grįžti į pokalbį",BACK_TO_OFFLINE:"Grįžti į offline formą",CHOOSE_DEPARTMENT:"Prašome pasirinkti skyrių:",DEPARTMENTS_BUTTON:"Pasirinkti skyrių",CHOOSE_DEPARTMENT_TITLE:"Pasirinkite skyrių",CHAT_SEND_TITLE:"Siųsti žinutę",FILE_SEND_TITLE:"Siųsti failą",RATE_TITLE:"Įvertinti operatorių",OPERATOR:"Operatorius"},lv:{CHAT_LABEL:"Ievadiet savu ziņu šeit",EMAIL_INCORRECT:"Nederīgs e-pasts",EMAIL_LABEL:"Jūsu e-pasts",FAILED_TO_SEND:"Kļūda sūtot ziņojumus",INCORRECT_EMAIL:"Nederīga e-pasta adrese",MAIL_SENT:"Offline-Ziņojums ir nosūtīts",MAIL_SUCCESS:"Offline-Ziņa tika nosūtīta veiksmīgi",MESSAGE_LABEL:"Ievadiet savu Offline-ziņu šeit",NAME_LABEL:"Jūsu vārds",NO_PREFERRED_OPERATOR:"Pašreizējais operators nav uz vietas, Jums ir saistīts ar citu operatoru",NOT_ALL_FIELDS:"Jums vajag aizpildīt visus laukus",NOTIFICATION_HEADER:"Ziņojums no operatora",OFFLINE_HEADER:"Atsauksmes forma",OFFLINE_TEXT:"Visi mūsu operatori ir atvienojušies. Atstāt ziņu un mēs atbildēsim uz to tuvākajā laikā.",OPERATOR_CONNECTING:"Savieno jūs ar operatoru, uzgaidiet",OPERATOR_REDIRECT:"Operators sūta tērzēšanu citam operatoram",OPERATOR_REDIRECT_OK:"Ir savienots ar jums",PAGE_TITLE:"Online konsultants",PROMPT_BUTTON_NO:"Nē",PROMPT_BUTTON_YES:"Jā",PROMPT_LABEL:"Operators piedāvā pārcelties uz citu lapu. Iet?",SEND_BUTTON:"Nosūtīt",THROBBER:"Sūtīšana...",TITLE_NEW_TAB:"Atsevišķā cilnē",TOO_LONG:"Pārsniegta maksimāla garuma nosūtīšanai",TYPING_LABEL:"atbild",URL_NEW_TAB:"atsevišķā cilnē",YOU_LABEL:"Jūs",YES_LABEL:"Jā",NO_LABEL:" Nē",MINIMIZE_CHAT:"noslēpt čatu",MAXIMIZE_CHAT:"atvērt atsevišķā cilnē",NEW_MESSAGE:"Jauns ziņojums no operatora",BADGE_LABEL:"Uzdot jautājumu",SOUND_ONOFF:"Ieslēgt / izslēgt skaņu",HIGHLIGHT_LABEL:"Pievērstet uzmanību",HIGHLIGHT_LINK:"Pāriet",HINT_CLOSE:"Spiediet, lai aizvērt",DEFAULT_LABEL:"Uzdot jautājumu",LEAVE_MESSAGE:"Atstāt ziņu",DROP_HERE:"Velciet un nometiet failus šeit",FILE_UPLOAD:"<a>Augšuplādēt failu</a> (vai velciet failu uz tērzēšanas)",UPLOAD_LEGEND:"Augšuplādēt failu",UPLOAD_ERROR:"Pievienot kļūda - fails ir pārāk liels",UPLOAD_ERROR_TYPE:"Pievienot kļūda - faila tips nav atbalstīts",UPLOAD_ERROR_UNKNOWN:"Nezināma augšupielādes kļūda",BACK_TO_CONVERSATION:"Atpakaļ uz sarunu",BACK_TO_OFFLINE:"Atpakaļ uz bezsaistes formu",CHOOSE_DEPARTMENT:"Izvēlieties sadaļu, kurā vēlaties pieteikties",DEPARTMENTS_BUTTON:"Izvēlieties nodaļa",CHOOSE_DEPARTMENT_TITLE:"Izvēlies nodaļa",CHAT_SEND_TITLE:"Nosūtīt ziņu",FILE_SEND_TITLE:"Nosūtīt failu",RATE_TITLE:"Līmenis operators",HOLD_MESSAGE:"Lūdzu uzgaidiet, operators jums atbildēs drīz",LEAVE_CONTACTS:"Operators nesniedz atbildi, atstājiet savu kontaktinformāciju, un mēs ar Jums sazināsimies tuvākajā laikā.",PHONE:"Telephone",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",EMAIL:"e-mail",NAME:"Vārds",CONTACTS_SUCCESS:"Paldies, mūsu darbinieki sazināsies ar Jums tuvākajā laikā.",INCORRECT_CONTACTS:"Lūdzu, pārbaudiet jūsu ieguldījumu",WEBSITE:"http://redhelper.com",OPERATOR:"Operators"},md:{CHAT_LABEL:"Introduceți mesajul...",YOU_LABEL:"Dvs",EMAIL_INCORRECT:"Ați introdus un email inexistent",FAILED_TO_SEND:"Expedierea mesajului a eșuat",INCORRECT_EMAIL:"Format incorect al mesajului",NOT_ALL_FIELDS:"Vă rog să completați toate câmpurile",MAIL_SUCCESS:"Mesajul Dvs a fost expediat cu succes",MAIL_SENT:"Mesajul a fost expediat",SEND_BUTTON:"Expediază",THROBBER:"Expediere în progres...",MESSAGE_LABEL:"Mesaj",EMAIL_LABEL:"Email",NAME_LABEL:"Numele",OFFLINE_HEADER:"Formular de contact",OFFLINE_TEXT:"Toți operatorii sunt ofline. Lăsați un mesaj și noi vom răspunde la el în scurt timp.",PAGE_TITLE:"Consultant Online",URL_NEW_TAB:"în fereastra de alături",TITLE_NEW_TAB:"în fereastra de alături",WEBSITE:"http://redhelper.com",TYPING_LABEL:" răspunde",PROMPT_LABEL:"Operatorul vă propune să treceți pe altă pagină. Faceți trecerea?",PROMPT_BUTTON_YES:"Da",PROMPT_BUTTON_NO:"Nu",NOTIFICATION_HEADER:"Mesaj de la Operator",OPERATOR_REDIRECT:"Operatorul transmite discuția altui Operator",OPERATOR_REDIRECT_OK:"Vi s-a alăturat operatorul",OPERATOR_CONNECTING:"Se conectează un operator, așteptați",NO_PREFERRED_OPERATOR:"Operatorul precedent nu este pe loc, sunteți conectat la alt operator",TOO_LONG:"Ați depășit limita maximă a mesajului",PHONE_LABEL:"Telefon",PHONE_MESSAGE:"Telefon",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",INCORRECT_PHONE:"Format incorect al numărului de telefon",ALL_OFFLINE:"Toți operatorii sunt ofline",LEAVE_MESSAGE:"Lăsați un mesaj",DEFAULT_FIRST_MESSAGE:"Bună ziua, cu ce vă pot ajuta?",COPYRIGHT:"consultant online de la",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"Pentru expediere, trageți fișierul aici",FILE_SENT_OPERATOR:"V-am expediat fișierul:",FILE_SENT_VISITOR:"Dvs ne-ați expediat fișierul:",FILE_UPLOAD:"<span>Încarcă un fișier</span> (sau trageți-l deasupra chatului)",UPLOAD_LEGEND:"Încărcare fișier",UPLOAD_ERROR:"Eroare la încărcarea fișierului - are dimensiunea prea mare",UPLOAD_ERROR_TYPE:"Eroare la încărcarea fișierului - format nepermis",UPLOAD_ERROR_UNKNOWN:"Eroare necunoscută la încărcare. Încercați din nou",BACK_TO_CONVERSATION:"Revenire la dialog",BACK_TO_OFFLINE:"Revenire la formularul ofline",CHOOSE_DEPARTMENT:"Alegeți departamentul la care doriți să vă adresați:",DEPARTMENTS_BUTTON:"Alegeți departamentul",CHOOSE_DEPARTMENT_TITLE:"Alegeți departamentul",CHAT_SEND_TITLE:"Expediere mesaj",FILE_SEND_TITLE:"Expediere fișier",RATE_TITLE:"Estimează Operatorul",HOLD_MESSAGE:"Așteptați vă rog, un Operator o să vă răspundă în scurt timp",LEAVE_CONTACTS:"Operatorul nu răspunde, lăsați datele Dvs de contact și în scurt timp noi vom lua legătura cu Dvs",PHONE:"Telefon ",EMAIL:"e-mail ",NAME:"Nume ",CONTACTS_SUCCESS:"Mulțumesc, unul din colegii noștri vă va contacta în timpul apropiat",INCORRECT_CONTACTS:"Vă rugăm, verificați corectitudinea datelor introduse",OPERATOR:"Operatorul"},pl:{CHAT_LABEL:"Napisz tutaj swoje pytanie",YOU_LABEL:"Ty",EMAIL_INCORRECT:"Wprowadzony e-mail adres jest nieprawidłowy",FAILED_TO_SEND:"Nieudane wysłanie wiadomości",INCORRECT_EMAIL:"Adres e-mail jest niewłaściwy",NOT_ALL_FIELDS:"Proszę wpisać wszystkie dane",MAIL_SUCCESS:"Odsyłanie wiadomości było udane",MAIL_SENT:"Wiadomość była odesłana",SEND_BUTTON:"Wysłać",THROBBER:"Proszę czekać...",MESSAGE_LABEL:"Wiadomość",EMAIL_LABEL:"Twój e-mail",NAME_LABEL:"Twoje imię",OFFLINE_HEADER:"Pozostaw wiadomość",OFFLINE_TEXT:"Jest po godzinach pracy. Proszę pozostaw wiadomość, odpowiemy przez e-mail.",PAGE_TITLE:"Żywa konwersacja",URL_NEW_TAB:"W innej zakładce",TITLE_NEW_TAB:"W innej zakładce",WEBSITE:"http://redhelper.com",TYPING_LABEL:"Wpisuję",PROMPT_LABEL:"Operator chcę przekierować na inną stronę internetową. Pozwolić?",PROMPT_BUTTON_YES:"Tak",PROMPT_BUTTON_NO:"Nie",NOTIFICATION_HEADER:"Wiadomość od operatora",OPERATOR_REDIRECT:"Operator chce cię przekierować",OPERATOR_REDIRECT_OK:"Rozmawiasz z",OPERATOR_CONNECTING:"Operator się łączy, proszę czekać",NO_PREFERRED_OPERATOR:"W tej chwili nie jest dostępny niniejszy operator. Połączymy cię z innym",TOO_LONG:"Długość wiadomości była przekroczona",PHONE_LABEL:"Twój telefon",PHONE_MESSAGE:"Telefon",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",INCORRECT_PHONE:"Numer telefonu jest niewłaściwy",ALL_OFFLINE:"Operatorzy nie są obecni",LEAVE_MESSAGE:"Zostaw wiadomość",DEFAULT_FIRST_MESSAGE:"Witaj! Jak mogę pomóc?",COPYRIGHT:"Obsługiwane przez",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"Tu przesuń plik",FILE_SENT_OPERATOR:"Plik był wysłany do ciebie:",FILE_SENT_VISITOR:"Wysłałeś plik:",FILE_UPLOAD:"<span>Wyślij plik</span> (lub przesuń do tego okna)",UPLOAD_LEGEND:"Wysyłanie pliku",UPLOAD_ERROR:"Nastąpił błąd w trakcie wysyłania - plik jest zbyt duży",UPLOAD_ERROR_TYPE:"Nastąpił błąd w trakcie wysyłania - ten format pliku nie jest obsługiwany",UPLOAD_ERROR_UNKNOWN:"Nastąpił nieznany błąd w trakcie wysyłania. Spróbuj ponownie",BACK_TO_CONVERSATION:"Z powrotem do konwersacji",BACK_TO_OFFLINE:"Z powrotem do formularza offline",CHOOSE_DEPARTMENT:"Proszę wybierz dział:",DEPARTMENTS_BUTTON:"Proszę wybierz dział",CHOOSE_DEPARTMENT_TITLE:"Wybierz dział",CHAT_SEND_TITLE:"Wyślij wiadomość",FILE_SEND_TITLE:"Wyślij plik",RATE_TITLE:"Proszę ocenić operatora",HOLD_MESSAGE:"Please wait, operator will answer you as soon as possible",LEAVE_CONTACTS:"Operator is not responding, please leave your contacts",PHONE:"telefon",EMAIL:"e-mail",NAME:"imię",CONTACTS_SUCCESS:"Thank you, our manager will contact you soon",INCORRECT_CONTACTS:"Please check highlighted fields",OPERATOR:"Operator"},ru:{CHAT_LABEL:"Ввести сообщение...",YOU_LABEL:"Вы",EMAIL_INCORRECT:"Вы ввели несуществующий e-mail",FAILED_TO_SEND:"Не удалось отправить сообщение",INCORRECT_EMAIL:"Неверный формат email адреса",NOT_ALL_FIELDS:"Вы заполнили не все поля",MAIL_SUCCESS:"Ваше сообщение отправлено",MAIL_SENT:"Сообщение было отправлено",SEND_BUTTON:"Отправить",THROBBER:"Отправка...",MESSAGE_LABEL:"Сообщение",EMAIL_LABEL:"E-mail",NAME_LABEL:"Ваше имя",OFFLINE_HEADER:"Форма обратной связи",OFFLINE_TEXT:"Все наши операторы сейчас офлайн. Оставьте сообщение и мы ответим на него в ближайшее время.",PAGE_TITLE:"Онлайн консультант",URL_NEW_TAB:"в отдельной вкладке",TITLE_NEW_TAB:"в отдельной вкладке",WEBSITE:"http://redhelper.ru",TYPING_LABEL:" отвечает",PROMPT_LABEL:"Оператор предлагает вам перейти на другую страницу. Перейти?",PROMPT_BUTTON_YES:"Да",PROMPT_BUTTON_NO:"Нет",NOTIFICATION_HEADER:"Сообщение от оператора",OPERATOR_REDIRECT:"Оператор передаёт чат другому оператору",OPERATOR_REDIRECT_OK:"К вам подключился оператор",OPERATOR_CONNECTING:"К вам подключается оператор, подождите",NO_PREFERRED_OPERATOR:"Текущего оператора нет на месте, вы подключены к другому оператору",TOO_LONG:"Превышена максимальная длина для отправки сообщения",PHONE_LABEL:"Телефон",PHONE_MESSAGE:"Телефон",OFFLINE_BODY_HEADER1:"Email посетителя",OFFLINE_BODY_HEADER2:"Ответ на это письмо отправится на почту посетителя.",OFFLINE_FROM_VISITOR:"Сообщение от посетителя",OFFLINE_VISITOR_NAME:"Имя посетителя",INCORRECT_PHONE:"Неверный формат телефона",ALL_OFFLINE:"Все операторы офлайн",LEAVE_MESSAGE:"Оставить сообщение",DEFAULT_FIRST_MESSAGE:"Здравствуйте, могу ли я вам чем-то помочь?",COPYRIGHT:"Онлайн консультант от",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"Для отправки перетащите файл сюда",FILE_SENT_OPERATOR:"Выслал вам файл:",FILE_SENT_VISITOR:"Вы выслали файл:",FILE_SENT_DOWNLOAD:"Скачать файл",MOVE_TO_DEPARTMENTS:"Выбрать другой отдел",FILE_UPLOAD:"<span>Загрузить файл</span> (или перетащите файл в чат)",UPLOAD_LEGEND:"Загрузка файла",UPLOAD_ERROR:"Ошибка при загрузке файла - слишком большой размер",UPLOAD_ERROR_TYPE:"Ошибка при загрузке файла - данный тип файлов не поддерживается",UPLOAD_ERROR_UNKNOWN:"Неизвестная ошибка. Попробуйте еще раз",BACK_TO_CONVERSATION:"Вернуться к диалогу",BACK_TO_OFFLINE:"Вернуться к офлайн-форме",CHOOSE_DEPARTMENT:"Выберите отдел, в который хотите обратиться:",DEPARTMENTS_BUTTON:"Выбрать отдел",CHOOSE_DEPARTMENT_TITLE:"Выбрать отдел",CHAT_SEND_TITLE:"Отправить сообщение",FILE_SEND_TITLE:"Отправить файл",RATE_TITLE:"Оценить оператора",HOLD_MESSAGE:"Подождите, пожалуйста, оператор вам скоро ответит",LEAVE_CONTACTS:"Оператор не отвечает, оставьте свои контакты и мы свяжемся с вами в ближайшее время.",PHONE:"Телефон",EMAIL:"e-mail",NAME:"Имя",CONTACTS_SUCCESS:"Спасибо, наш сотрудник свяжется с вами в ближайшее время.",INCORRECT_CONTACTS:"Пожалуйста, проверьте правильность введенных данных",OPERATOR:"Оператор"},sk:{CHAT_LABEL:"Sem napíšte svoju otázku...",YOU_LABEL:"Vy",EMAIL_INCORRECT:"E-mail adresa, ktorú ste uviedli je nesprávna",FAILED_TO_SEND:"Nepodarilo sa odoslať správu",INCORRECT_EMAIL:"E-mail adresa je nesprávna",NOT_ALL_FIELDS:"Nevyplnili ste všetky polia",MAIL_SUCCESS:"Vaša správa bola poslaná úspešne",MAIL_SENT:"Vaša správa bola poslaná",SEND_BUTTON:"Poslať",THROBBER:"Počkajte prosím...",MESSAGE_LABEL:"Správa",EMAIL_LABEL:"Váš e-mail",NAME_LABEL:"Vaše meno",OFFLINE_HEADER:"Zanechajte nám správu",OFFLINE_TEXT:"Zachytili ste nás mimo pracovnej doby. Prosím zanechajte nám odkaz a my vám odpovieme cez e-mail.",PAGE_TITLE:"Živá konverzácia",URL_NEW_TAB:"v inej záložke",TITLE_NEW_TAB:"v inej záložke",WEBSITE:"http://redhelper.com",TYPING_LABEL:" píše",PROMPT_LABEL:"‘Operátor Vás chce presmerovať na inú web stránku. Povoliť?’",PROMPT_BUTTON_YES:"Áno",PROMPT_BUTTON_NO:"Nie",NOTIFICATION_HEADER:"Odkaz od operátora",OPERATOR_REDIRECT:"Operátor Vás chce presmerovať",OPERATOR_REDIRECT_OK:"Rozprávate sa s",OPERATOR_CONNECTING:"Operátor sa pripája, počkajte prosím",NO_PREFERRED_OPERATOR:"Súčasný operátor nie je v dispozícii. Budete prepojený na iného",TOO_LONG:"Bola prekročená maximálna dĺžka správy",PHONE_LABEL:"Váš telefón",PHONE_MESSAGE:"Telefón",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",INCORRECT_PHONE:"Telefónne číslo je nesprávne",ALL_OFFLINE:"Operátori nie sú prítomní",LEAVE_MESSAGE:"Zanechajte odkaz",DEFAULT_FIRST_MESSAGE:"Vitajte! Ako Vám môžeme pomôcť?",COPYRIGHT:"poskytovateľ",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"Položte sem súbor",FILE_SENT_OPERATOR:"Súbor poslaný Vám:",FILE_SENT_VISITOR:"Poslali ste súbor:",FILE_UPLOAD:"<span>Pošlite súbor</span> (alebo ho položte na toto okno)",UPLOAD_LEGEND:"Posielanie súboru",UPLOAD_ERROR:"Chyba pri odosielaní - súbor je príliš veľký",UPLOAD_ERROR_TYPE:"Chyba pri odosielaní - tento typ súboru nie je podporovaný",UPLOAD_ERROR_UNKNOWN:"Nastala neznáma chyba pri odosielaní. Skúste to znova.",BACK_TO_CONVERSATION:"Naspäť ku konverzácii",BACK_TO_OFFLINE:"Naspať na offline formulár",CHOOSE_DEPARTMENT:"Prosím vyberte si oddelenie:",DEPARTMENTS_BUTTON:"Vyberte si oddelenie",CHOOSE_DEPARTMENT_TITLE:"Vyberte si oddelenie",CHAT_SEND_TITLE:"Pošlite správu",FILE_SEND_TITLE:"Pošlite súbor",RATE_TITLE:"Ohodnoďte operátora",OPERATOR:"Operátor"},uk:{CHAT_LABEL:"Ввести повідомлення",YOU_LABEL:"Ви",EMAIL_INCORRECT:"Некорректный адрес email",FAILED_TO_SEND:"Помилка відправлення офлайн-повідомлення",INCORRECT_EMAIL:"Некорректный адрес email",NOT_ALL_FIELDS:"Ви заповнили не всі рядки",MAIL_SUCCESS:"Офлайн-повідомлення вдало відтправлено",MAIL_SENT:"Офлайн-повідомлення відправлено",SEND_BUTTON:"Відіслати",THROBBER:"Надсилання...",MESSAGE_LABEL:"Повідомлення",EMAIL_LABEL:"Ваш email",NAME_LABEL:"Ваше ім'я",OFFLINE_HEADER:"Форма зворотнього зв'язку",OFFLINE_TEXT:"Всі наші оператори зараз офлайн. Залиште повідомлення і ми відповімо на нього найближчим часом.",PAGE_TITLE:"Онлайн консультант",URL_NEW_TAB:"В окремій вкладці",TITLE_NEW_TAB:"В окремій вкладці",TYPING_LABEL:" відповідає",PROMPT_LABEL:"Оператор пропонує Вам перейти на іншу сторінку. Перейти?",PROMPT_BUTTON_YES:"Так",PROMPT_BUTTON_NO:"Нi",NOTIFICATION_HEADER:"Повідомлення від оператора",OPERATOR_REDIRECT:"Оператор передає чат іншому оператору",OPERATOR_REDIRECT_OK:"До вас підключився оператор",OPERATOR_CONNECTING:"До вас підключається оператор, зачекайте",NO_PREFERRED_OPERATOR:"Поточного оператора немає на місці, ви підключені до іншого оператора",TOO_LONG:"Перевищена максимальна довжина для відправлення повідомлення",PHONE_MESSAGE:"Телефон",OFFLINE_BODY_HEADER1:"Visitor's email",OFFLINE_BODY_HEADER2:"Your response to this message will be sent to the user.",OFFLINE_FROM_VISITOR:"Message from visitor",OFFLINE_VISITOR_NAME:"Visitor name",PHONE_LABEL:"Ваш телефон",INCORRECT_PHONE:"Невірний телефон",ALL_OFFLINE:"Всі оператори офлайн",LEAVE_MESSAGE:"Залишити повідомлення",DEFAULT_FIRST_MESSAGE:"Здрастуйте, чи можу я Вам чимось допомогти?",DROP_HERE:"Перетягніть файли сюди",FILE_UPLOAD:"<span>Завантажити файл</span> (або перетягніть файл у чат)",UPLOAD_LEGEND:"Завантаження файлу",UPLOAD_ERROR:"Помилка при завантаженні - файл занадто великий",UPLOAD_ERROR_TYPE:"Помилка при завантаженні - тип файлів не дозволені",UPLOAD_ERROR_UNKNOWN:"Невідома помилка завантаження",BACK_TO_CONVERSATION:"Повернутися до діалогу",BACK_TO_OFFLINE:"Повернутися до офлайн-форми",CHOOSE_DEPARTMENT:"Виберіть відділ, в який хочете звернутися",DEPARTMENTS_BUTTON:"Виберіть відділ",CHOOSE_DEPARTMENT_TITLE:"Виберіть відділ",CHAT_SEND_TITLE:"Відправити повідомлення",FILE_SEND_TITLE:"Відправити файл",RATE_TITLE:"Швидкість оператора",HOLD_MESSAGE:"Зачекайте, будь ласка, оператор вам скоро відповість",LEAVE_CONTACTS:"Оператор не відповідає, залиште свої контакти і ми зв'яжемося з вами найближчим часом.",PHONE:"Телефон",EMAIL:"e-mail",NAME:"Ім'я",CONTACTS_SUCCESS:"Спасибі, наш співробітник зв'яжеться з вами найближчим часом.",INCORRECT_CONTACTS:"Будь ласка, перевірте правильність введених даних",WEBSITE:"http://redhelper.ru",OPERATOR:"Оператор"},zh:{CHAT_LABEL:"请在这里留言",YOU_LABEL:"您",EMAIL_INCORRECT:"您的电子邮件地址不正确",FAILED_TO_SEND:"无法发送消息",INCORRECT_EMAIL:"电子邮件地址不正确",NOT_ALL_FIELDS:"无法包含所有文字",MAIL_SUCCESS:"您的信息已经成功发送",MAIL_SENT:"信息已经成功发送",SEND_BUTTON:"发送",THROBBER:"请稍后...",MESSAGE_LABEL:"留言:",EMAIL_LABEL:"您的e-mail:",NAME_LABEL:"您的姓名:",OFFLINE_HEADER:"反馈表",OFFLINE_TEXT:"我们目前不在线， 请留言,我们将通过电子邮件答复您。",PAGE_TITLE:"在线咨询",URL_NEW_TAB:"一个独立的标签",TITLE_NEW_TAB:"一个独立的标签",WEBSITE:"http://redhelper.com",TYPING_LABEL:" 打字",PROMPT_LABEL:"'运营商想要将您重新定向到另一个页面,是否同意?'",PROMPT_BUTTON_YES:"同意",PROMPT_BUTTON_NO:"不同意",NOTIFICATION_HEADER:"运营商信息",OPERATOR_REDIRECT:"运营商需要切换您",OPERATOR_REDIRECT_OK:"您目前的交谈人是",OPERATOR_CONNECTING:"运营商正在连接, 请稍后",NO_PREFERRED_OPERATOR:"当前服务人员不在, 已转接到另外的人员",TOO_LONG:"超过最大信息长度",PHONE_LABEL:"您的电话:",PHONE_MESSAGE:"电话",INCORRECT_PHONE:"此号码不正确",ALL_OFFLINE:"服务人员不在线",LEAVE_MESSAGE:"留言",DEFAULT_FIRST_MESSAGE:"您好！您需要什么帮助？",COPYRIGHT:"技术支持",COPYRIGHT_NAME:"<span>红色</span>助手",DROP_HERE:"在这里留下文件",FILE_SENT_OPERATOR:"发送文件给您:",FILE_SENT_VISITOR:"您已发送文件:",FILE_UPLOAD:"<span>上传一个文件</span> (或拖进对话框)",UPLOAD_LEGEND:"文件上传中",UPLOAD_ERROR:"上传错误 - 文件过大",UPLOAD_ERROR_TYPE:"上传错误- 文件类型不支持",UPLOAD_ERROR_UNKNOWN:"未知上传错误. 请再试一次",BACK_TO_CONVERSATION:"回到对话",BACK_TO_OFFLINE:"回到离线表格",CHOOSE_DEPARTMENT:"请选择需要部门:",DEPARTMENTS_BUTTON:"选择相关部门",CHOOSE_DEPARTMENT_TITLE:"选择相关部门",CHAT_SEND_TITLE:"发送消息",FILE_SEND_TITLE:"发送文件",RATE_TITLE:"顾问评价",HOLD_MESSAGE:"请稍后，顾问会立即回复您。",LEAVE_CONTACTS:"顾问暂时不在，请留下您的联系方式",PHONE:"电话",EMAIL:"e-mail",NAME:"姓名",CONTACTS_SUCCESS:"谢谢，我们的经理会尽快回复您",INCORRECT_CONTACTS:"请检查高亮字段",OPERATOR:"运营商"}}}),redhelper.define("config/lang",["application/session.objects","config/api","locales","common/extensions/jquery.plugins"],function(a,b,c,d){var e={CHAT_LABEL:"",YOU_LABEL:"",EMAIL_INCORRECT:"",FAILED_TO_SEND:"",INCORRECT_EMAIL:"",NOT_ALL_FIELDS:"",MAIL_SUCCESS:"",MAIL_SENT:"",SEND_BUTTON:"",THROBBER:"",MESSAGE_LABEL:"",EMAIL_LABEL:"",NAME_LABEL:"",OFFLINE_HEADER:"",OFFLINE_TEXT:"",PAGE_TITLE:"",URL_NEW_TAB:"",TITLE_NEW_TAB:"",WEBSITE:"",TYPING_LABEL:"",PROMPT_LABEL:"",PROMPT_BUTTON_YES:"",PROMPT_BUTTON_NO:"",NOTIFICATION_HEADER:"",OPERATOR_REDIRECT:"",OPERATOR_REDIRECT_OK:"",OPERATOR_CONNECTING:"",NO_PREFERRED_OPERATOR:"",TOO_LONG:"",PHONE_MESSAGE:"",PHONE_LABEL:"",INCORRECT_PHONE:"",ALL_OFFLINE:"",LEAVE_MESSAGE:"",DEFAULT_FIRST_MESSAGE:"",COPYRIGHT_NAME:"<span>Red</span>Helper",DROP_HERE:"",FILE_SENT_OPERATOR:"",FILE_SENT_VISITOR:"",FILE_UPLOAD:"",UPLOAD_ERROR:"",UPLOAD_ERROR_TYPE:"",UPLOAD_ERROR_UNKNOWN:"",UPLOAD_LEGEND:"",BACK_TO_CONVERSATION:"",BACK_TO_OFFLINE:"",CHOOSE_DEPARTMENT:"",DEPARTMENTS_BUTTON:"",CHAT_SEND_TITLE:"",FILE_SEND_TITLE:"",RATE_TITLE:"",HOLD_MESSAGE:"",LEAVE_CONTACTS:"",PHONE:"",NAME:"",EMAIL:"",CONTACTS_SUCCESS:"",INCORRECT_CONTACTS:"",RTL:""};
return e.setFields=function(a){for(var b in a)a.hasOwnProperty(b)&&(e[b]=a[b]);for(b in e)e.hasOwnProperty(b)&&""===e[b]&&(e[b]=c.locales.en[b])},e.initLanguage=function(){var f,g=c.enabled,h=function(){return a.userLocale?a.userLocale:a&&a.locale&&g.indexOf(a.locale)>-1?a.locale:"ru"}();if(e.setFields(c.locales[h]),e.RTL&&d("body").addClass("rtl"),!a.free&&b&&b.Lang)for(f in e)e.hasOwnProperty(f)&&b.Lang.hasOwnProperty(f)&&(e[f]=b.Lang[f]);document.title=e.PAGE_TITLE},e.initLanguage(),e}),redhelper.define("common/constants/sender",{VISITOR:0,OPERATOR:1}),redhelper.define("common/application/time",[],function(){var a=null,b=null,c={now:function(){return a=new Date,c},parse:function(d){return a=new Date(Date.parse(d)),b?(a.setHours(a.getHours()+b[0]),a.setMinutes(a.getMinutes()+b[1]),a.setSeconds(a.getSeconds()+b[2]),c):this},setTimeDifference:function(a){var d=a.split(" ")[1].split(":");d[0]=+d[0];var e=new Date,f=[e.getHours(),e.getMinutes(),e.getSeconds()];return b=d.map(function(a,b){return f[b]-a}),c},getTimeDifference:function(){return b},toString:function(){if(!a)return"";var b=[a.getHours(),a.getMinutes(),a.getSeconds()];return b.forEach(function(a,c){10>a&&(b[c]="0"+a)}),b.join(":")},getTime:function(){return a.getTime()}};return window.rhlpTime=c,c}),redhelper.define("view/template",["application/session.objects","common/extensions/jquery.plugins","config/setup"],function(a,b,c){return{processTemplate:function(d,e){d=b(d).clone(),d.removeAttr("id"),d=b("<div></div>").append(d).html();var f,g=/%(\w+)%/g;for(f=g.exec(d);f;f=g.exec(d)){e&&e.hasOwnProperty(f[1])&&(d=d.replace(new RegExp("%"+f[1]+"%","g"),e[f[1]]));try{a&&Object.prototype.hasOwnProperty.call(a,f[1])&&(d="operAvatar"===f[1]?d.replace(new RegExp("%"+f[1]+"%","g"),c.getImageUrl(a[f[1]])):d.replace(new RegExp("%"+f[1]+"%","g"),a[f[1]]))}catch(h){}}var i=/#(\w+)#/g;for(f=i.exec(d);f;f=i.exec(d))a&&Object.prototype.hasOwnProperty.call(a,f[1])&&(d=d.replace(new RegExp("#"+f[1]+"#","g"),'<span class="redhlp_'+f[1]+'">'+a[f[1]]+"</span>"));return d}}}),redhelper.define("view/chat",["common/extensions/jquery.plugins","application/dispatcher","common/constants/sender","application/session.objects","config/lang","common/constants/chatState","application/parent","common/application/time","view/template","common/extensions/browserDetect"],function(a,b,c,d,e,f,g,h,i,j){a.valHooks.textarea={get:function(a){return a.value.replace(/\r?\n/g,"\r\n")}};var k=!1,l=null,m={_displayElem:null,_lastMessageFrom:null,_typingTimer:0,_isTyping:!1,_baron:null,_messages:[],_highlightLinks:function(a){return a.replace(/(((http|https|ftp)[:][\/][\/])?([\w\d_\-\.а-яёА-ЯЁ]*@)?(([\w\d_\-а-яёА-ЯЁ]+)\.)+(\w{2,4}|рф)([\/]\S*)*)(\s|$)/gm,function(a,b,c,d,e,f,g,h,i,j){return'<a target="_blank" href="'+(b.indexOf("@")>-1?"mailto:":b.indexOf("://")>-1?"":"http://")+b+'">'+b+"</a>"+j})},_escapeHtml:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\n/g,"<br>")},_decorateFile:function(a){var b=a.text.split("/"),d=b[b.length-1],f=d.split("."),g=f[f.length-1].toLowerCase(),h="unknown";return" png jpg jpeg bmp ico psd ".indexOf(" "+g+" ")>-1&&(h="image"),"pdf"===g&&(h="pdf"),("doc"===g||"docx"===g||"odt"===g)&&(h="word"),"txt"===g&&(h="txt"),e["FILE_SENT_"+(a.sender===c.OPERATOR?"OPERATOR":"VISITOR")]+'<div class="file"><a target="_blank" title="'+e.FILE_SENT_DOWNLOAD+'" href="'+a.text+'"><span class="icon '+h+'"></span>'+decodeURIComponent(d)+'</a><div style="clear: both"></div>'},_decorate:function(b,d,e,f){var g=void 0!==e;void 0===d&&(d=!1);var h,j=b.text,k={},l=!1;for(h in b)b.hasOwnProperty(h)&&(k[h]=b[h]);var m=new Date(b.unixTime);k.date=m.getDate()>9?m.getDate():"0"+m.getDate(),k.date+="."+(m.getMonth()>8?m.getMonth()+1:"0"+(m.getMonth()+1)),k.date+="."+m.getFullYear(),k.time=k.time.substring(0,5),j.indexOf("//data.redhelper.ru/messagefiles")>-1?(l=!0,j=this._decorateFile(b)):d||(j=f?b.text:this._highlightLinks(this._escapeHtml(b.text))),k.text=j;var n=b.sender===c.OPERATOR?"fromOperator":"fromVisitor",o=i.processTemplate("#"+n,k),p=i.processTemplate("#"+n+"Header",k),q=a(o);d&&q.addClass("invitationMessage"),(this._lastMessageFrom!==b.displayName||d)&&q.prepend(p),q.attr("id",b.guid);var r=a("<div></div>").append(q);b.className&&r.addClass(b.className),l&&r.children().addClass("fileWrapper");var s=r.html();return g&&(this._lastMessageFrom!==b.displayName?a(".msgBlock").length?a(".msgBlock:last",e).after('<div class="msgBlock '+n+'">'+s+"</div>"):a("#invitation",e).after('<div class="msgBlock '+n+'">'+s+"</div>"):a(".msgBlock:last",e).append(s)),d||(this._lastMessageFrom=b.displayName),s},_decorateRedirectPrompt:function(b,c){var d,e=b.text,f={};for(d in b)b.hasOwnProperty(d)&&(f[d]=b[d]);var g=new Date(b.unixTime);f.date=g.getDate()>9?g.getDate():"0"+g.getDate(),f.date+="."+(g.getMonth()>8?g.getMonth()+1:"0"+(g.getMonth()+1)),f.date+="."+g.getFullYear(),f.promptTime=f.time.substring(0,5),f.text=e;var h=i.processTemplate("#promptContainer",f),j=a(h),k=a("<div></div>").append(j),l=k.html();return a(".msgBlock").length?a(".msgBlock:last",c).after('<div class="msgBlock">'+l+"</div>"):a(c).append('<div class="msgBlock">'+l+"</div>"),l},setOutput:function(c){this._displayElem="string"==typeof c?a(c):c,this._displayElem.on("click",".promptButton",function(){return a(this).hasClass("yes")?(b.fire("redirectOK",{link:a(this).data("link")}),!1):(a(this).parents(".msg").fadeOut("slow",function(){a(this).siblings().length||(m._lastMessageFrom=e.YOU_LABEL,a(this).parents(".msgBlock").remove()),b.fire("redirectCancel")}),!0)}),l&&(m.showLabel(l.text,l.loading),l=null),this._displayElem.append("<div id='stickyMessage' style='display: none'><a id='stickyMessageClose'></a><div id='stickyMessageBody'></div></div>"),this._displayElem.find("#stickyMessageClose").click(function(){b.fire("hideMessage")})},appendMessage:function(a){this._displayElem.find("#stickyMessageBody").html(a),this._displayElem.find("#stickyMessage").show(),this.scrollBottom()},hideMessage:function(){this._displayElem.find("#stickyMessageBody").html(""),this._displayElem.find("#stickyMessage").hide(),this.scrollBottom()},append:function(b){if(!b.hide&&0!==b.text.indexOf(":g")&&0!==b.text.indexOf(":г")){for(var d=this._messages.length-1;d>0&&this._messages[d].id&&this._messages[d].id>b.id;)d-=1;b.pushAfter=d>0?this._messages[d].id:0,b.pushAfter&&b.pushAfter===b.id&&this._messages[d].text===b.text||(this._messages.push(b),this._messages.sort(function(a,b){return a.id&&b.id?a.id-b.id:-1*(a.time<b.time)+(a.time>b.time)}),this._displayElem&&(b.sender===c.VISITOR&&(b.displayName=e.YOU_LABEL),b.time||(b.time=h.now().toString()),this._decorate(b,!1,this._displayElem),"Android"===j.OS&&navigator.userAgent.indexOf("Android 2")>-1&&this._displayElem.css("height",a("body").height()/parseFloat(a("body").css("fontSize"))-16+"em"),this.scrollBottom()))}},showTyping:function(){if(this._displayElem&&!this._isTyping){this._isTyping=!0,a("#typingLabel .text").html(d.operDisplayName+e.TYPING_LABEL+"..."),a("#typingLabel").show();var b=3,c=a("#typingLabel .text",this._displayElem);this._typingTimer=setInterval(function(){b>2?(c.html(d.operDisplayName+e.TYPING_LABEL),b=0):(c.html(c.html()+"."),b+=1)},800),this.scrollBottom()}},showLabel:function(b,c){return this._displayElem?(c?a("#chatLabel").addClass("loading"):a("#chatLabel").removeClass("loading"),a("#chatLabel").find(".text").html(b),a("#operatorName").html(d.operDisplayName),a("#chatLabel").show(),void this.scrollBottom()):void(l={text:b,loading:c})},hideLabel:function(){return this._displayElem?(a("#chatLabel").removeClass("loading"),a("#chatLabel").hide(),void this.scrollBottom()):void(l=null)},hideTyping:function(){this._displayElem&&this._isTyping&&(a("#typingLabel").hide(),clearInterval(this._typingTimer),this._isTyping=!1)},showFirstMessage:function(b){return!this._displayElem||k?void(b.sender===c.OPERATOR&&a(".msg.invitationMessage .sender").text(b.displayName)):(b.sender===c.VISITOR&&(b.displayName=e.YOU_LABEL),b.time=h.now().toString(),b.unixTime=(new Date).getTime(),this._displayElem.prepend(this._decorate(b,!0)),k=!0,void this.scrollBottom())},scrollBottom:function(){this._displayElem.trigger("sizeChange");var b=this._displayElem[0];b.scrollTop=b.scrollHeight,a(".time").disableTextSelect()},clear:function(){this._displayElem.html(""),this._lastMessageFrom=null},showRedirectPrompt:function(a){if(this._displayElem){a.indexOf("://")<0&&(a="http://"+a);var b='<div class="promptButtonWrapper"><a class="promptButton yes" data-link="'+a+'">'+e.PROMPT_BUTTON_YES+'</a><a class="promptButton no">'+e.PROMPT_BUTTON_NO+'</a><div style="clear: both"></div></div>',i={displayName:d.operDisplayName,sender:c.OPERATOR,time:h.now().toString(),unixTime:(new Date).getTime(),text:'<div id="promptWrapper"><div class="promptLabel">'+e.PROMPT_LABEL+"</div>"+b+"</div>"};this._displayElem.find("#promptWrapper").parents(".msgBlock").remove(),this._decorateRedirectPrompt(i,this._displayElem),this.scrollBottom(),this.hideTyping(),d.chatState===f.MINIMIZED&&g.send("openChat")}},replaceMessage:function(b){a("#"+b.guid+" .textWrapper .text").html(this._highlightLinks(b.text)),this.hideTyping()}};return b.addEventListener("showLabel",function(a){m.showLabel(a.text,a.loading)}),b.addEventListener("hideLabel",function(){m.hideLabel()}),b.addEventListener("replaceMessage",function(a){m.replaceMessage(a)}),g.addHandler("resizeFont",function(c){a("body").css("font-size",c.size),b.addEventListener("changeDepartment",function(){a("body").css("font-size",c.size)})}),g.addHandler("chatOpened",function(){b.fire("chatOpened")}),navigator.userAgent.indexOf("Android 2")>-1&&g.addHandler("chatOpened",function(){setTimeout(function(){m._displayElem.css("height",a("body").height()/parseFloat(a("body").css("fontSize"))-16+"em")},500)}),b.addEventListener("appendProgressBar",function(a){m._displayElem.append(a.element),m.scrollBottom()}),b.addEventListener("renderChat",function(){m._displayElem.trigger("sizeChange"),m.scrollBottom()}),b.addEventListener("appendMessage",function(a){m.appendMessage(a.html)}),b.addEventListener("hideMessage",function(){m.hideMessage()}),m}),redhelper.define("view/minbox",["application/dispatcher","common/extensions/jquery.plugins","application/session.objects","common/extensions/browserDetect"],function(a,b,c,d){if(!d.isMobile){var e=5.2,f=6.25,g=function(){return function(){try{if(c.offlineFields&&0===c.offlineFields.length)return;var d=b("#offline .topPanel"),g=b("#feedbackForm"),h=b("#offline").css("display");"none"===h&&b("#offline").show(),d.css("width","218px"),d.css("height","auto");var i=Math.max(0,Math.min(d.height()/parseInt(d.css("font-size"),10)-e,6));if(i!==i)return;"none"===h&&b("#offline").hide(),d.css("height",e+i+"em"),g.css("top",f+i+"em"),d.css("width",""),a.fire("sendResize",{height:380+i*parseInt(d.css("font-size"),10)})}catch(j){}}}();c.dispatcher.addEventListener("onOfflineTextChanged",function(){g()}),a.addEventListener("refreshOfflineForm",g)}}),redhelper.define("view/operatorRates",["config/setup","common/extensions/jquery.plugins","application/session.objects","application/dispatcher"],function(a,b,c,d){var e=function(e,f){b.ajax({url:a.RATE_URL,method:"GET",data:{operator:e,rate:f,vid:c.vid},success:function(a){if("Ok"===a){var b=c.operatorRates;b[e]=f,c.operatorRates=b,d.fire("operatorRated",{name:e,value:f})}},error:function(){d.fire("operatorRateError")}})};return{init:function(){d.addEventListener("rateOperator",function(a){e(c.currentOperator,a.value)}),d.addEventListener("operatorRated",function(){void 0!==c.operatorRates[c.currentOperator]&&(b("#like, #dislike").removeClass("active"),b(c.operatorRates[c.currentOperator]?"#like":"#dislike").addClass("active"))}),d.addEventListener("operator",function(){b("#like, #dislike").removeClass("active"),void 0!==c.operatorRates[c.currentOperator]&&b(c.operatorRates[c.currentOperator]?"#like":"#dislike").addClass("active")}),b("#like").click(function(){d.fire("rateOperator",{value:1})}),b("#dislike").click(function(){d.fire("rateOperator",{value:0})})}}}),redhelper.define("view/progressBar",["common/extensions/jquery.plugins","application/dispatcher"],function(a,b){var c=function(){this._element=a("<div class='progressBarWrapper'><span class='legend'></span><div class='progressBar'><div class='progress'></div></div></div>")};return c.prototype.setLegend=function(a){this._element.find(".legend").html(a)},c.prototype.append=function(){b.fire("appendProgressBar",{element:this._element})},c.prototype.remove=function(){this._element.detach()},c.prototype.fadeOut=function(a){var b=this;this._element.fadeOut(600,function(){b._element.detach(),a()})},c.prototype.setProgress=function(a){this._part=Math.min(a,1),100*a>=99?(this._element.find(".progress").css("width","auto"),this._element.find(".percentage").html("100%")):(this._element.find(".progress").css("width",100*a+"%"),this._element.find(".percentage").html(Math.round(100*a)+"%"))},c.prototype.expWait=function(){var a=this;void 0===a._part&&(a._part=0);var b=Math.max(a._part,.9);this._waitId=setInterval(function(){a.setProgress(a._part+.05*(b-a._part))},100)},c.prototype.endWait=function(a){try{clearInterval(this._waitId)}catch(b){}var c=this._part,d=this;this._waitId=setInterval(function(){d.setProgress(d._part+.1*(1-c)),d._part>=1&&(clearInterval(d._waitId),d.fadeOut(a))},100)},c}),redhelper.define("view/sendFile",["application/dispatcher","jquery","config/setup","application/parent","config/lang","common/constants/sender","common/communication/messageTarget","view/progressBar","common/extensions/browserDetect","application/session.objects"],function(a,b,c,d,e,f,g,h,i,j){function k(a){if(a.dataTransfer.types)for(var b=0;b<a.dataTransfer.types.length;b++)if("Files"===a.dataTransfer.types[b])return!0;return!1}if(!j.free){var l=!1,m=!1;if(window.FileReader&&"Opera"!==i.browser){d.addHandler("fileDragged",function(){l=!0,FileReader&&b("body").addClass("fileDragged")}),d.addHandler("endDrag",function(){l=!1,l||m||setTimeout(function(){l||m||b("body").removeClass("fileDragged")},30)});var n=function(){var d=null;j.free||b(document).on({dragover:function(a){FileReader&&k(a.originalEvent)&&(a.preventDefault(),clearInterval(d),d=setInterval(function(){m=!1,l||b("body").removeClass("fileDragged"),clearInterval(d)},400),m||(m=!0,b("body").addClass("fileDragged")))}});var g=function(d){var g=new FormData,i=new h;i.setLegend(e.UPLOAD_LEGEND+" "+d.name),i.append(),i.setProgress(.01);var j=function(a){if(a.lengthComputable){var b=a.loaded/a.total;i.setProgress(.7*b),b>.96&&i.expWait()}return!0},k=!1,l=function(b){i.endWait(function(){k||(a.fire("fileAppended",{link:b,from:f.VISITOR}),k=!0)})},m=function(b){i.remove(),a.fire("showLabel",{loading:!1,text:413===b.status?e.UPLOAD_ERROR:e.UPLOAD_ERROR_TYPE}),setTimeout(function(){a.fire("hideLabel")},5e3)};g.append("file",d),b.ajax({url:c.FILE_UPLOAD,type:"POST",xhr:function(){var a=b.ajaxSettings.xhr();return a.upload&&a.upload.addEventListener("progress",j,!1),a},success:l,error:m,data:g,cache:!1,contentType:!1,processData:!1})};j.free||(b("<div id='dropArea'><div><div>"+e.DROP_HERE+"</div></div></div>").appendTo("#online"),b("#dropArea").on({drop:function(a){a.preventDefault();for(var b=a.originalEvent,c=b.dataTransfer.files,d=0;d<c.length;d++)g(c[d]);return!1}}),b("#uploadedFile").change(function(){g(b(this)[0].files[0])}),b("#fileUploadWrapper .text").html(e.FILE_UPLOAD))};a.addEventListener("ready",n)}var o;a.addEventListener("ready",function(){var d={};o=b('<iframe src="'+c.FILE_FRAME+'"/>'),o.bind("load",function(){if(o[0].contentWindow.location.href.indexOf("web.redhelper.ru/nx/upload")>-1){var b=o[0].contentWindow.document.body.innerHTML;if(b.indexOf("Too Large")>-1)return d.remove(),a.fire("showLabel",{loading:!1,text:e.UPLOAD_ERROR}),setTimeout(function(){a.fire("hideLabel")},5e3),void(o[0].contentWindow.document.location.href=c.FILE_FRAME);if(-1===b.indexOf("http://data.redhelper.ru"))return d.remove(),a.fire("showLabel",{loading:!1,text:e.UPLOAD_ERROR_UNKNOWN}),setTimeout(function(){a.fire("hideLabel")},5e3),void(o[0].contentWindow.document.location.href=c.FILE_FRAME);(b.indexOf("<body>")>-1||b.indexOf('"')>-1)&&(b=b.substring(b.indexOf("http://")),b=b.substring(0,b.indexOf("<"))),o[0].contentWindow.document.location.href=c.FILE_FRAME;var g=!0;d.endWait(function(){g&&(a.fire("fileAppended",{link:b,from:f.VISITOR}),g=!1)})}a.fire("ready:fileFrame",o[0].contentWindow)});var i=new g;i.addHandler("fileUploadStarted",function(){d=new h,d.setLegend(e.UPLOAD_LEGEND),d.append(),d.expWait()}),o[0].allowTransparency="true",o[0].frameBorder="0",o.appendTo("#fileSend"),i.init(o[0].contentWindow,"*","*",!0)})}}),redhelper.define("view/copyright",["config/lang"],function(a){var b='<div id="rh-copy"><span class="rh-textWrapper">'+a.COPYRIGHT+'</span> <a href="'+a.WEBSITE+'?copy" target="_blank">'+a.COPYRIGHT_NAME+"</a></div>";return b}),redhelper.define("view/standalone",["application/dispatcher","view/copyright","jquery","config/setup"],function(a,b,c,d){a.addEventListener("templateReceived",function(){d.STANDALONE&&c("body").append(b)})}),redhelper.define("view/androidFix",["common/extensions/jquery.plugins"],function(a){if(navigator.userAgent.indexOf("Android")>-1){var b=function(){return parseInt(a("#online .center").css("padding-top"),10)?void a("#onlinePanel").css("height",a("#online").height()-parseInt(a("#online .center").css("padding-top"),10)-parseInt(a("#online .center").css("padding-bottom"),10)+"px"):void setTimeout(b,100)};setTimeout(b,500)}}),redhelper.define("xmpp/departments",["application/session.objects","application/dispatcher"],function(a,b){var c=function(){var c=a.departments;if(c&&c.length){for(var d in c)c[d].online=Array.prototype.reduce.call(a.onlineOperators,function(b,e){try{b=b||Array.prototype.indexOf.call(e.departments,c[d].id)>-1&&("online"===e.status||e.name===a.chatStarted)}catch(f){}return b},!1);c.sort(function(a,b){return b.online===a.online?b.priority-a.priority:b.online?1:-1}),a.departments=c,b.fire("departmentsRefreshed")}};return b.addEventListener("sessionLoaded",function(){c()}),b.addEventListener("operatorsRefreshed",c),b.addEventListener("hideDepartments",function(){a.departmentsShown=!1}),b.addEventListener("showDepartments",function(){a.departmentsShown=!0}),b.addEventListener("changeDepartment",function(a){a.saveOperator||b.fire("refreshOperator")}),b.addEventListener("changeRealDepartment",function(c){a.currentDepartment=c.id,a.previousOperator=a.currentOperator,a.chatStarted="",a.currentOperator="-",a.realDepartment=c.id,b.fire("changeDepartment",{id:c.id,name:c.name})}),b.addEventListener("operatorRedirectOk",function(c){var d=c.operator.extractNode().toLowerCase();for(var e in a.onlineOperators)if(a.onlineOperators.hasOwnProperty(e)&&a.onlineOperators[e].name.toLowerCase()===d){var f=a.onlineOperators[e].departments;if(f&&f.length){for(var g in f)if(f.hasOwnProperty(g)&&f[g]===a.currentDepartment)return;a.currentDepartment=f[0]}else a.currentDepartment=0;b.fire("changeDepartment",{saveOperator:!0})}}),{getDepartment:function(b){for(var c in a.onlineOperators)if(a.onlineOperators.hasOwnProperty(c)&&a.onlineOperators[c].name.toLowerCase()===b)return a.onlineOperators[c].departments[0];return 0},getResponsible:function(b){if(b)return Array.prototype.reduce.call(a.onlineOperators,function(a,c){return Array.prototype.indexOf.call(c.departments,b)>-1&&a.push(c.name.toLowerCase()),a},[]);var c=a.departments[0].priority,d=[];for(var e in a.departments)if(a.departments.hasOwnProperty(e)&&a.departments[e].priority===c)for(var f in a.onlineOperators)a.onlineOperators.hasOwnProperty(f)&&a.onlineOperators[f].departments&&Array.prototype.indexOf.call(a.onlineOperators[f].departments,a.departments[e].id)>-1&&-1===d.indexOf(a.onlineOperators[f].name.toLowerCase())&&d.push(a.onlineOperators[f].name.toLowerCase());return d}}}),redhelper.define("common/extensions/utils",["common/extensions/browserDetect"],function(){return{enablePlaceholders:function(){this.hasPlaceholder()||($(".tmp-plc").remove(),$("input[placeholder], textarea[placeholder]").each(function(a,b){var c=$(b),d=c.width(),e=c.height(),f=c.prop("tagName"),g=$("<"+f+" class='tmp-plc'/>");g.css({position:"absolute",top:c.position().top+2*parseInt(c.css("borderWidth")),left:c.position().left+(parseInt(c.css("borderLeftWidth"),10)||0),width:d,height:e,paddingLeft:c.css("paddingLeft"),paddingTop:c.css("paddingTop"),lineHeight:c.css("lineHeight"),font:c.css("font"),border:"none",borderRadius:c.css("borderRadius"),color:"#ccc",background:"transparent",boxSizing:"content-box",boxShadow:"none"}).val(c.attr("placeholder")).mousedown(function(){$(this).focusout().hide(),setTimeout(function(){c.focus()},10)}),c.focus(function(){g.hide()}).focusout(function(){setTimeout(function(){c.val()||g.show()},100)}).after(g),c.val()&&g.hide()}))},hasPlaceholder:function(){return"placeholder"in document.createElement("input")}}}),redhelper.define("view/departments",["application/dispatcher","common/extensions/jquery.plugins","xmpp/departments","application/session.objects","config/lang","common/constants/sender","common/extensions/utils","common/extensions/browserDetect"],function(a,b,c,d,e,f,g,h){function i(a){if(a&&a.name)b(".showDepartments .txt").html(a.name);else{for(var c=e.DEPARTMENTS_BUTTON,f=0;f<d.departments.length;f++)d.departments[f].id===d.currentDepartment&&(c=d.departments[f].name);b(".showDepartments .txt").html(c)}}a.addEventListener("templateProcessed",function(){b("#departments").append(Array.prototype.reduce.call(d.departments,function(a,b){return a+"<li class='"+(b.online?"online":"offline")+"' data-department='"+b.id+"' title='"+e.CHOOSE_DEPARTMENT+" "+b.name+"'><span></span></span><div class='name'>"+b.name+'</div><div class="description">'+b.description+"</div></li>"},"")),b("#chooseDepartment").disableTextSelect(),b("#departmentsContainer").trigger("sizeChange"),a.addEventListener("showDepartments",function(){b("body").addClass("departmentsShow")}),a.addEventListener("hideDepartments",function(c){var d=$(window).width();if(b("body").hasClass("departmentsShow")){var e=b("#online, #offline").css({position:"absolute",left:-d});b("#chooseDepartment").css({position:"absolute",left:0}),b("body, li").attr("style","cursor: wait !important");var f=function(){b("body, li").css("cursor","");{var c=b("#chooseDepartment"),i=function(){setTimeout(function(){b("#online, #chooseDepartment, #offline").css({position:"relative",left:0}),b("body").removeClass("departmentsShow"),b("body").removeClass("departmentsForce"),a.fire("renderChat"),g.enablePlaceholders()},10)};!("Explorer"===h.browser||"Firefox"===h.browser)}c.animate({left:d},{duration:200,useCSS3:!1,complete:i}),e.animate({left:0},{duration:200,useCSS3:!1,complete:i}),a.removeEventListener("changeState",f)};c.immediate?f():a.addEventListener("changeState",f)}}),b("#departments li").on("click",function(){a.fire("hideDepartments"),a.fire("changeRealDepartment",{id:b(this).data("department"),name:b(this).find(".name").html()})}),d.departmentsType&&"hide"!==d.departmentsType&&d.departments.length>1&&b("body").addClass("departments"),"force"!==d.departmentsType||d.currentDepartment||!d.isPartiallyOnline||d.currentOperator||d.departments.length>1&&(b("body").addClass("departmentsForce departmentsShow"),b(".chooseDepartmentText").height()>20&&b("#departmentsWrapper").css("top","9.7em"),b("#departmentsContainer").trigger("sizeChange")),b(".showDepartments").click(function(){a.fire("showDepartments")}),a.addEventListener("showDepartments",function(){b("#online, #offline").css({position:"absolute",left:"0%"});var a=b("#chooseDepartment").css({position:"absolute",left:"100%"});b(".chooseDepartmentText").height()>20&&b("#departmentsWrapper").css("top","9.7em"),b("body").addClass("departmentsShow"),b("#departmentsContainer").trigger("sizeChange");var c=b("#online, #offline"),d=function(){setTimeout(function(){b("#online, #chooseDepartment, #offline").css({position:"relative",left:0})},10)};c.animate({left:-c.width()},{duration:200,useCSS3:!0,complete:d}),a.animate({left:0},{duration:200,useCSS3:!0,complete:d})}),a.addEventListener("forceDepartments",function(){b("body").addClass("departmentsForce"),b("body").hasClass("departmentsShow")||a.fire("showDepartments")}),b(".hideDepartments").click(function(){a.fire("hideDepartments",{immediate:!0})});for(var c=e.DEPARTMENTS_BUTTON,f=0;f<d.departments.length;f++)d.departments[f].id===d.currentDepartment&&(c=d.departments[f].name);b(".showDepartments").attr("title",e.MOVE_TO_DEPARTMENTS).find(".txt").html(c),b(".hideDepartments").attr("title",e.BACK_TO_CONVERSATION).find(".txt").html(e.BACK_TO_CONVERSATION),b(".hideDepartments.offline, .offline .hideDepartments").attr("title",e.BACK_TO_OFFLINE).find(".txt").html(e.BACK_TO_OFFLINE),b("#chooseDepartment .topText").html(d.free?e.DEFAULT_FIRST_MESSAGE:d.currentTopText||d.defaultText),b(".chooseDepartmentText").html(e.CHOOSE_DEPARTMENT)}),a.addEventListener("showDepartments",function(){a.fire("requestOnlineOperators"),b(".hideDepartments").attr("title",e.BACK_TO_CONVERSATION).find(".txt").html(e.BACK_TO_CONVERSATION),b(".hideDepartments.offline, .offline .hideDepartments").attr("title",e.BACK_TO_OFFLINE).find(".txt").html(e.BACK_TO_OFFLINE)}),d.dispatcher.addEventListener("onCurrentDepartmentChanged",function(a){a.inCurrentTab===!1&&i()}),a.addEventListener("changeDepartment",i),a.addEventListener("departmentsRefreshed",function(){for(var a in d.departments)b("li[data-department="+d.departments[a].id+"]").removeClass("online offline").addClass(d.departments[a].online?"online":"offline");b("#departmentsContainer").trigger("sizeChange")}),a.addEventListener("departmentChosen",function(){for(var a=e.DEPARTMENTS_BUTTON,c=0;c<d.departments.length;c++)d.departments[c].id===d.currentDepartment&&(a=d.departments[c].name);b(".showDepartments .txt").html(a)}),a.addEventListener("message.received",function(){a.fire("hideDepartments",{immediate:!0})})}),redhelper.define("view/hints",["common/extensions/jquery.plugins","config/lang","application/dispatcher"],function(a,b,c){c.addEventListener("ready:fileFrame",function(a){$(a.document).find("#file").attr("title",b.FILE_SEND_TITLE)}),c.addEventListener("templateProcessed",function(){a("#chatSend").attr("title",b.CHAT_SEND_TITLE),a("#like, #dislike").attr("title",b.RATE_TITLE),a(".showDepartment").attr("title",b.CHOOSE_DEPARTMENT_TITLE),a("#operatorLabel").text(b.OPERATOR+":")})}),redhelper.define("view/holdMessage",["application/session.objects","application/dispatcher","common/constants/sender","config/lang"],function(a,b,c,d){var e=108e5;b.addEventListener("sessionLoaded",function(){function c(){j?clearTimeout(j):k&&b.fire("hideLabel"),a.showHoldMessage=!1,k=!1,j=0}function f(){a.showHoldMessage=!0,k=!0,j=0,b.fire("showLabel",{text:d.HOLD_MESSAGE})}function g(){return(new Date).getTime()-a.lastOperatorChat<e}function h(){k||j||g()||(j=i(1e3*a.holdMessage.timeout))}function i(a){return a=a||200,setTimeout(f,a)}if(a.holdMessage&&a.holdMessage.enabled){var j=0,k=!1;b.addEventListener("message.new.incoming",c),b.addEventListener("message.new.outcoming",h),a.showHoldMessage&&b.addOneShotEventListener("operator",i)}})}),redhelper.define("xmpp/leaveContacts",["application/dispatcher","config/setup","common/extensions/jquery.plugins","application/session.objects"],function(a,b,c,d){a.addEventListener("sendContacts",function(e){var f=function(){c.ajax({url:b.NX_URL+"contacts/"+b.CLIENT_NAME,data:{name:e.name,email:e.email,phone:e.phone,vid:d.vid,operName:d.currentOperator,page:(b.CURRENT_URL||"").substr(0,256)},method:"GET",dataType:"jsonp",cache:!1,success:function(){a.fire("sendContactsSuccess")}})};if(d.vid)f();else{var g=function(){f(),a.fire("disconnect"),a.removeEventListener("authenticated",g)};a.addEventListener("authenticated",g),a.fire("xmppManagerStart")}})}),redhelper.define("view/leaveContacts",["application/dispatcher","application/session.objects","common/constants/sender","common/extensions/jquery.plugins","config/lang","xmpp/leaveContacts"],function(a,b,c,d,e){var f=108e5;a.addEventListener("sessionLoaded",function(){a.addEventListener("templateProcessed",function(){var c=0,g=!1;b.leaveContactsSuggestions&&b.leaveContactsSuggestions.enabled&&(b.hideLeaveContacts||(a.addEventListener("message.new.incoming",function(){c&&(clearTimeout(c),g=!1),g&&(a.fire("hideContactsForm"),g=!1)}),a.addEventListener("message.new.outcoming",function(){!g&&!c&&(new Date).getTime()-b.lastOperatorChat>f&&(c=setTimeout(function(){a.fire("showContactsForm"),g=!0,c=0},1e3*b.leaveContactsSuggestions.timeout))}),a.addEventListener("showContactsForm",function(){if(!b.contactsGot){g=!0;var c=d("<form onsubmit='return false;'><div id='leaveContactsText'>"+e.LEAVE_CONTACTS+"</div></form>");b.leaveContactsSuggestions.fields.indexOf("name")>-1&&c.append("<div class='leaveContactsInput'><input tabindex='1' placeholder='"+e.NAME+"' id='leaveContactsName'></div>"),b.leaveContactsSuggestions.fields.indexOf("email")>-1&&c.append("<div class='leaveContactsInput'><input tabindex='2' placeholder='"+e.EMAIL+"' id='leaveContactsEmail'></div>"),b.leaveContactsSuggestions.fields.indexOf("phone")>-1&&c.append("<div class='leaveContactsInput'><input tabindex='3' placeholder='"+e.PHONE+"' id='leaveContactsPhone'></div>"),c.append("<div class='leaveContactsError'></div>"),c.append("<div class='leaveContactsInput'><button type='button' id='leaveContactsSubmit'>"+e.SEND_BUTTON+"</button></div>"),a.fire("appendMessage",{html:d("<div></div>").append(c).html()}),a.addEventListener("hideMessage",function(){b.showLeaveContacts=!1,g=!1}),b.showLeaveContacts=!0,d("#leaveContactsPhone").mask("(999) 999-99-99"),d("#leaveContactsPhone").placeholder(),d("#leaveContactsEmail").placeholder(),d("#leaveContactsName").placeholder();var f=function(){var c=!1;return d(".leaveContactsInput input").removeClass("warning"),d("#leaveContactsName").length&&!d("#leaveContactsName").val()&&(c=!0,d("#leaveContactsName").addClass("warning")),d("#leaveContactsEmail").length&&!d("#leaveContactsEmail").val().match(/^[^@?&]+[@][a-zA-Z0-9\.\-]+[.][^@]{2,16}$/)&&(c=!0,d("#leaveContactsEmail").addClass("warning")),d("#leaveContactsPhone").length&&!d("#leaveContactsPhone").val().match(/^\+?([\(\)\-]?\d[\(\)\-]?\s?){6,20}$/)&&(c=!0,d("#leaveContactsPhone").addClass("warning")),c?(d(".leaveContactsError").text(e.INCORRECT_CONTACTS).show(),void a.fire("renderChat")):(d(".leaveContactsError").hide(),a.fire("sendContacts",{name:d("#leaveContactsName").val()||"",email:d("#leaveContactsEmail").val()||"",phone:d("#leaveContactsPhone").val()||""}),b.showLeaveContacts=!1,b.hideLeaveContacts=!0,!1)};d("#leaveContactsSubmit").click(f)}}),a.addEventListener("hideContactsForm",function(){a.fire("hideMessage")}),a.addEventListener("sendContactsSuccess",function(){b.contactsGot=!0,a.fire("appendMessage",{html:e.CONTACTS_SUCCESS})}),d("#chatItself").on("change","#leaveContactsName",function(){d("#leaveContactsName").val()?d("#leaveContactsName").css("border-color",""):d("#leaveContactsName").css("border-color","red")}),d("#chatItself").on("change","#leaveContactsEmail",function(){d("#leaveContactsEmail").val().match(/^[^@?&]+[@][a-zA-Z0-9\.\-]+[.][^@]{2,16}$/)?d("#leaveContactsEmail").css("border-color",""):d("#leaveContactsEmail").css("border-color","red")}),d("#chatItself").on("change","#leaveContactsPhone",function(){d("#leaveContactsPhone").val().match(/^\+?([\(\)\-]?\d[\(\)\-]?\s?){6,20}$/)?d("#leaveContactsPhone").css("border-color",""):d("#leaveContactsPhone").css("border-color","red")}),b.showLeaveContacts&&a.fire("showContactsForm")))})})}),redhelper.define("common/extensions/color",{parseRGB:function(a){var b=[];return b.push(parseInt(a.substr(1,2),16)),b.push(parseInt(a.substr(3,2),16)),b.push(parseInt(a.substr(5,2),16)),b},rgb2hsl:function(a){var b=a[0]/255,c=a[1]/255,d=a[2]/255,e=Math.max(b,c,d),f=Math.min(b,c,d),g=(e+f)/2,h=0,i=0;
e!==f&&(h=.5>g?(e-f)/(e+f):(e-f)/(2-e-f),i=b===e?(c-d)/(e-f):c===e?2+(d-b)/(e-f):4+(b-c)/(e-f)),g=100*g,h=100*h,i=60*i,0>i&&(i+=360);var j=[i,h,g];return j},hsl2rgb:function(a){var b,c,d,e=a[0],f=a[1]/100,g=a[2]/100,h=(1-Math.abs(2*g-1))*f,i=e/60,j=h*(1-Math.abs(i%2-1));void 0===e||isNaN(e)||null===e?b=c=d=0:i>=0&&1>i?(b=h,c=j,d=0):i>=1&&2>i?(b=j,c=h,d=0):i>=2&&3>i?(b=0,c=h,d=j):i>=3&&4>i?(b=0,c=j,d=h):i>=4&&5>i?(b=j,c=0,d=h):i>=5&&6>i&&(b=h,c=0,d=j);var k,l,m,n=g-h/2;return k=255*(b+n),l=255*(c+n),m=255*(d+n),k=Math.round(k),l=Math.round(l),m=Math.round(m),[k,l,m]},blend:function(a,b,c){return a=this.parseRGB(a),b=this.parseRGB(b),[Math.floor(a[0]*c+b[0]*(1-c)),Math.floor(a[1]*c+b[1]*(1-c)),Math.floor(a[2]*c+b[2]*(1-c))]},rgb2string:function(a){return"#"+a[0].toString(16)+a[1].toString(16)+a[2].toString(16)},toRGB:function(a){return a=a.replace("#",""),3==a.length&&(a=a.replace(/(.)/g,"$1$1")),a=parseInt(a,16),[a>>16,(65280&a)>>8,255&a]}}),redhelper.define("view/view",["application/session.objects","config/lang","config/setup","common/extensions/jquery.plugins","view/chat","common/constants/sender","common/constants/chatWindowStage","application/dispatcher","config/api","view/template","common/extensions/browserDetect","view/minbox","view/operatorRates","view/sendFile","view/standalone","view/androidFix","view/departments","view/hints","view/holdMessage","view/leaveContacts","common/extensions/utils","common/extensions/browserDetect","common/extensions/color"],function(Session,Lang,Setup,jQuery,Chat,Sender,ChatWindowStage,Dispatcher,API,Template,browserDetect,rqMinbox,operatorRates,sendFile,rqStandalone,rqAndroidFix,departments,rqHints,rqHold,rqLeaveContacts,Utils,BrowserDetect,Color){var templateLoadedHandlers=[],templateLoaded=!1;API.replaceCSS&&jQuery(function(){jQuery("#rh-css").attr("href",API.replaceCSS)});var redirectOkListener=function(a){Chat.hideLabel();var b=Lang.OPERATOR_REDIRECT_OK+" "+a.displayName;Chat.hideTyping(),Dispatcher.fire("showLabel",{text:b})},View={_firstMessageAppended:!1,_shown:!1,initLanguage:function(){if(!Session.locale)return void setTimeout(function(){View.initLanguage()},100);if(Lang.initLanguage(),jQuery("#offline .header").html(Lang.OFFLINE_HEADER),jQuery("#offline .description").html(Lang.OFFLINE_TEXT),jQuery("#name").attr("placeholder",Lang.NAME_LABEL),jQuery("#email").attr("placeholder",Lang.EMAIL_LABEL),jQuery("#message").attr("placeholder",Lang.MESSAGE_LABEL),jQuery("#phone").attr("placeholder",Lang.PHONE_LABEL),jQuery("#sendButton").text(Lang.SEND_BUTTON),jQuery("#throbber").text(Lang.THROBBER),jQuery("#offlineSuccess div").text(Lang.MAIL_SUCCESS),jQuery("#footer a").attr("href",Lang.WEBSITE),jQuery("#typingLabel .text").html(Lang.TYPING_LABEL),!jQuery("#online textarea").is(":focus")){var a=Session.currentTypedText;a&&jQuery("#online textarea").val(a)}jQuery("#rh-copy .rh-textWrapper").text(Lang.COPYRIGHT),jQuery("#rh-copy a").html(Lang.COPYRIGHT_NAME)},show:function(){if(!Setup.empty(Session.skin)&&!Setup.empty(Session.isOnline)){this.initLanguage(),Session.free?(jQuery("body").addClass("free"),jQuery("#rh-copy").find("a").attr("href",Lang.WEBSITE+"/?copy=limited")):jQuery("#rh-copy").find("a").attr("href",Lang.WEBSITE+"/?copy=pale");!function(){var a=0,b=jQuery("#offline"),c=2.6;b.find(".inputField").hide(),Session.offlineFields.indexOf("name")>-1&&(a+=c,c+=.357,b.find(".name").css("display","block")),Session.offlineFields.indexOf("email")>-1&&(a+=c,b.find(".email").css("display","block")),Session.offlineFields.indexOf("phone")>-1&&(c+=.357,a+=c,a>=8.8&&"Presto"!==browserDetect.browser&&(a=8.6),b.find(".phone").css("display","block"));var d=jQuery("#offline").css("display");"none"===d&&jQuery("#offline").show(),"none"===d&&jQuery("#offline").hide(),Session.offlineFields.indexOf("message")>-1&&b.find(".message").css("top",a+"em").show(),Session.offlineFields&&0===Session.offlineFields.length&&(b.find("#actionPanel").hide(),b.find(".topPanel").css("height","auto"))}(),document.title=Lang.PAGE_TITLE,(Session.currentOfflineText||Session.offlineText)&&jQuery("#offline .description").html(Session.currentOfflineText||Session.offlineText),Session.offlineHeader&&jQuery("#offline .header").html(Session.currentOfflineHeader||Session.offlineHeader),Dispatcher.fire("refreshOfflineForm"),jQuery("#topHeader, .topHeader").html(Session.currentHeader?Session.currentHeader:Session.defaultHeader);var a=function(){var a=jQuery("#topText"),b=jQuery("#topHeader"),c=a.minBox(30),d=b.minBox(28),e=jQuery("#online").css("display");"none"===e&&jQuery("#online").show();var f=jQuery(window).width()-(d>c?b.width():a.width())+Math.max(d,c)+5;"none"===e&&jQuery("#online").hide(),Dispatcher.fire("sendResize",{width:f})};if(jQuery("#topText").html(Session.currentTopText||Session.defaultText),a(),Dispatcher.addEventListener("chatOpened",function(){jQuery("#departmentsContainer")[0].innerWidth,jQuery("#departmentsContainer")[0].innerHeight,Dispatcher.fire("departmentsRefreshed"),a(),Dispatcher.fire("refreshOfflineForm")}),jQuery("#topText").height()>0&&Dispatcher.fire("refreshOfflineForm"),!Session.free){if("mac"==Session.skin)Session.chatColor&&jQuery(".colorifier").css("background","#"+Session.chatColor),Session.dispatcher.addEventListener("onChatColorChanged",function(){Session.chatColor?jQuery(".colorifier").css("background","#"+Session.chatColor):jQuery(".colorifier").css("background","none")}),Session.chatIntensity&&jQuery(".colorifier").css({opacity:Session.chatIntensity/600}),Session.dispatcher.addEventListener("onChatIntensityChanged",function(){jQuery(".colorifier").css(Session.chatIntensity?{opacity:Session.chatIntensity/600}:{opacity:.6})});else{if(Session.chatColor){var b=Color.toRGB(Session.chatColor),c=.2126*b[0]+.7152*b[1]+.0722*b[2];jQuery("html, body").css("background-color","#"+Session.chatColor),jQuery("#container").css("z-index","20000").addClass(c>170?"darkText":"lightText"),jQuery(".colorifier").css("background","#"+Session.chatColor),c>=221?jQuery("#offline input, #offline textarea, #departmentsWrapper, #online #chatInput, #chatContainer").css("background-color","#fff"):jQuery("#offline input, #offline textarea, #departmentsWrapper, #online #chatInput, #chatContainer").css("background-color","#f2f2f2")}Session.dispatcher.addEventListener("onChatColorChanged",function(){if(Session.chatColor){jQuery("html, body").css("background-color","#"+Session.chatColor),jQuery("#container").css("z-index","20000"),jQuery(".colorifier").css("background","#"+Session.chatColor);var a=Color.toRGB(Session.chatColor),b=.2126*a[0]+.7152*a[1]+.0722*a[2];b>170?jQuery(".colorText").css("color","#333"):jQuery(".colorText").css("color","#f5f5f5"),b>=221?jQuery("#offline input, #offline textarea, #departmentsWrapper, #online #chatInput, #chatContainer").css("background-color","#fff"):jQuery("#offline input, #offline textarea, #departmentsWrapper, #online #chatInput, #chatContainer").css("background-color","#f2f2f2")}else jQuery("html, body").css("background-color","#fff"),jQuery(".colorifier").css("background","none"),jQuery("#container").css("background-color","#e5e5e5"),jQuery(".colorText").css("color","none"),jQuery("#offline input, #offline textarea").css("background-color","#f2f2f2")})}var d=function(){(Session.defaultFace||Session.operAvatar)&&(jQuery("#face, .face").attr("src",Session.currentOperAvatar||Setup.getImageUrl(Session.operAvatar||Session.defaultFace)).attr("title",Session.operDisplayName||""),jQuery("#operatorName").text(Session.operDisplayName||""))};d(),Session.dispatcher.addEventListener("onCurrentOperAvatarChanged",d),Session.dispatcher.addEventListener("onOperDisplayNameChanged",d),Session.dispatcher.addEventListener("onOperAvatarChanged",d),Session.dispatcher.addEventListener("onFaceChanged",d)}jQuery(".topPanel, #footer, #sendButton, label").disableTextSelect(),jQuery(".topPanel").mousedown(function(a){a.stopPropagation()}),jQuery(Session.chatWindowStage===ChatWindowStage.ONLINE?"#offline":"#online").hide(),jQuery(Session.chatWindowStage===ChatWindowStage.ONLINE?"#online":"#offline").show(),Session.dispatcher.addEventListener("onIsOnlineChanged",function(a){a.inCurrentTab===!1&&Dispatcher.fire("changeState")}),Session.dispatcher.addEventListener("onChatWindowStageChanged",function(a){a.inCurrentTab===!1&&Dispatcher.fire("changeState")}),Dispatcher.addEventListener("changeState",function(a){"undefined"!=typeof a.online&&(Session.chatWindowStage=a.online?ChatWindowStage.ONLINE:ChatWindowStage.OFFLINE_FORM),Session.chatWindowStage===ChatWindowStage.ONLINE?(jQuery("#offline").hide(),jQuery("#online").show(),Dispatcher.fire("enableChat"),Dispatcher.fire("renderChat")):Session.chatStarted?Dispatcher.fire("disableChat",{reason:Lang.ALL_OFFLINE+(Session.offlineEnabled?"<br><a href='#offline'>"+Lang.LEAVE_MESSAGE+"</a>":"")}):(jQuery("#online").hide(),jQuery("#offline").show(),Utils.enablePlaceholders()),jQuery("body").removeClass("online offline").addClass(Session.chatWindowStage===ChatWindowStage.ONLINE?"online":"offline")}),Dispatcher.addEventListener("typing",function(){Chat.showTyping(),Chat.hideLabel()}),Dispatcher.addEventListener("typingStop",function(){Chat.hideTyping()}),Dispatcher.addEventListener("message.received",function(a){a.sender===Sender.OPERATOR&&Chat.hideTyping()}),Dispatcher.addEventListener("operatorRedirect",function(){Dispatcher.fire("showLabel",{text:Lang.OPERATOR_REDIRECT})}),Dispatcher.removeEventListener("operatorRedirectOk",redirectOkListener),Dispatcher.addEventListener("operatorRedirectOk",redirectOkListener),Dispatcher.addEventListener("operatorRedirectFail",function(){Chat.hideLabel()}),Session.rateEnabled&&jQuery("body").addClass("operatorRates"),Utils.enablePlaceholders()}},hide:function(){jQuery("#online, #offline").hide()},setTemplate:function(template){var scriptQueue=[];template=template.replace(/<template/i,"<div"),template=template.replace(/\/template/i,"/div"),jQuery(template).each(function(a){0!==a&&scriptQueue.push(jQuery(this).attr("src")?{src:jQuery(this).attr("src")}:{code:jQuery(this).html()})});var templateJQ=jQuery(template),noProcess=templateJQ.find("#fromOperator, #fromOperatorHeader, #fromVisitor, #fromVisitorHeader, #promptContainer").detach();if(template=Template.processTemplate(templateJQ),jQuery("#container").html(jQuery(template).html()+jQuery("<div/>").append(noProcess).html()),scriptQueue.length){var currentScript=-1,scriptLoader=function(){currentScript++,scriptQueue[currentScript].src?jQuery.getScript(scriptQueue[currentScript].src,scriptLoader):(eval(scriptQueue[currentScript].code),scriptLoader())};Dispatcher.addEventListener("ready",function(){scriptLoader()})}Dispatcher.fire("templateProcessed"),operatorRates.init(),jQuery("#chatContainer").length&&(jQuery("#chatItself").addClass("scroller"),jQuery("#chatContainer").addClass("scroller-parent"),Chat._baron=jQuery("#chatItself").baron({bar:"#chat_bar",freeze:!1,barOnCls:"baron"})),jQuery("#departmentsWrapper").length&&(jQuery("#departmentsContainer").addClass("scroller"),jQuery("#departmentsWrapper").addClass("scroller-parent"),Chat._baron=jQuery("#departmentsContainer").baron({bar:"#departments_bar",freeze:!1,barOnCls:"baron"}),jQuery("#departmentsContainer").trigger("sizeChange"))}},receivedHandler=function(a){Dispatcher.removeEventListener(receivedHandler),View.setTemplate(a.template),jQuery("body").addClass(a.isDefault?"rh-defaultTemplate":"rh-customTemplate"),"Explorer"===BrowserDetect.browser&&parseInt(BrowserDetect.version,10)<9&&jQuery("body").addClass("ie8")};return Dispatcher.addEventListener("templateReceived",receivedHandler),View});var Base64=function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b={encode:function(b){var c,d,e,f,g,h,i,j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),e=b.charCodeAt(k++),f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?h=i=64:isNaN(e)&&(i=64),j=j+a.charAt(f)+a.charAt(g)+a.charAt(h)+a.charAt(i);while(k<b.length);return j},decode:function(b){var c,d,e,f,g,h,i,j="",k=0;b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),h=a.indexOf(b.charAt(k++)),i=a.indexOf(b.charAt(k++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|i,j+=String.fromCharCode(c),64!=h&&(j+=String.fromCharCode(d)),64!=i&&(j+=String.fromCharCode(e));while(k<b.length);return j}};return b}(),MD5=function(){var a=0,b="",c=8,d=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c},e=function(a,b){return a<<b|a>>>32-b},f=function(a){for(var b=[],d=(1<<c)-1,e=0;e<a.length*c;e+=c)b[e>>5]|=(a.charCodeAt(e/c)&d)<<e%32;return b},g=function(a){for(var b="",d=(1<<c)-1,e=0;e<32*a.length;e+=c)b+=String.fromCharCode(a[e>>5]>>>e%32&d);return b},h=function(b){for(var c=a?"0123456789ABCDEF":"0123456789abcdef",d="",e=0;e<4*b.length;e++)d+=c.charAt(b[e>>2]>>e%4*8+4&15)+c.charAt(b[e>>2]>>e%4*8&15);return d},i=function(a){for(var c,d,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f="",g=0;g<4*a.length;g+=3)for(c=(a[g>>2]>>8*(g%4)&255)<<16|(a[g+1>>2]>>8*((g+1)%4)&255)<<8|a[g+2>>2]>>8*((g+2)%4)&255,d=0;4>d;d++)f+=8*g+6*d>32*a.length?b:e.charAt(c>>6*(3-d)&63);return f},j=function(a,b,c,f,g,h){return d(e(d(d(b,a),d(f,h)),g),c)},k=function(a,b,c,d,e,f,g){return j(b&c|~b&d,a,b,e,f,g)},l=function(a,b,c,d,e,f,g){return j(b&d|c&~d,a,b,e,f,g)},m=function(a,b,c,d,e,f,g){return j(b^c^d,a,b,e,f,g)},n=function(a,b,c,d,e,f,g){return j(c^(b|~d),a,b,e,f,g)},o=function(a,b){a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b;for(var c,e,f,g,h=1732584193,i=-271733879,j=-1732584194,o=271733878,p=0;p<a.length;p+=16)c=h,e=i,f=j,g=o,h=k(h,i,j,o,a[p+0],7,-680876936),o=k(o,h,i,j,a[p+1],12,-389564586),j=k(j,o,h,i,a[p+2],17,606105819),i=k(i,j,o,h,a[p+3],22,-1044525330),h=k(h,i,j,o,a[p+4],7,-176418897),o=k(o,h,i,j,a[p+5],12,1200080426),j=k(j,o,h,i,a[p+6],17,-1473231341),i=k(i,j,o,h,a[p+7],22,-45705983),h=k(h,i,j,o,a[p+8],7,1770035416),o=k(o,h,i,j,a[p+9],12,-1958414417),j=k(j,o,h,i,a[p+10],17,-42063),i=k(i,j,o,h,a[p+11],22,-1990404162),h=k(h,i,j,o,a[p+12],7,1804603682),o=k(o,h,i,j,a[p+13],12,-40341101),j=k(j,o,h,i,a[p+14],17,-1502002290),i=k(i,j,o,h,a[p+15],22,1236535329),h=l(h,i,j,o,a[p+1],5,-165796510),o=l(o,h,i,j,a[p+6],9,-1069501632),j=l(j,o,h,i,a[p+11],14,643717713),i=l(i,j,o,h,a[p+0],20,-373897302),h=l(h,i,j,o,a[p+5],5,-701558691),o=l(o,h,i,j,a[p+10],9,38016083),j=l(j,o,h,i,a[p+15],14,-660478335),i=l(i,j,o,h,a[p+4],20,-405537848),h=l(h,i,j,o,a[p+9],5,568446438),o=l(o,h,i,j,a[p+14],9,-1019803690),j=l(j,o,h,i,a[p+3],14,-187363961),i=l(i,j,o,h,a[p+8],20,1163531501),h=l(h,i,j,o,a[p+13],5,-1444681467),o=l(o,h,i,j,a[p+2],9,-51403784),j=l(j,o,h,i,a[p+7],14,1735328473),i=l(i,j,o,h,a[p+12],20,-1926607734),h=m(h,i,j,o,a[p+5],4,-378558),o=m(o,h,i,j,a[p+8],11,-2022574463),j=m(j,o,h,i,a[p+11],16,1839030562),i=m(i,j,o,h,a[p+14],23,-35309556),h=m(h,i,j,o,a[p+1],4,-1530992060),o=m(o,h,i,j,a[p+4],11,1272893353),j=m(j,o,h,i,a[p+7],16,-155497632),i=m(i,j,o,h,a[p+10],23,-1094730640),h=m(h,i,j,o,a[p+13],4,681279174),o=m(o,h,i,j,a[p+0],11,-358537222),j=m(j,o,h,i,a[p+3],16,-722521979),i=m(i,j,o,h,a[p+6],23,76029189),h=m(h,i,j,o,a[p+9],4,-640364487),o=m(o,h,i,j,a[p+12],11,-421815835),j=m(j,o,h,i,a[p+15],16,530742520),i=m(i,j,o,h,a[p+2],23,-995338651),h=n(h,i,j,o,a[p+0],6,-198630844),o=n(o,h,i,j,a[p+7],10,1126891415),j=n(j,o,h,i,a[p+14],15,-1416354905),i=n(i,j,o,h,a[p+5],21,-57434055),h=n(h,i,j,o,a[p+12],6,1700485571),o=n(o,h,i,j,a[p+3],10,-1894986606),j=n(j,o,h,i,a[p+10],15,-1051523),i=n(i,j,o,h,a[p+1],21,-2054922799),h=n(h,i,j,o,a[p+8],6,1873313359),o=n(o,h,i,j,a[p+15],10,-30611744),j=n(j,o,h,i,a[p+6],15,-1560198380),i=n(i,j,o,h,a[p+13],21,1309151649),h=n(h,i,j,o,a[p+4],6,-145523070),o=n(o,h,i,j,a[p+11],10,-1120210379),j=n(j,o,h,i,a[p+2],15,718787259),i=n(i,j,o,h,a[p+9],21,-343485551),h=d(h,c),i=d(i,e),j=d(j,f),o=d(o,g);return[h,i,j,o]},p=function(a,b){var d=f(a);d.length>16&&(d=o(d,a.length*c));for(var e=new Array(16),g=new Array(16),h=0;16>h;h++)e[h]=909522486^d[h],g[h]=1549556828^d[h];var i=o(e.concat(f(b)),512+b.length*c);return o(g.concat(i),640)},q={hexdigest:function(a){return h(o(f(a),a.length*c))},b64digest:function(a){return i(o(f(a),a.length*c))},hash:function(a){return g(o(f(a),a.length*c))},hmac_hexdigest:function(a,b){return h(p(a,b))},hmac_b64digest:function(a,b){return i(p(a,b))},hmac_hash:function(a,b){return g(p(a,b))},test:function(){return"900150983cd24fb0d6963f7d28e17f72"===MD5.hexdigest("abc")}};return q}();Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice,d=Array.prototype.concat,e=c.call(arguments,1);return function(){return b.apply(a?a:this,d.call(e,c.call(arguments,0)))}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),function(a){function b(a,b){return new f.Builder(a,b)}function c(a){return new f.Builder("message",a)}function d(a){return new f.Builder("iq",a)}function e(a){return new f.Builder("presence",a)}var f;f={VERSION:"1.0.2",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas"},addNamespace:function(a,b){f.NS[a]=b},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,forEachChild:function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++)e=a.childNodes[d],e.nodeType!=f.ElementType.NORMAL||b&&!this.isTagEqual(e,b)||c(e)},isTagEqual:function(a,b){return a.tagName.toLowerCase()==b.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var a;return void 0===document.implementation.createDocument?(a=this._getIEXmlDom(),a.appendChild(a.createElement("strophe"))):a=document.implementation.createDocument("jabber:client","strophe",null),a},xmlGenerator:function(){return f._xmlGenerator||(f._xmlGenerator=f._makeGenerator()),f._xmlGenerator},_getIEXmlDom:function(){for(var a=null,b=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],c=0;c<b.length&&null===a;c++)try{a=new ActiveXObject(b[c])}catch(d){a=null}return a},xmlElement:function(a){if(!a)return null;var b,c,d,e=f.xmlGenerator().createElement(a);for(b=1;b<arguments.length;b++)if(arguments[b])if("string"==typeof arguments[b]||"number"==typeof arguments[b])e.appendChild(f.xmlTextNode(arguments[b]));else if("object"==typeof arguments[b]&&"function"==typeof arguments[b].sort)for(c=0;c<arguments[b].length;c++)"object"==typeof arguments[b][c]&&"function"==typeof arguments[b][c].sort&&e.setAttribute(arguments[b][c][0],arguments[b][c][1]);else if("object"==typeof arguments[b])for(d in arguments[b])arguments[b].hasOwnProperty(d)&&e.setAttribute(d,arguments[b][d]);return e},xmlescape:function(a){return a=a.replace(/\&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/'/g,"&apos;"),a=a.replace(/"/g,"&quot;")},xmlTextNode:function(a){return a=f.xmlescape(a),f.xmlGenerator().createTextNode(a)},getText:function(a){if(!a)return null;var b="";0===a.childNodes.length&&a.nodeType==f.ElementType.TEXT&&(b+=a.nodeValue);for(var c=0;c<a.childNodes.length;c++)a.childNodes[c].nodeType==f.ElementType.TEXT&&(b+=a.childNodes[c].nodeValue);return b},copyElement:function(a){var b,c;if(a.nodeType==f.ElementType.NORMAL){for(c=f.xmlElement(a.tagName),b=0;b<a.attributes.length;b++)c.setAttribute(a.attributes[b].nodeName.toLowerCase(),a.attributes[b].value);for(b=0;b<a.childNodes.length;b++)c.appendChild(f.copyElement(a.childNodes[b]))}else a.nodeType==f.ElementType.TEXT&&(c=f.xmlGenerator().createTextNode(a.nodeValue));return c},escapeNode:function(a){return a.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(a){return a.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(a){return a.indexOf("@")<0?null:a.split("@")[0]},getDomainFromJid:function(a){var b=f.getBareJidFromJid(a);if(b.indexOf("@")<0)return b;var c=b.split("@");return c.splice(0,1),c.join("@")},getResourceFromJid:function(a){var b=a.split("/");return b.length<2?null:(b.splice(0,1),b.join("/"))},getBareJidFromJid:function(a){return a?a.split("/")[0]:null},log:function(){},debug:function(a){this.log(this.LogLevel.DEBUG,a)},info:function(a){this.log(this.LogLevel.INFO,a)},warn:function(a){this.log(this.LogLevel.WARN,a)},error:function(a){this.log(this.LogLevel.ERROR,a)},fatal:function(a){this.log(this.LogLevel.FATAL,a)},serialize:function(a){var b;if(!a)return null;"function"==typeof a.tree&&(a=a.tree());var c,d,e=a.nodeName;if(a.getAttribute("_realname")&&(e=a.getAttribute("_realname")),b="<"+e,a.attributes)for(c=0;c<a.attributes.length;c++)"_realname"!=a.attributes[c].nodeName&&(b+=" "+a.attributes[c].nodeName.toLowerCase()+"='"+a.attributes[c].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/</g,"&lt;")+"'");if(a.childNodes.length>0){for(b+=">",c=0;c<a.childNodes.length;c++)switch(d=a.childNodes[c],d.nodeType){case f.ElementType.NORMAL:b+=f.serialize(d);break;case f.ElementType.TEXT:b+=f.xmlescape(d.nodeValue);break;case f.ElementType.CDATA:b+="<![CDATA["+d.nodeValue+"]]>"}b+="</"+e+">"}else b+="/>";return b},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(a,b){f._connectionPlugins[a]=b}},f.Builder=function(a,b){("presence"==a||"message"==a||"iq"==a)&&(b&&!b.xmlns?b.xmlns=f.NS.CLIENT:b||(b={xmlns:f.NS.CLIENT})),b["process-delay"]=10,this.nodeTree=f.xmlElement(a,b),this.node=this.nodeTree},f.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return f.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(a){for(var b in a)a.hasOwnProperty(b)&&this.node.setAttribute(b,a[b]);return this},c:function(a,b,c){var d=f.xmlElement(a,b,c);return this.node.appendChild(d),c||(this.node=d),this},cnode:function(a){var b=f.xmlGenerator();try{var c=void 0!==b.importNode}catch(d){var c=!1}var e=c?b.importNode(a,!0):f.copyElement(a);return this.node.appendChild(e),this.node=e,this},t:function(a){var b=f.xmlTextNode(a);return this.node.appendChild(b),this}},f.Handler=function(a,b,c,d,e,g,h){this.handler=a,this.ns=b,this.name=c,this.type=d,this.id=e,this.options=h||{matchbare:!1},this.options.matchBare||(this.options.matchBare=!1),this.from=this.options.matchBare?g?f.getBareJidFromJid(g):null:g,this.user=!0},f.Handler.prototype={isMatch:function(a){var b,c=null;if(c=this.options.matchBare?f.getBareJidFromJid(a.getAttribute("from")):a.getAttribute("from"),b=!1,this.ns){var d=this;f.forEachChild(a,null,function(a){a.getAttribute("xmlns")==d.ns&&(b=!0)}),b=b||a.getAttribute("xmlns")==this.ns}else b=!0;return!b||this.name&&!f.isTagEqual(a,this.name)||this.type&&a.getAttribute("type")!=this.type||this.id&&a.getAttribute("id")!=this.id||this.from&&c!=this.from?!1:!0},run:function(a){var b=null;try{b=this.handler(a)}catch(c){throw f.fatal(c.sourceURL?"error: "+this.handler+" "+c.sourceURL+":"+c.line+" - "+c.name+": "+c.message:c.fileName?"error: "+this.handler+" "+c.fileName+":"+c.lineNumber+" - "+c.name+": "+c.message:"error: "+this.handler),c}return b},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},f.TimedHandler=function(a,b){this.period=a,this.handler=b,this.lastCalled=(new Date).getTime(),this.user=!0},f.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},f.Request=function(a,b,c,d){this.id=++f._requestId,this.xmlData=a,this.data=f.serialize(a),this.origFunc=b,this.func=b,this.rid=c,this.date=0/0,this.sends=d||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var a=new Date;return(a-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var a=new Date;return(a-this.dead)/1e3},this.xhr=this._newXHR()},f.Request.prototype={getResponse:function(){var a=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(a=this.xhr.responseXML.documentElement,"parsererror"==a.tagName)throw f.error("invalid response received"),f.error("responseText: "+this.xhr.responseText),f.error("responseXML: "+f.serialize(this.xhr.responseXML)),"parsererror"}else this.xhr.responseText&&(f.error("invalid response received"),f.error("responseText: "+this.xhr.responseText),f.error("responseXML: "+f.serialize(this.xhr.responseXML)));return a},_newXHR:function(){var a=null;return window.XMLHttpRequest?(a=new XMLHttpRequest,a.overrideMimeType&&a.overrideMimeType("text/xml")):window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHTTP")),a.onreadystatechange=this.func.bind(null,this),a}},f.Connection=function(a){this.service=a,this.jid="",this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.streamId=null,this.features=null,this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this.paused=!1,this.hold=1,this.wait=60,this.window=5,this._data=[],this._requests=[],this._uniqueId=Math.round(1e4*Math.random()),this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var b in f._connectionPlugins)if(f._connectionPlugins.hasOwnProperty(b)){var c=f._connectionPlugins[b],d=function(){};d.prototype=c,this[b]=new d,this[b].init(this)}},f.Connection.prototype={reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.streamId=null,this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this._requests=[],this._uniqueId=Math.round(1e4*Math.random())},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(a){return"string"==typeof a||"number"==typeof a?++this._uniqueId+":"+a:++this._uniqueId+""},connect:function(a,b,c,d,e){this.jid=a,this.pass=b,this.connect_callback=c,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.errors=0,this.wait=d||this.wait,this.hold=e||this.hold,this.domain=f.getDomainFromJid(this.jid);var g=this._buildBody().attrs({to:this.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":f.NS.BOSH});this._changeConnectStatus(f.Status.CONNECTING,null),this._requests.push(new f.Request(g.tree(),this._onRequestStateChange.bind(this,this._connect_cb.bind(this)),g.tree().getAttribute("rid"))),this._throttledRequestHandler()},attach:function(a,b,c,d,e,g,h){this.jid=a,this.sid=b,this.rid=c,this.connect_callback=d,this.domain=f.getDomainFromJid(this.jid),this.authenticated=!0,this.connected=!0,this.wait=e||this.wait,this.hold=g||this.hold,this.window=h||this.window,this._changeConnectStatus(f.Status.ATTACHED,null)},xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},send:function(a){if(null!==a){if("function"==typeof a.sort)for(var b=0;b<a.length;b++)this._queueData(a[b]);else this._queueData("function"==typeof a.tree?a.tree():a);this._throttledRequestHandler(),clearTimeout(this._idleTimeout),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(a,b,c,d){var e=null,f=this;"function"==typeof a.tree&&(a=a.tree());var g=a.getAttribute("id");g||(g=this.getUniqueId("sendIQ"),a.setAttribute("id",g));var h=this.addHandler(function(a){e&&f.deleteTimedHandler(e);var d=a.getAttribute("type");if("result"==d)b&&b(a);else{if("error"!=d)throw{name:"StropheError",message:"Got bad IQ type of "+d};c&&c(a)}},null,"iq",null,g);return d&&(e=this.addTimedHandler(d,function(){return f.deleteHandler(h),c&&c(null),!1})),this.send(a),g},_queueData:function(a){if(null===a||!a.tagName||!a.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(a)},_sendRestart:function(){this._data.push("restart"),this._throttledRequestHandler(),clearTimeout(this._idleTimeout),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(a,b){var c=new f.TimedHandler(a,b);return this.addTimeds.push(c),c},deleteTimedHandler:function(a){this.removeTimeds.push(a)},addHandler:function(a,b,c,d,e,g,h){var i=new f.Handler(a,b,c,d,e,g,h);return this.addHandlers.push(i),i},deleteHandler:function(a){this.removeHandlers.push(a)},disconnect:function(a){this._changeConnectStatus(f.Status.DISCONNECTING,a),f.info("Disconnect was called because: "+a),this.connected&&(this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._sendTerminate())},_changeConnectStatus:function(a,b){for(var c in f._connectionPlugins)if(f._connectionPlugins.hasOwnProperty(c)){var d=this[c];if(d.statusChanged)try{d.statusChanged(a,b)}catch(e){f.error(""+c+" plugin caused an exception changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(a,b)}catch(g){f.error("User connection callback caused an exception: "+g)}},_buildBody:function(){var a=b("body",{rid:this.rid++,xmlns:f.NS.HTTPBIND});return null!==this.sid&&a.attrs({sid:this.sid}),a},_removeRequest:function(a){f.debug("removing request");var b;for(b=this._requests.length-1;b>=0;b--)a==this._requests[b]&&this._requests.splice(b,1);a.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(a){var b=this._requests[a];null===b.dead&&(b.dead=new Date),this._processRequest(a)},_processRequest:function(a){var b=this._requests[a],c=-1;try{4==b.xhr.readyState&&(c=b.xhr.status)}catch(d){f.error("caught an error in _requests["+a+"], reqStatus: "+c)}if("undefined"==typeof c&&(c=-1),b.sends>5)return void this._onDisconnectTimeout();var e=b.age(),g=!isNaN(e)&&e>Math.floor(f.TIMEOUT*this.wait),h=null!==b.dead&&b.timeDead()>Math.floor(f.SECONDARY_TIMEOUT*this.wait),i=4==b.xhr.readyState&&(1>c||c>=500);if((g||h||i)&&(h&&f.error("Request "+this._requests[a].id+" timed out (secondary), restarting"),b.abort=!0,b.xhr.abort(),b.xhr.onreadystatechange=function(){},this._requests[a]=new f.Request(b.xmlData,b.origFunc,b.rid,b.sends),b=this._requests[a]),0===b.xhr.readyState){f.debug("request id "+b.id+"."+b.sends+" posting");try{b.xhr.open("POST",this.service,!0)}catch(j){return f.error("XHR open failed."),this.connected||this._changeConnectStatus(f.Status.CONNFAIL,"bad-service"),void this.disconnect()}var k=function(){try{b.date=new Date,b.xhr.send(b.data)}catch(a){throw a}};if(b.sends>1){var l=1e3*Math.min(Math.floor(f.TIMEOUT*this.wait),Math.pow(b.sends,3));setTimeout(k,l)}else k();b.sends++,this.xmlOutput!==f.Connection.prototype.xmlOutput&&this.xmlOutput(b.xmlData),this.rawOutput!==f.Connection.prototype.rawOutput&&this.rawOutput(b.data)
}else f.debug("_processRequest: "+(0===a?"first":"second")+" request has readyState of "+b.xhr.readyState)},_throttledRequestHandler:function(){f.debug(this._requests?"_throttledRequestHandler called with "+this._requests.length+" requests":"_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))},_onRequestStateChange:function(a,b){if(f.debug("request id "+b.id+"."+b.sends+" state changed to "+b.xhr.readyState),b.abort)return void(b.abort=!1);var c;if(4==b.xhr.readyState){c=0;try{c=b.xhr.status}catch(d){}if("undefined"==typeof c&&(c=0),this.disconnecting&&c>=400)return void this._hitError(c);var e=this._requests[0]==b,g=this._requests[1]==b;(c>0&&500>c||b.sends>5)&&(this._removeRequest(b),f.debug("request id "+b.id+" should now be removed")),200==c?((g||e&&this._requests.length>0&&this._requests[0].age()>Math.floor(f.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),f.debug("request id "+b.id+"."+b.sends+" got 200"),a(b),this.errors=0):(f.error("request id "+b.id+"."+b.sends+" error "+c+" happened"),(0===c||c>=400&&600>c||c>=12e3)&&(this._hitError(c),c>=400&&500>c&&(this._changeConnectStatus(f.Status.DISCONNECTING,null),this._doDisconnect()))),c>0&&500>c||b.sends>5||this._throttledRequestHandler()}},_hitError:function(a){this.errors++,f.warn("request errored, status: "+a+", number of errors: "+this.errors),this.errors>4&&this._onDisconnectTimeout()},_doDisconnect:function(){f.info("_doDisconnect was called"),this.authenticated=!1,this.disconnecting=!1,this.sid=null,this.streamId=null,this.rid=Math.floor(4294967295*Math.random()),this.connected&&(this._changeConnectStatus(f.Status.DISCONNECTED,null),this.connected=!1),this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[]},_dataRecv:function(a){try{var b=a.getResponse()}catch(c){if("parsererror"!=c)throw c;this.disconnect("strophe-parsererror")}if(null!==b){this.xmlInput!==f.Connection.prototype.xmlInput&&this.xmlInput(b),this.rawInput!==f.Connection.prototype.rawInput&&this.rawInput(f.serialize(b));for(var d,e;this.removeHandlers.length>0;)e=this.removeHandlers.pop(),d=this.handlers.indexOf(e),d>=0&&this.handlers.splice(d,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&0===this._requests.length)return this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null,void this._doDisconnect();var g,h,i=b.getAttribute("type");if(null!==i&&"terminate"==i){if(this.disconnecting)return;return g=b.getAttribute("condition"),h=b.getElementsByTagName("conflict"),null!==g?("remote-stream-error"==g&&h.length>0&&(g="conflict"),this._changeConnectStatus(f.Status.CONNFAIL,g)):this._changeConnectStatus(f.Status.CONNFAIL,"unknown"),void this.disconnect()}var j=this;f.forEachChild(b,null,function(a){var b,c;for(c=j.handlers,j.handlers=[],b=0;b<c.length;b++){var d=c[b];try{!d.isMatch(a)||!j.authenticated&&d.user?j.handlers.push(d):d.run(a)&&j.handlers.push(d)}catch(e){}}})}},_sendTerminate:function(){f.info("_sendTerminate was called");var a=this._buildBody().attrs({type:"terminate"});this.authenticated&&a.c("presence",{xmlns:f.NS.CLIENT,type:"unavailable"}),this.disconnecting=!0;var b=new f.Request(a.tree(),this._onRequestStateChange.bind(this,this._dataRecv.bind(this)),a.tree().getAttribute("rid"));this._requests.push(b),this._throttledRequestHandler()},_connect_cb:function(a){f.info("_connect_cb was called"),this.connected=!0;var c=a.getResponse();if(c){this.xmlInput!==f.Connection.prototype.xmlInput&&this.xmlInput(c),this.rawInput!==f.Connection.prototype.rawInput&&this.rawInput(f.serialize(c));var e,g,h=c.getAttribute("type");if(null!==h&&"terminate"==h)return e=c.getAttribute("condition"),g=c.getElementsByTagName("conflict"),void(null!==e?("remote-stream-error"==e&&g.length>0&&(e="conflict"),this._changeConnectStatus(f.Status.CONNFAIL,e)):this._changeConnectStatus(f.Status.CONNFAIL,"unknown"));this.sid||(this.sid=c.getAttribute("sid")),this.stream_id||(this.stream_id=c.getAttribute("authid"));var i=c.getAttribute("requests");i&&(this.window=parseInt(i,10));var j=c.getAttribute("hold");j&&(this.hold=parseInt(j,10));var k=c.getAttribute("wait");k&&(this.wait=parseInt(k,10));var l,m,n,o,p=!1,q=!1,r=!1,s=c.getElementsByTagName("mechanism");if(!(s.length>0)){var t=this._buildBody();return this._requests.push(new f.Request(t.tree(),this._onRequestStateChange.bind(this,this._connect_cb.bind(this)),t.tree().getAttribute("rid"))),void this._throttledRequestHandler()}for(l=0;l<s.length;l++)m=f.getText(s[l]),"DIGEST-MD5"==m?q=!0:"PLAIN"==m?p=!0:"ANONYMOUS"==m&&(r=!0);null===f.getNodeFromJid(this.jid)&&r?(this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(b("auth",{xmlns:f.NS.SASL,mechanism:"ANONYMOUS"}).tree())):null===f.getNodeFromJid(this.jid)?(this._changeConnectStatus(f.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect()):q?(this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge1_cb.bind(this),null,"challenge",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(b("auth",{xmlns:f.NS.SASL,mechanism:"DIGEST-MD5"}).tree())):p?(n=f.getBareJidFromJid(this.jid),n+="\x00",n+=f.getNodeFromJid(this.jid),n+="\x00",n+=this.pass,this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),o=Base64.encode(n),this.send(b("auth",{xmlns:f.NS.SASL,mechanism:"PLAIN"}).t(o).tree())):(this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(d({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:f.NS.AUTH}).c("username",{}).t(f.getNodeFromJid(this.jid)).tree()))}},_sasl_challenge1_cb:function(a){var c,d=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,e=Base64.decode(f.getText(a)),g=MD5.hexdigest(""+1234567890*Math.random()),h="",i=null,j="",k="";for(this.deleteHandler(this._sasl_failure_handler);e.match(d);)switch(c=e.match(d),e=e.replace(c[0],""),c[2]=c[2].replace(/^"(.+)"$/,"$1"),c[1]){case"realm":h=c[2];break;case"nonce":j=c[2];break;case"qop":k=c[2];break;case"host":i=c[2]}var l="xmpp/"+this.domain;null!==i&&(l=l+"/"+i);var m=MD5.hash(f.getNodeFromJid(this.jid)+":"+h+":"+this.pass)+":"+j+":"+g,n="AUTHENTICATE:"+l,o="";return o+="username="+this._quote(f.getNodeFromJid(this.jid))+",",o+="realm="+this._quote(h)+",",o+="nonce="+this._quote(j)+",",o+="cnonce="+this._quote(g)+",",o+='nc="00000001",',o+='qop="auth",',o+="digest-uri="+this._quote(l)+",",o+="response="+this._quote(MD5.hexdigest(MD5.hexdigest(m)+":"+j+":00000001:"+g+":auth:"+MD5.hexdigest(n)))+",",o+='charset="utf-8"',this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge2_cb.bind(this),null,"challenge",null,null),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(b("response",{xmlns:f.NS.SASL}).t(Base64.encode(o)).tree()),!1},_quote:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},_sasl_challenge2_cb:function(){return this.deleteHandler(this._sasl_success_handler),this.deleteHandler(this._sasl_failure_handler),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(b("response",{xmlns:f.NS.SASL}).tree()),!1},_auth1_cb:function(){var a=d({type:"set",id:"_auth_2"}).c("query",{xmlns:f.NS.AUTH}).c("username",{}).t(f.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return f.getResourceFromJid(this.jid)||(this.jid=f.getBareJidFromJid(this.jid)+"/strophe"),a.up().c("resource",{}).t(f.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(a.tree()),!1},_sasl_success_cb:function(){return f.info("SASL authentication succeeded."),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null),this._sendRestart(),!1},_sasl_auth1_cb:function(a){this.features=a;var b,c;for(b=0;b<a.childNodes.length;b++)c=a.childNodes[b],"bind"==c.nodeName&&(this.do_bind=!0),"session"==c.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(f.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var e=f.getResourceFromJid(this.jid);return this.send(e?d({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:f.NS.BIND}).c("resource",{}).t(e).tree():d({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:f.NS.BIND}).tree()),!1},_sasl_bind_cb:function(a){if("error"==a.getAttribute("type"))return f.info("SASL binding failed."),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1;var b,c=a.getElementsByTagName("bind");return c.length>0?(b=c[0].getElementsByTagName("jid"),void(b.length>0&&(this.jid=f.getText(b[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(d({type:"set",id:"_session_auth_2"}).c("session",{xmlns:f.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null))))):(f.info("SASL binding failed."),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(a){if("result"==a.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null);else if("error"==a.getAttribute("type"))return f.info("Session creation failed."),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1},_auth2_cb:function(a){return"result"==a.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null)):"error"==a.getAttribute("type")&&(this._changeConnectStatus(f.Status.AUTHFAIL,null),this.disconnect()),!1},_addSysTimedHandler:function(a,b){var c=new f.TimedHandler(a,b);return c.user=!1,this.addTimeds.push(c),c},_addSysHandler:function(a,b,c,d,e){var g=new f.Handler(a,b,c,d,e);return g.user=!1,this.addHandlers.push(g),g},_onDisconnectTimeout:function(){f.info("_onDisconnectTimeout was called");for(var a;this._requests.length>0;)a=this._requests.pop(),a.abort=!0,a.xhr.abort(),a.xhr.onreadystatechange=function(){};return this._doDisconnect(),!1},_onIdle:function(){for(var a,b,c,d;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)b=this.removeTimeds.pop(),a=this.timedHandlers.indexOf(b),a>=0&&this.timedHandlers.splice(a,1);var e=(new Date).getTime();for(d=[],a=0;a<this.timedHandlers.length;a++)b=this.timedHandlers[a],(this.authenticated||!b.user)&&(c=b.lastCalled+b.period,0>=c-e?b.run()&&d.push(b):d.push(b));this.timedHandlers=d;var g,h;if(this.authenticated&&0===this._requests.length&&0===this._data.length&&!this.disconnecting&&(f.info("no requests during idle cycle, sending blank request"),this._data.push(null)),this._requests.length<2&&this._data.length>0&&!this.paused){for(g=this._buildBody(),a=0;a<this._data.length;a++)null!==this._data[a]&&("restart"===this._data[a]?g.attrs({to:this.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":f.NS.BOSH}):g.cnode(this._data[a]).up());delete this._data,this._data=[],this._requests.push(new f.Request(g.tree(),this._onRequestStateChange.bind(this,this._dataRecv.bind(this)),g.tree().getAttribute("rid"))),this._processRequest(this._requests.length-1)}this._requests.length>0&&(h=this._requests[0].age(),null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(f.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),h>Math.floor(f.TIMEOUT*this.wait)&&(f.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(f.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())),clearTimeout(this._idleTimeout),this.connected&&(this._idleTimeout=setTimeout(this._onIdle.bind(this),100))}},a&&a(f,b,c,d,e)}(function(){window.Strophe=arguments[0],window.$build=arguments[1],window.$msg=arguments[2],window.$iq=arguments[3],window.$pres=arguments[4]}),redhelper.define("common/extensions/strophe.base",function(){}),redhelper.define("common/extensions/strophe",["common/extensions/strophe.base"],function(){Strophe.xmlTextNode=function(a){return Strophe.xmlGenerator().createTextNode(a)},Strophe.addConnectionPlugin("receipts",{_conn:null,_msgQueue:{},_retries:{},_resendCount:0,_resendTime:9e3,init:function(a){this._conn=a,Strophe.addNamespace("RECEIPTS","urn:xmpp:receipts")},statusChanged:function(a){if(a===Strophe.Status.CONNECTED||a===Strophe.Status.ATTACHED){this._conn.addHandler(this._onRequestReceived.bind(this),Strophe.NS.RECEIPTS,"message");var b=this;setTimeout(function(){b.resendQueue()},5e3)}},_onRequestReceived:function(a){return this._processReceipt(a),!0},sendMessage:function(a){var b=this._conn.getUniqueId();a.tree().setAttribute("id",b);var c=Strophe.xmlElement("request",{xmlns:Strophe.NS.RECEIPTS});return a.tree().appendChild(c),this._msgQueue[b]=a,this._retries[b]=0,this._conn.send(a.tree()),this.resendMessage(b),b},resendMessage:function(a){var b=this;setTimeout(function(){if(b._msgQueue[a]){if(!b._conn.connected)return void b.resendMessage(a);if(b._retries[a]++,b._retries[a]>b._resendCount)return;b._msgQueue[a].tree().setAttribute("from",b._conn.jid),b._conn.send(b._msgQueue[a].tree()),b.resendMessage(a)}},this._resendTime)},addReceiptHandler:function(a,b,c,d){var e=this,f=function(b){return e._processReceipt(b),a(b)};this._conn.addHandler(f,Strophe.NS.RECEIPTS,"message",b,null,c,d)},_processReceipt:function(a){var b=a.getAttribute("id"),c=a.getAttribute("from"),d=a.getElementsByTagName("request"),e=a.getElementsByTagName("received");if(d.length>0){var f=$msg({to:c,from:this._conn.jid,id:this._conn.getUniqueId()}),g=Strophe.xmlElement("received",{xmlns:Strophe.NS.RECEIPTS,id:b});f.tree().appendChild(g),this._conn.send(f)}if(e.length>0){var h=e[0].getAttribute("id");h&&(delete this._msgQueue[h],delete this._retries[h])}},resendQueue:function(){if(!this._conn.connected){var a=this;return void setTimeout(function(){a.resendQueue()},5e3)}for(var b in this._msgQueue)this._msgQueue.hasOwnProperty(b)&&(this._retries[b]++,this._retries[b]<=this._resendCount&&this._conn.send(this._msgQueue[b].tree()))},getUnreceivedMsgs:function(){var a=[];for(var b in this._msgQueue)this._msgQueue.hasOwnProperty(b)&&a.push(this._msgQueue[b]);return a},clearMessages:function(){this._msgQueue={}}}),Strophe.addConnectionPlugin("sendImmediately",{init:function(a){a.sendImmediately=function(a){if(null!==a){var b="";b="function"==typeof a.tree?a.tree():a;var c=this._buildBody();"restart"===b?c.attrs({to:this.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":Strophe.NS.BOSH}):c.cnode(b).up(),this._requests.push(new Strophe.Request(c.tree(),this._onRequestStateChange.bind(this,this._dataRecv.bind(this)),c.tree().getAttribute("rid"))),clearTimeout(this._idleTimeout),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)}}}})}),redhelper.define("xmpp/connection",["application/dispatcher","common/extensions/debug","config/setup","application/session.objects","common/extensions/strophe","common/extensions/browserDetect"],function(a,b,c,d){var e={disconnecting:!1,_errorHandlers:[],_reconId:null,_connection:null,_messageHandler:null,_reconnecting:!1,_attached:!1,_isConnecting:!1,_isConnected:!1,_reconnectTimeout:4e3,_defaultReconnectTimeout:4e3,_maxTimeout:3e4,_timeoutStep:1500,_connectionIndex:0,setMessageHandler:function(a){this._messageHandler=a},init:function(){this._connection=c.WEBSOCKET?new Strophe.WebSocket("ws://ej-testing2.redhelper.ru:5288/ws-xmpp"):new Strophe.Connection(c.BOSH_SERVICE),this._connection.rawInput=function(a){b.log("RECV: "+a);try{d.jid=e._connection.jid,d.rid=e._connection.rid,d.sid=e._connection.sid,d.lastXMPPTransfer=(new Date).getTime()}catch(c){b.error(c)}},this._connection.rawOutput=function(a){b.log("SEND: "+a);try{d.jid=e._connection.jid,d.rid=e._connection.rid,d.sid=e._connection.sid,d.lastXMPPTransfer=(new Date).getTime()}catch(c){b.error(c)}},this._connection.addHandler(e._messageHandler,null,"message",null,null,null),this._connection._hitError=function(a){var b;e._connection.errors++,e._connection.errors>4&&e._connection._onDisconnectTimeout();for(b in e._errorHandlers)e._errorHandlers.hasOwnProperty(b)&&"function"==typeof e._errorHandlers[b]&&e._errorHandlers[b](a,e._connection.errors)},this._connection.connect(c.XMPP_DOMAIN,"",e.onStatusChanged,50)},addErrorHandler:function(a){"function"==typeof a&&this._errorHandlers.push(a)},removeErrorHandlers:function(){this._errorHandlers=[]},checkPresence:function(){var a=$iq({type:"get"}).c("query",{xmlns:"consultant:presence",from:c.XMPP_DOMAIN,to:c.CLIENT_NAME.toOperatorJid()});this._connection.sendIQ(a.tree(),this.onPresence,e.reconnect,7e3)},disconnect:function(){e.disconnecting=!0,this._connection.disconnect()},pause:function(){e.paused=!0,this._connection.pause()},resume:function(){e.paused=!1,this._connection.resume()},reconnect:function(){e.disconnecting=!1,d.reconnecting=!0,this._connection.disconnect()},onStatusChanged:function(b){if(this._isConnecting=b==Strophe.Status.CONNECTING||b==Strophe.Status.AUTHENTICATING,b===Strophe.Status.CONNECTED||b===Strophe.Status.ATTACHED){e._isConnected=!0,a.fire("connected");var f=++e._connectionIndex;setTimeout(function(){f==e._connectionIndex&&a.fire("connection.canStormPackets",{canStormPackets:!0})},3e3+3e3*Math.random()),d.reconnecting&&(a.fire("refreshHistory"),d.reconnecting=!1),b===Strophe.Status.ATTACHED&&(a.fire("attached"),e._attached=!0),e._reconnectTimeout=e._defaultReconnectTimeout}else(b===Strophe.Status.DISCONNECTING||b===Strophe.Status.ERROR||b===Strophe.Status.CONNFAIL||b===Strophe.Status.AUTHFAIL)&&(e._connectionIndex++,a.fire("connection.canStormPackets",{canStormPackets:!1}),e._isAuthenticated=!1,e._isConnected=!1,e.disconnecting||(null===e._reconId&&(e._reconId=setTimeout(function(){e._connection.reset(),d.reconnecting=!0,e._connection.connect(c.XMPP_DOMAIN,"",e.onStatusChanged,50),e._connection.addHandler(e._messageHandler,null,"message",null,null,null),e._reconId=null},e._reconnectTimeout)),e._reconnectTimeout+=Math.random()*e._timeoutStep+e._timeoutStep,e._reconnectTimeout>e._maxTimeout&&(e._reconnectTimeout=e._maxTimeout)));return!0},onPresence:function(){a.fire("connected")},isAuthenticated:function(){return this._isAuthenticated},isConnected:function(){return!!e._isConnected},isConnecting:function(){return!!e._isConnecting}};return e}),redhelper.define("common/application/basicActivity",["application/dispatcher"],function(a){function b(a,b){this._prefix=b||"",this._dispatcher=null,this._CHECK_INTERVAL=a,this._intervalId=null,this._isUserAway=!1,this._flag=!1,this._children=[]}b.prototype={check:function(){return this._flag||this._isUserAway?void(this._flag=!1):(this._dispatcher.fire(this._prefix+"userAway"),void(this._isUserAway=!0))},isActive:function(){return!this._isUserAway},update:function(){var a;for(this._flag=!0,this._isUserAway&&(this._dispatcher.fire(this._prefix+"userBack"),this._isUserAway=!1),a=0;a<this._children.length;a++)this._children[a].update()},start:function(){if(!this._intervalId){var a=this;this._intervalId=setInterval(function(){a.check()},this._CHECK_INTERVAL)}},stop:function(){this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)},init:function(a,b){b&&(this._CHECK_INTERVAL=b),this._dispatcher=a},getChild:function(a,c){var d=new b(a,c);return d.init(this._dispatcher),this._children.push(d),d}};var c=new b(3e5);return c.init(a),c}),redhelper.define("application/timer",["application/session.objects","common/application/basicActivity"],function(a,b){var c=function(){var c=null,d=0,e=b.getChild(3e4,"timer_");return e.start(),{start:function(){c||(c=setInterval(function(){a.time++,d++},1e3))},stop:function(){clearInterval(c),c=null},getActivity:function(){return e},flush:function(){var a=d;return d=0,a}}}();return c.start(),c}),redhelper.define("xmpp/xmppException",[],function(){}),redhelper.define("xmpp/update",["application/session.objects","xmpp/connection","config/setup","application/timer","xmpp/xmppException","common/extensions/strophe"],function(a,b,c,d,e){var f={_firstUpdateSent:!1,simple:function(){if(a.vid){var e=$iq({type:"set"}).c("query",{xmlns:"consultant:update"}).c("vid").t(a.vid.toString()).up().c("clientName").t(c.CLIENT_NAME.toString()).up().c("time").t(d.flush().toString()).up();if(!f._firstUpdateSent){f._firstUpdateSent=!0;try{}catch(g){}}b.isConnected()&&b._connection.sendIQ(e,null,null,5e3)}},state:function(d){if(a.vid){var e=$iq({type:"set"}).c("query",{xmlns:"consultant:update"}).c("vid").t(a.vid.toString()).up().c("clientName").t(c.CLIENT_NAME.toString()).up();void 0===d&&(d="browse"),e.c("chatState").t(d),b.isConnected()&&b._connection.sendIQ(e,null,null,5e3)}},invite:function(d,e,g){if(a.vid){a.inviteState=e,void 0===g&&(g=a.trigger||""),a.trigger=g,a.stringChatState=d;var h=$iq({type:"set"}).c("query",{xmlns:"consultant:update"}).c("vid").t(a.vid.toString()).up().c("clientName").t(c.CLIENT_NAME.toString()).up();h.c("trigger").t(g).up().c("inviteState").t(e).up().c("chatState").t(d).up(),null!==b._connection&&b._connection.sendIQ(h,null,null,5e3)}else setTimeout(function(){f.invite(d,e,g)},400)},currentOperator:function(){if(!a.vid||!a.currentOperator)throw new e("currentOperator or vid not specified");var d=$iq({type:"set"}).c("query",{xmlns:"consultant:update"}).c("vid").t(a.vid.toString()).up().c("currentOperator").t(a.currentOperator).up().c("departmentId").t(a.currentDepartment).up().c("clientName").t(c.CLIENT_NAME.toString()).up();b._connection.sendIQ(d,null,null,5e3)},inviteSniff:function(d,e){if(a.vid){var f=$iq({type:"set"}).c("query",{xmlns:"consultant:update"}).c("vid").t(a.vid.toString()).up().c("clientName").t(c.CLIENT_NAME.toString()).up();if(void 0===d||""===d)return;void 0===e&&(e=""),f.c("trigger").t(d).up().c("operator").t(e).up(),b._connection.sendIQ(f,null,null,2e3)}},customFields:function(c){if(!a.free&&b.isConnected()){if(!a.vid)return void setTimeout(function(){f.customFields(c)},2e3);var d=$iq({type:"set"}).c("query",{xmlns:"consultant:update"}).c("vid").t(a.vid.toString()).up().c("keys");for(var e in c)c.hasOwnProperty(e)&&d.c("key").c("name").t(c[e].name).up().c("value").t(c[e].value).up().up();d.up(),b._connection.sendIQ(d,null,null,5e3)}}};return f}),redhelper.define("xmpp/requestOnline",["application/dispatcher","config/setup","common/extensions/jquery.plugins","application/session.objects"],function(a,b,c,d){var e=function(){c.ajax({url:b.APP_URL+"nx/presence/"+b.CLIENT_NAME+"?page="+encodeURI(b.PARENT_URI),dataType:"jsonp",success:function(b){d.onlineOperators=b.operators,a.fire("operatorsRefreshed")},error:function(){a.fire("operatorsRefreshed")}})};a.addEventListener("requestOnlineOperators",e),a.addEventListener("operatorsRefreshed",function(){if(!d.isPartiallyOnline)for(var b in d.onlineOperators)d.onlineOperators.hasOwnProperty(b)&&(d.isPartiallyOnline||void 0!==d.onlineOperators[b].onPage&&!d.onlineOperators[b].onPage||"offline"===d.onlineOperators[b].status||(d.isPartiallyOnline=!0,a.fire("xmppManagerStart")))})}),redhelper.define("xmpp/currentOperator",["application/session.objects","application/dispatcher","common/constants/sender"],function(a,b){b.addEventListener("message.received",function(){a.chatStarted=a.currentOperator}),b.addEventListener("invitation",function(b){b.from&&(a.chatStarted=b.from,a.currentOperator=b.from)}),b.addEventListener("message.new",function(){a.lastChat=(new Date).getTime()}),a.lastChat&&(new Date).getTime()-a.lastChat>864e5&&(a.chatStarted="",a.currentOperator="",a.currentDepartment=0,a.realDepartment=0)}),redhelper.define("common/extensions/mozvisibility",[],function(){MozVisibility={_MAX_TRIES:10,_date:new Date,_tries:0,_timer:null,_isVisible:void 0,_proxy:function(a,b){return b=b||window,function(){a.apply(b,arguments)}},_getEvent:function(){return this._event||(this._event=document.createEvent("HTMLEvents"),this._event.initEvent("mozvisibilitychange",!0,!0),this._event.eventName="mozvisibilitychange"),this._event},_setVisibilityState:function(a){this._isVisible="visible"===a,document.mozVisibilityState=a,document.mozHidden=!this._isVisible,document.dispatchEvent(this._getEvent())},_visibilityCheck:function(){this._date=new Date,this._tries=0,this._timer=setTimeout(this._invisibilityCheckTimeout,0)},_invisibilityCheckTimeoutTemplate:function(){var a=new Date,b=a-this._date;this._date=a,this._tries++,b>1e3?this._setVisibilityState("hidden"):this._tries<this._MAX_TRIES&&(this._timer=setTimeout(this._invisibilityCheckTimeout,0))},_onFocus:function(){clearTimeout(this._timer),this._isVisible||this._setVisibilityState("visible")},_onBlur:function(){this._isVisible&&this._visibilityCheck()},canBeEmulated:function(){var a=/(mozilla)(?:.*? rv:([\w.]+))?/,b=navigator.userAgent.toLowerCase(),c=b.indexOf("compatible")<0&&a.exec(b)||[];return window.top===window&&c[2]&&parseInt(c[2])>=5&&!document.visibilityState&&!document.MozVisibilityState},emulate:function(){return this.canBeEmulated()?(this._invisibilityCheckTimeout=this._proxy(this._invisibilityCheckTimeoutTemplate,this),window.addEventListener("focus",this._proxy(this._onFocus,this),!1),window.addEventListener("blur",this._proxy(this._onBlur,this),!1),this._visibilityCheck(),!0):!1}},MozVisibility.emulate()}),redhelper.define("common/extensions/visibility.fallback",["common/extensions/mozvisibility"],function(){if(!(document.visibilityState||document.webkitVisibilityState||document.msVisibilityState||document.mozVisibilityState||document.oVisibilityState)){document.hidden=!1,document.visibilityState="visible";var a=null,b=function(){document.createEvent?(a||(a=document.createEvent("HTMLEvents"),a.initEvent("visibilitychange",!0,!0)),document.dispatchEvent(a)):"object"==typeof Visibility&&Visibility._onChange.call(Visibility,{})},c=function(){document.hidden=!1,document.visibilityState="visible",b()},d=function(){document.hidden=!0,document.visibilityState="hidden",b()};document.addEventListener?(window.addEventListener("focus",c,!0),window.addEventListener("blur",d,!0)):(document.attachEvent("onfocusin",c),document.attachEvent("onfocusout",d))}}),redhelper.define("common/extensions/visibility.core",["common/extensions/visibility.fallback"],function(){var a=function(a){return"undefined"!=typeof a},b={onVisible:function(a){if(!this.isSupported()||!this.hidden())return a(),this.isSupported();var c=this.change(function(){b.hidden()||(b.unbind(c),a())});return c},change:function(a){if(!this.isSupported())return!1;this._lastCallback+=1;var b=this._lastCallback;return this._callbacks[b]=a,this._setListener(),b},unbind:function(a){delete this._callbacks[a]},afterPrerendering:function(a){if(!this.isSupported()||"prerender"!=this.state())return a(),this.isSupported();var c=this.change(function(d,e){"prerender"!=e&&(b.unbind(c),a())});return c},hidden:function(){return this._prop("hidden",!1)},state:function(){return this._prop("visibilityState","visible")},isSupported:function(){return a(this._prefix())},_doc:window.document,_prefixes:["webkit","moz","o","ms"],_chechedPrefix:null,_listening:!1,_lastCallback:-1,_callbacks:{},_hiddenBefore:!1,_init:function(){this._hiddenBefore=this.hidden()},_prefix:function(){if(null!==this._chechedPrefix)return this._chechedPrefix;if(a(this._doc.visibilityState))return this._chechedPrefix="";for(var b,c=0;c<this._prefixes.length;c++)if(b=this._prefixes[c]+"VisibilityState",a(this._doc[b]))return this._chechedPrefix=this._prefixes[c]},_name:function(a){var b=this._prefix();return""==b?a:b+a.substr(0,1).toUpperCase()+a.substr(1)},_prop:function(a,b){return this.isSupported()?this._doc[this._name(a)]:b},_onChange:function(a){var b=this.state();for(var c in this._callbacks)this._callbacks[c].call(this._doc,a,b);this._hiddenBefore=this.hidden()},_setListener:function(){if(!this._listening){var a=this._prefix()+"visibilitychange",c=function(){b._onChange.apply(b,arguments)};this._doc.addEventListener?this._doc.addEventListener(a,c,!1):this._doc.attachEvent(a,c),this._listening=!0,this._hiddenBefore=this.hidden()}}};return b._init(),b}),redhelper.define("application/command",["application/parent","application/dispatcher","jquery","xmpp/connection","application/session.objects"],function(a){function b(a){a.length>i&&a.splice(0,a.length-i),window.localStorage.setItem(h,JSON.stringify(a))}function c(){var a=window.localStorage.getItem(h);(void 0===a||null===a)&&(a="");try{var b=JSON.parse(a);return void 0===b?[]:b}catch(c){return[]}}function d(b){try{b.command in f&&f[b.command](b.args),a.send("command.received",b)}catch(c){}}function e(){for(var a=c(),b={},e=(new Date).getTime(),f=0;f<a.length;f++){var h=a[f];!(h.id in g)&&e-h.time<=h.ignoreAfter&&d(h),b[h.id]=!0}g=b}var f={},g=[],h="rhlp.commandQueue",i=5,j=function(a){var b="key"in a?a.key:"";b===h&&e()};window.addEventListener?(window.addEventListener("storage",j,!1),window.addEventListener("onstorage",j,!1)):(window.attachEvent("onstorage",j),document.attachEvent("onstorage",j)),setInterval(e,1e3);var k={execute:function(a,d,e){var f=c();f.push({id:(new Date).getTime(),command:a,args:d,time:(new Date).getTime(),ignoreAfter:e||1e3}),b(f)},setHandler:function(a,b){f[a]=b},clearHandler:function(a){delete f[a]}};return a.addHandler("command.send",function(a){k.execute(a.command,a.arguments,a.ignoreAfter)}),k}),redhelper.define("common/extensions/tabs",["common/extensions/compatibility","config/setup","common/extensions/visibility.core","common/extensions/browserDetect","application/command"],function(a,b,c,d){{var e="rhlp.tabs."+b.CLIENT_NAME+".",f=e+"i",g=e+"leader",h=e+"state",i=1200,j=function(){},k=function(){},l=function(){},m=function(){},n={id:(new Date).getTime(),setId:function(a){var b=r();n.id=a,b&&q()}},o=function(){return localStorage.getItem(h)||localStorage.setItem(h,"election"),localStorage.getItem(h)},p=function(){return parseInt(localStorage.getItem(g)||"0",10)},q=function(){localStorage.setItem(g,n.id),u()},r=function(){return p()===n.id},s=function(){localStorage.setItem(h,"election"),q(),setTimeout(function(){t()},i)},t=function(){r()&&localStorage.setItem(h,"elected")},u=function(){localStorage.setItem(f,(new Date).getTime())},v=function(){return(new Date).getTime()-parseInt(localStorage.getItem(f),10)<1500},w=o();r()}return setInterval(function(){"election"===o()&&(p()<n.id||!v())&&(q(),setTimeout(function(){t()},i)),r()&&u(),v()||s(),o()!==w&&(w=o(),"election"===o()?l():(m(),r()?j():k()))},"Explorer"===d.browser?500:300),{active:function(a){j=a,"elected"===o()&&r()&&a()},inactive:function(a){k=a,"elected"!==o()||r()||a()},election:function(a){l=a,"election"===o()&&a()},electionEnd:function(a){m=a,"elected"===o()&&a()
},forceElection:function(){s()},isLeader:function(){return r()},isLeaderElected:function(){return"elected"===o()&&v()},actualize:function(){n.setId((new Date).getTime()),r()?j():s()}}}),redhelper.define("xmpp/queue",["xmpp/connection","application/session.objects","config/setup","common/extensions/jquery.plugins","xmpp/update","application/dispatcher","common/extensions/strophe","common/constants/sender","common/constants/chatWindowStage","config/lang","xmpp/requestOnline","xmpp/currentOperator","xmpp/departments","common/extensions/tabs"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o={getOperator:function(){try{if(!n.isLeaderElected())return void setTimeout(o.getOperator,100);if(!n.isLeader())return;if(null===a._connection||!b.vid)return void setTimeout(o.getOperator,100);var d=b.currentOperator,e=b.chatStarted,g=b.realDepartment;d=e||d,(!b.lastChat||(new Date).getTime()-b.lastChat>864e5)&&(e="",d="");var h=[],i=$iq({type:"get"}).c("query",{xmlns:"consultant:queue"}).c("client").t(c.CLIENT_NAME).up().c("vid").t(b.vid.toString()).up();"string"==typeof c.REQUIRE_OPERATOR&&""!==c.REQUIRE_OPERATOR&&i.c("require").t(c.REQUIRE_OPERATOR).up();var j=b.onlineOperators;for(var k in j)j.hasOwnProperty(k)&&void 0===j[k].onPage&&(j[k].onPage=1);if(b.requiredOperator){var l=b.requiredOperator.toLowerCase().split(",");for(k in j)j.hasOwnProperty(k)&&-1===l.indexOf(j[k].name.toLowerCase())&&(j[k].onPage=0)}var p=[];for(k in j)j.hasOwnProperty(k)&&j[k].onPage&&p.push(j[k].name);var q={};if(d&&"-"!==d)for(k in j)j.hasOwnProperty(k)&&j[k].name.toLowerCase()===(e||d).toLowerCase()&&(q=j[k]);if(d&&"-"!==d)h=g&&q.departments&&q.departments.indexOf(g)>-1?m.getResponsible(g):"force"!==b.departmentsType||1===b.departments.length?p:[e||d];else if(g){var r=!1;for(k in b.departments)b.departments.hasOwnProperty(k)&&b.departments[k].id===g&&(r=!0,h=m.getResponsible(g));if(!r){if(b.realDepartment=0,b.currentDepartment=0,"force"===b.departmentsType&&b.departments.length>1)return void f.fire("forceDepartments");h=p}}else if(p.length>0){if("force"===b.departmentsType&&b.departments.length>1)return void f.fire("forceDepartments");h=p}d&&"-"!==d&&i.c("operator").t(d).up(),i.c("responsible").t("'"+h.join("','")+"'").up(),a._connection.sendIQ(i,o.onGetOperator,o.onGetOperatorFail,5e3)}catch(s){}},checkOperator:function(){function e(a){(b.chatWindowStage===i.ONLINE&&!d("operator",a).text()||b.chatWindowStage===i.OFFLINE_FORM&&d("operator",a).text())&&f.fire("changeState",{online:!!d("operator",a).text()});var c=d("operator",a).text().toLowerCase();if(c){if(b.chatStarted&&b.currentOperator&&b.currentOperator!==c&&f.fire("showLabel",{text:j.OPERATOR_REDIRECT_OK+b.operDisplayName,loading:!1}),b.currentOperator=c,!b.currentDepartment){for(var e in b.onlineOperators)b.onlineOperators.hasOwnProperty(e)&&b.onlineOperators[e].name.toLowerCase()===c.toLowerCase()&&b.onlineOperators[e].departments&&(b.currentDepartment=b.onlineOperators[e].departments[0],"force"===b.departmentsType&&(b.realDepartment=b.currentDepartment));f.fire("departmentChosen"),"force"===b.departmentsType&&f.fire("hideDepartments",{immediate:!0})}f.fire("operator")}}var g=$iq({type:"get"}).c("query",{xmlns:"consultant:queue"}).c("client").t(c.CLIENT_NAME).up().c("vid").t(b.vid.toString()).up();"string"==typeof c.REQUIRE_OPERATOR&&""!==c.REQUIRE_OPERATOR&&g.c("require").t(c.REQUIRE_OPERATOR).up(),b.currentOperator&&"-"!==b.currentOperator&&b.chatStarted===b.currentOperator&&g.c("operator").t(b.currentOperator),a._connection.sendIQ(g,e,e,1e4)},onGetOperator:function(c){try{if(d("operator",c).text()){if(b.currentOperator&&b.currentOperator!==d("operator",c).text()){f.fire("showLabel",{text:j.OPERATOR_REDIRECT_OK+" "+d("displayName",c).text()});var g=function(a){a.sender===h.OPERATOR&&(f.fire("hideLabel"),f.removeEventListener("message.received",g))};f.addEventListener("message.received",g)}var i=d("operator",c).text().toLowerCase(),k=b.chatStarted&&b.currentOperator&&b.currentOperator!==i;if(b.currentOperator=i,b.operDisplayName=d("displayName",c).text(),b.operAvatar=d("avatar",c).text(),!b.currentDepartment){for(var l in b.onlineOperators)b.onlineOperators.hasOwnProperty(l)&&b.onlineOperators[l].name.toLowerCase()===b.currentOperator.toLowerCase()&&b.onlineOperators[l].departments&&(b.currentDepartment=b.onlineOperators[l].departments[0]);f.fire("departmentChosen")}if(e.currentOperator(),f.fire("operator"),f.fire("changeState",{online:!0}),k&&f.fire("showLabel",{text:j.OPERATOR_REDIRECT_OK+" "+b.operDisplayName,loading:!1}),b.previousOperator&&b.realDepartment){var m=$msg({type:"chat",content:"notify-department-change",to:b.previousOperator.toOperatorJid(),jid:b.vid.toVisitorJid()});m.c("body").up().c("department").t(b.currentDepartment).up().c("operator").t(i).up(),a._connection.send(m.tree()),b.previousOperator=""}b.preferredOperator&&b.currentOperator!==b.preferredOperator&&(f.fire("showLabel",{text:b.preferredOperatorError||j.NO_PREFERRED_OPERATOR,loading:!1}),f.addOneShotEventListener("message.new",function(){f.fire("hideLabel")}))}else if(b.departments&&b.departments.length>1&&"force"===b.departmentsType&&!b.realDepartment){var n=b.onlineOperators;for(var o in n)if(n.hasOwnProperty(o)&&"online"===n[o].status&&(void 0!==n[o].onPage&&n.onPage||void 0===n[o].onPage))return void f.fire("forceDepartments")}else b.isOnline=!1,f.fire("changeState",{online:!1}),b.free&&f.fire("disconnect")}catch(p){}},onGetOperatorFail:function(){b.isOnline=!1,f.fire("changeState",{online:!1}),c.QUEUE_DELAY_COUNT++,setTimeout(function(){o.getOperator()},3e3)}};return o}),redhelper.define("common/extensions/mouse",["common/extensions/jquery.plugins"],function(a){function b(a){return{x:a.x||0,y:a.y||0,width:a.width,height:a.height,scrollX:a.scrollX,scrollY:a.scrollY,windowHeight:a.windowHeight,windowWidth:a.windowWidth}}function c(){if(t){var a=0;for(a=0;a<k.length;a+=1)k[a].send("getMouse");for(a=0;a<l.length;a+=1)l[a].send("getMouse");o()}}var d="unknown",e=50,f={},g={},h=!1,i=!1,j=0,k=[],l=[],m={},n={},o=function(){},p=function(){},q=!1,r=!1,s=!1,t=!1,u=function(){return"innerHeight"in window?window.innerHeight:a(window).height()};return{init:function(){return a("body").hover(function(){h=!0},function(){h=!1}).mouseleave(function(){h=!1,i=!1,j=0}).mouseenter(function(){h=!0,i=!0}),f.width=Math.max(a("html").width(),a(window).width()),f.height=Math.max(a("html").height(),a(window).height()),f.windowHeight=u(),f.windowWidth=a(window).width(),f.scrollX=a("body").scrollLeft(),f.scrollY=a("body").scrollTop(),f.x=0,f.y=0,a("body").bind("scroll",function(){f.scrollX=a("body").scrollLeft(),f.scrollY=a("body").scrollTop()}),a(window).mousemove(function(b){j+=1,!i&&1>=j||(h=!0,f={x:b.pageX-a("body").scrollLeft(),y:b.pageY-a("body").scrollTop(),width:Math.max(a(document).width(),a(window).width()),height:Math.max(a(document).height(),a(window).height()),windowHeight:u(),windowWidth:a(window).width(),scrollX:a("body").scrollLeft(),scrollY:a("body").scrollTop()})}),a(window).bind("scroll",function(){f.scrollX=a("body").scrollLeft(),f.scrollY=a("body").scrollTop(),h=!0}),a("html").bind("click",function(b){q=!0,r=!1,s=!1,h=!0,f={x:b.pageX-a("body").scrollLeft(),y:b.pageY-a("body").scrollTop(),width:Math.max(a(document).width(),a(window).width()),height:Math.max(a(document).height(),a(window).height()),windowHeight:u(),windowWidth:a(window).width(),scrollX:a("body").scrollLeft(),scrollY:a("body").scrollTop()}}),a("html").bind("mouseup",function(b){s=!0,r=!1,f={x:b.pageX-a("body").scrollLeft(),y:b.pageY-a("body").scrollTop(),width:Math.max(a("html").width(),a(window).width()),height:Math.max(a(document).height(),a(window).height()),windowHeight:u(),windowWidth:a(window).width(),scrollX:a("body").scrollLeft(),scrollY:a("body").scrollTop()}}),a("html").bind("mousedown",function(b){r=!0,s=!1,f={x:b.pageX-a("body").scrollLeft(),y:b.pageY-a("body").scrollTop(),width:Math.max(a("html").width(),a(window).width()),height:Math.max(a(document).height(),a(document).height()),windowHeight:u(),windowWidth:a(window).width(),scrollX:a("body").scrollLeft(),scrollY:a("body").scrollTop()}}),this},enable:function(){t=!0},disable:function(){t=!1},setAsSlave:function(c){d="slave",c.addHandler("getMouse",function(){var a=b(f);a.isInside=h,a.clicked=q,a.mouseDown=r,a.mouseUp=s,q=!1,r=!1,s=!1,"function"==typeof p&&p(a),c.send("mouseData",a)});var e=function(){c.send("forceLeave"),a("html").unbind("mousemove",e),setTimeout(function(){a("html").mousemove(e)},1500)};return a("html").mousemove(e),this},setAsMaster:function(){return d="master",setInterval(c,e),this},addParentSlave:function(a){return"function"==typeof a.send&&(k.push(a),a.addHandler("mouseData",function(a){m=a}),a.addHandler("forceLeave",function(){h=!1})),this},addChildSlave:function(a){return"function"==typeof a.send&&(l.push(a),a.addHandler("mouseData",function(a){a.isInside&&(n=a)})),this},setHandler:function(a){return o=a,this},force:function(){return o(),this},setOffsetFunction:function(a){return p=a,this},getMouseData:function(){var a=b(f);return a.isInside=h,a.clicked=q,a.mouseDown=r,a.mouseUp=s,q=!1,r=!1,s=!1,"function"==typeof p&&p(a),n.isInside?(n.mouseUp|=a.mouseUp,g=b(n),n):(m.windowHeight&&(a.scrollX=m.scrollX,a.scrollY=m.scrollY,a.width=m.width,a.height=m.height,a.windowHeight=m.windowHeight,a.windowWidth=m.windowWidth),!a.isInside&&m.isInside?(m.mouseUp|=a.mouseUp,g=b(m),m):(m.x=a.x,m.y=a.y,g=b(a),a))},getParentMouseData:function(){return m},getChildMouseData:function(){return n}}}),redhelper.define("common/communication/cobrowseEncoder",[],function(){return{encode:function(a){var b=a.id+",";b+=a.width+","+a.height+","+a.chatWidth+",",b+=a.chatHeight+","+a.chatX+","+a.chatY+","+a.chatState+",",b+=a.windowHeight+","+a.windowWidth;var c;for(c=0;c<a.xArr.length;c+=1)b+=";",a.insideArr[c]?(b+=a.clickedArr[c]?"c,":a.downArr[c]?"d,":a.upArr[c]?"u,":"i,",b+=a.xArr[c]+","+a.yArr[c],b+=a.scrollYArr[c]?","+a.scrollYArr[c]:",0",b+=a.scrollXArr[c]?","+a.scrollXArr[c]:",0"):b+=">";return b},decode:function(a){if("[object Object]"===Object.prototype.toString.call(a))return a;try{if(a.indexOf("{")>-1)return JSON.parse(a)}catch(b){return void 0}try{var c=a.split(";"),d={},e=c[0].split(",");d.id=e[0],d.width=e[1],d.height=e[2],d.chatWidth=parseInt(e[3],10),d.chatHeight=parseInt(e[4],10),d.chatX=parseInt(e[5],10),d.chatY=parseInt(e[6],10),d.chatState=parseInt(e[7],10),d.windowHeight=parseInt(e[8],10),d.windowWidth=parseInt(e[9],10),d.xArr=[],d.yArr=[],d.scrollXArr=[],d.scrollYArr=[],d.clickedArr=[],d.upArr=[],d.downArr=[],d.insideArr=[];var f,g=0,h=0,i=0,j=0;for(f=1;f<c.length;f+=1){var k=c[f].split(",");d.clickedArr.push("c"===k[0]?1:0),d.upArr.push("u"===k[0]?1:0),d.downArr.push("d"===k[0]?1:0),">"===k[0]?(d.xArr.push(i),d.yArr.push(j),d.insideArr.push(0)):(i=parseInt(k[1],10),j=parseInt(k[2],10),d.xArr.push(i),d.yArr.push(j),d.insideArr.push(1)),k[3]&&(h=parseInt(k[3],10)),k[4]&&(g=parseInt(k[4],10)),d.scrollXArr.push(g),d.scrollYArr.push(h)}return d}catch(l){return void 0}}}}),redhelper.define("application/connectionQueue",["application/parent","application/dispatcher","jquery","xmpp/connection","application/session.objects"],function(a,b,c,d,e){function f(a){a.length>j&&a.splice(0,a.length-j),window.localStorage.setItem(i,JSON.stringify(a))}function g(){var a=window.localStorage.getItem(i);(void 0===a||null===a)&&(a="");try{var b=JSON.parse(a);return void 0===b?[]:b}catch(c){return[]}}function h(){if(d.isConnected()&&e.vid){var a=g();if(0!==a.length){f([]);for(var b=0;b<a.length;b++)if(a.hasOwnProperty(b)){var h=a[b].value,i=c.parseXML(h);d._connection.send(i.documentElement)}}}}var i="rhlp.connection.packetQueue",j=15,k=function(a){var b="key"in a?a.key:"";b===i&&h()};return window.addEventListener?(window.addEventListener("storage",k,!1),window.addEventListener("onstorage",k,!1)):(window.attachEvent("onstorage",k),document.attachEvent("onstorage",k)),setInterval(h,1e3),{send:function(a,b){var c=g();b&&(c=c.filter(function(a){return a.type!==b})),c.push({type:b,value:a.toString()}),f(c),h()},clear:function(a){var b=g();b=b.filter(function(b){return b.type!==a}),f(b),h()}}}),redhelper.define("xmpp/messages",["application/session.objects","xmpp/connection","xmpp/queue","application/dispatcher","common/constants/sender","common/extensions/jquery.plugins","common/application/time","common/extensions/mouse","common/extensions/strophe","common/communication/cobrowseEncoder","application/parent","common/constants/chatState","common/constants/chatWindowStage","xmpp/departments","application/connectionQueue"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){d.addEventListener("message.new.outcoming",function(){o.clear("partial")});var p={_isTypedTextChanged:"",_firstMessageSent:!1,_isTyping:!1,_lockOperatorTyping:!1,_notTypingCount:0,_mouseOperators:{},_isMouseSniffed:!1,_immediateMouse:!1,_receivedMessage:{},_typingTimer:null,sniff:function(){if(a.vid&&a.currentOperator){var b=a.currentTypedText.replace(/[\n]+$/g," "),c=$msg({to:a.currentOperator.toOperatorJid(),jid:a.vid.toVisitorJid(),type:"chat",content:"partial"}).c("body").t(b).up();this._isTypedTextChanged&&b?(this._isTypedTextChanged=!1,this._isTyping||(c.c("composing",{xmlns:"http://jabber.org/protocol/chatstates"}).up(),this._isTyping=!0,this._lockOperatorTyping=!0),o.send(c,"partial")):p._isTyping&&(this._notTypingCount<3?this._notTypingCount++:(this._notTypingCount=0,c.c("paused",{xmlns:"http://jabber.org/protocol/chatstates"}).up(),o.send(c,"partial"),p._isTyping=!1))}},touchOperator:function(){var b=$msg({to:a.currentOperator.toOperatorJid(),jid:a.vid.toVisitorJid(),type:"chat",content:"partial"}).c("body").t("").up();b.c("composing",{xmlns:"http://jabber.org/protocol/chatstates"}).up(),o.send(b,"partial"),b=$msg({to:a.currentOperator.toOperatorJid(),jid:a.vid.toVisitorJid(),type:"chat",content:"partial"}).c("body").t("").up(),b.c("paused",{xmlns:"http://jabber.org/protocol/chatstates"}).up(),o.send(b,"partial")},typedTextChanged:function(){this._isTypedTextChanged=!0},onMessageReceived:function(b){try{var c=b.getAttribute("to");if(null===c)return;var h=c.split("@");h[0].toLowerCase(),c=h.join("@");var i=b.getAttribute("from"),j=i.split("@");j[0].toLowerCase(),i=j.join("@");var l=b.getAttribute("displayName"),o=b.getAttribute("type");if(b.getElementsByTagName("result").length){var q=b.getElementsByTagName("result")[0];"consultant:queue"===q.getAttribute("xmlns")&&setTimeout(function(){d.fire("refreshOperator")},5e3)}if("invitation"===b.getAttribute("content"))return i.extractNode()===a.currentOperator?d.fire("invitation",{type:"invitation",message:f("body",b).text()}):(d.fire("invitation",{type:"invitation",message:f("body",b).text(),from:i.extractNode()}),d.fire("updateServerInfo")),!0;if("mouse"===b.getAttribute("content"))"on"===f("state",b).text()?d.fire("sniffMouse",{operator:i.extractNode()}):d.fire("stopSniffMouse",{operator:i.extractNode()});else if("session"===b.getAttribute("content"))if("on"===f("state",b).text()){var r=a.sessionViewers;r.push(i.extractNode()),a.sessionViewers=r,k.send("cloneSession"),a.isCloneSessionActive=!0}else a.isCloneSessionActive=!1;else if("typing"===b.getAttribute("content")){if(!f("body",b).text()||"start"===f("body",b).text()){if(!p._firstMessageSent&&a.currentOperator!==a.chatStarted||p._lockOperatorTyping){var s=function(a){if(a.sender===e.VISITOR){var b=setTimeout(function(){d.fire("typing")},2500),c=function(a){a.sender===e.OPERATOR&&(clearTimeout(b),d.removeEventListener("message.received",c))};d.addEventListener("message.received",c)}d.removeEventListener("message.received",s)};d.addEventListener("message.received",s)}else d.fire("typing");clearTimeout(p._typingTimer),p._typingTimer=setTimeout(function(){d.fire("typingStop")},1500)}}else if("command"===b.getAttribute("content")){var t;try{t=JSON.parse(f("body",b).text())}catch(u){}"highlight"===t.type&&d.fire(t),"redirect"===t.type&&d.fire(t),"html"===t.type&&(a.compress=void 0!==t.compress&&t.compress,d.fire("sniffMouse",{operator:i.extractNode(),html:!0,time:0,force:!0})),"mouse"===t.type&&("on"===t.state?d.fire("sniffMouse",{operator:i.extractNode()}):d.fire("stopSniffMouse",{operator:i.extractNode()})),"forms"===t.type&&k.send("sniffFormData"),"url"===t.type&&d.fire("retrieveURL",{to:i})}else if("rename"===b.getAttribute("content")){var v=Strophe.getText(b.getElementsByTagName("body")[0]);v&&d.fire("setCustomName",{name:v})}else if(!b.getAttribute("content")||"normal"===b.getAttribute("content")){var w,x=Strophe.getText(b.getElementsByTagName("body")[0]);if(x){if(w=b.getElementsByTagName("body")[0].getAttribute("mid"),w&&p._receivedMessage[w])return!0;w&&(p._receivedMessage[w]=!0)}if(a.chatWindowStage===m.OFFLINE_FORM&&(a.currentOperator=i.extractNode()||a.currentOperator,"-"==a.currentOperator&&(a.currentOperator=""),d.fire("refreshOperator")),f("replace",b).length)return d.fire("replaceMessage",{type:"replaceMessage",guid:f("replace",b).attr("id"),text:x}),!0;if(x&&(0===x.indexOf(":g")||0===x.indexOf(":г"))){var y=x.substr(3);return d.fire("redirect",{link:y}),!0}if(x&&0===x.indexOf(":sv"))return k.send("startSessionView",{from:i.extractNode()}),!0;if(x&&0===x.indexOf(":ssv"))return k.send("stopSessionView",{from:i.extractNode()}),!0;if(x&&0===x.indexOf(":r"))return d.fire("operatorRedirect"),!0;if(x&&x.indexOf(":ok redirect")>-1)return d.fire("operatorRedirectOk",{operator:i,displayName:l}),!0;if(x&&0===x.indexOf(":seize"))return a.lastChat=(new Date).getTime(),d.fire("operatorRedirectOk",{operator:i,displayName:l}),!0;if(x&&0===x.indexOf(":fail redirect"))return d.fire("operatorRedirectFail"),!0;if(x&&0===x.indexOf(":ban"))return a.allowed=!1,d.fire("disconnect"),d.fire("changeState",{online:!1}),!1;if("chat"===o&&x){var z=g.now().toString();d.fire("message.received",{type:"message",time:z,text:x,sender:e.OPERATOR,displayName:l,guid:f("body",b).attr("mid"),id:(new Date).getTime(),unixTime:(new Date).getTime()}),a.currentOperator||(a.currentOperator=i.extractNode(),a.operDisplayName=l,a.currentDepartment=n.getDepartment(i),"force"===a.departmentsType&&(a.realDepartment=a.currentDepartment),d.fire("refreshOperator"),"force"===a.departmentsType&&d.fire("hideDepartments",{immediate:!0})),k.send("message.displayed")}}return!0}catch(A){return!0}},onMessageSent:function(c){if(c.raw)return void b._connection.send(f(c.text));if("-"!==a.currentOperator&&""!==a.currentOperator){if(!c.sent)return void(c.sender===e.VISITOR&&(p._firstMessageSent=!0));if(c.sender===e.VISITOR&&"chat"!==a.stringChatState&&(a.stringChatState="chat",d.fire("updateChatState",{state:"chat"})),c.sender===e.VISITOR){p._lockOperatorTyping=!1;var g=$msg({to:a.currentOperator.toOperatorJid(),jid:a.vid.toVisitorJid(),type:"chat",st:c.st}).c("body").attrs({mid:c.guid}).t(c.text).up();p._firstMessageSent||g.c("active",{xmlns:"http://jabber.org/protocol/chatstates"}).up(),b._connection.receipts.sendMessage(g),b._connection.sendIQ($iq({type:"get"}).c("query",{xmlns:"consultant:ping"})),c.sender===e.VISITOR&&(p._firstMessageSent=!0)}}}};return p}),redhelper.define("view/cssChecker",["common/extensions/jquery.plugins","application/dispatcher"],function(a,b){var c={_defaultCssLoadSelector:"rh-loadCss",_checkLoadInterval:50,check:function(a,b){void 0===a&&(a=this._defaultCssLoadSelector),this._listenCssLoad(a,b)},_listenCssLoad:function(d,e){"1"===a("#"+d).css("z-index")?void 0!==e?b.fire(e):setTimeout(function(){b.fire("cssLoaded")},200):setTimeout(function(){c._listenCssLoad(d,e)},c._checkLoadInterval)}};return c}),redhelper.define("application/statistics",["application/session.objects"],function(a){var b=12e5,c=!1,d=!1,e=!1;return{checkNewVisit:function(){if(!d){var e=new Date(a.lastVisit),f=new Date;a.lastVisit=(new Date).toString(),c=f.getTime()-e.getTime()>b}return c},checkNewDay:function(){var b=new Date(a.previousDay),c=new Date;return e=c.getTime()-b.getTime()>864e5,e&&(a.previousDay=(new Date).toString()),e}}}),redhelper.define("common/extensions/punycode",[],function(){var a={};return function(a){function b(a){throw RangeError(z[a])}function c(a,b){for(var c=a.length;c--;)a[c]=b(a[c]);return a}function d(a,b){var d=".";return c(a.split(d),b).join(d)}function e(a){for(var b,c,d=[],e=0,f=a.length;f>e;)b=a.charCodeAt(e++),55296==(63488&b)&&f>e?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):d.push(b,c)):d.push(b);return d}function f(a){return c(a,function(a){var b="";return a>65535&&(a-=65536,b+=C(a>>>10&1023|55296),a=56320|1023&a),b+=C(a)}).join("")}function g(a){return 10>a-48?a-22:26>a-65?a-65:26>a-97?a-97:p}function h(a,b){return a+22+75*(26>a)-((0!=b)<<5)}function i(a,b,c){var d=0;for(a=c?B(a/t):a>>1,a+=B(a/b);a>A*r>>1;d+=p)a=B(a/A);return B(d+(A+1)*a/(a+s))}function j(a){var c,d,e,h,j,k,l,m,n,s,t=[],x=a.length,y=0,z=v,A=u;for(d=a.lastIndexOf(w),0>d&&(d=0),e=0;d>e;++e)a.charCodeAt(e)>=128&&b("not-basic"),t.push(a.charCodeAt(e));for(h=d>0?d+1:0;x>h;){for(j=y,k=1,l=p;h>=x&&b("invalid-input"),m=g(a.charCodeAt(h++)),(m>=p||m>B((o-y)/k))&&b("overflow"),y+=m*k,n=A>=l?q:l>=A+r?r:l-A,!(n>m);l+=p)s=p-n,k>B(o/s)&&b("overflow"),k*=s;c=t.length+1,A=i(y-j,c,0==j),B(y/c)>o-z&&b("overflow"),z+=B(y/c),y%=c,t.splice(y++,0,z)}return f(t)}function k(a){var c,d,f,g,j,k,l,m,n,s,t,x,y,z,A,D=[];for(a=e(a),x=a.length,c=v,d=0,j=u,k=0;x>k;++k)t=a[k],128>t&&D.push(C(t));for(f=g=D.length,g&&D.push(w);x>f;){for(l=o,k=0;x>k;++k)t=a[k],t>=c&&l>t&&(l=t);for(y=f+1,l-c>B((o-d)/y)&&b("overflow"),d+=(l-c)*y,c=l,k=0;x>k;++k)if(t=a[k],c>t&&++d>o&&b("overflow"),t==c){for(m=d,n=p;s=j>=n?q:n>=j+r?r:n-j,!(s>m);n+=p)A=m-s,z=p-s,D.push(C(h(s+A%z,0))),m=B(A/z);D.push(C(h(m,0))),j=i(d,y,f==g),d=0,++f}++d,++c}return D.join("")}function l(a){return d(a,function(a){return y.test(a)?j(a.slice(4).toLowerCase()):a})}function m(a){return d(a,function(a){return x.test(a)?"xn--"+k(a):a})}var n,o=2147483647,p=36,q=1,r=26,s=38,t=700,u=72,v=128,w="-",x=/[^ -~]/,y=/^xn--/,z={overflow:"Overflow: input needs wider integers to process.","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},A=p-q,B=Math.floor,C=String.fromCharCode;n={version:"1.1.1",ucs2:{decode:e,encode:f},decode:j,encode:k,toASCII:m,toUnicode:l,decodeUri:function(a){var b=a.split("//").pop().split("/")[0],c=l(b);return a.replace(b,c)},encodeUri:function(a){var b=a.split("//").pop().split("/")[0],c=m(b);return a.replace(b,c)}},a.punycode=n}(a),a.punycode}),redhelper.define("xmpp/authentication",["xmpp/connection","application/dispatcher","application/session.objects","common/constants/sender","common/extensions/jquery.plugins","common/application/time","application/statistics","config/setup","common/extensions/browserDetect","common/extensions/strophe","common/communication/encoder","common/extensions/debug","common/extensions/punycode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n={resendAuth:function(){c.viewedPages!==c.viewedPages&&(c.viewedPages=0);try{a._connection.send($pres().tree());try{var b=h.CURRENT_URL.split("//")[0],d=h.CURRENT_URL.split("//")[1],e=d.split("/"),f=m.toUnicode(e.shift()),j=decodeURIComponent(e.join("/"));d=b+"//"+f+"/"+j}catch(p){d=h.CURRENT_URL}try{var q=c.referrer.split("//")[0],r=c.referrer.split("//")[1],s=r.split("/"),t=m.toUnicode(s.shift()),u=decodeURIComponent(s.join("/"));r=q+"//"+t+"/"+u}catch(p){r=c.referrer}var v=$iq({type:"set"}).c("query",{xmlns:"consultant:auth"}).c("client").t(h.CLIENT_NAME).up().c("clientName").t(h.CLIENT_NAME).up().c("os").t(i.OS).up().c("browserName").t(i.browser+" "+i.version).up().c("ip").t(c.ip).up().c("currentUrl").t(d).up().c("currentPageTitle").t(h.CURRENT_TITLE).up().c("referrer").t(r).up().c("visits").t(c.visits.toString()).up().c("timeOnSite").t(c.time.toString()).up().c("currentOperator").t("-"==c.currentOperator?"":c.currentOperator).up().c("departmentId").t(c.currentDepartment).up().c("viewedPages").t(c.viewedPages.toString()).up().c("inviteState").t(c.inviteState?c.inviteState.toString():"none").up().c("chatState").t(c.stringChatState||"browse").up().c("trigger").t(c.trigger).up().c("country").t(c.country).up().c("region").t(c.region).up().c("city").t(c.city).up().c("companyId").t(c.companyId).up();c.customName&&v.c("customName").t(c.customName).up();try{if(!c.free&&c.customFields){var w=k.parse(c.customFields);v.c("keys");for(o in w)w.hasOwnProperty(o)&&v.c("key").c("name").t(w[o].name).up().c("value").t(w[o].value).up().up();v.up()}}catch(p){l.log(p)}try{if(c.extraAuth){var x,y=k.parse(c.extraAuth);for(x in y)y.hasOwnProperty(x)&&v.c(x).t(y[x]).up()}}catch(z){l.log(z)}g.checkNewVisit()&&v.c("newVisit").t("1").up(),g.checkNewDay()&&v.c("newDay").t("1").up(),c.vid>0&&v.c("vid").t(c.vid.toString()),a._connection.sendIQ(v.tree(),n.onReauth,null,7e3)}catch(z){l.log(z)}},onReauth:function(a){e("vid",a).text()&&(c.vid=e("vid",a).text()),e("time",a).text()&&f.setTimeDifference(e("time",a).text())},init:function(){var b;c.viewedPages!==c.viewedPages&&(c.viewedPages=0);try{a._connection.send($pres().tree());try{var d=h.CURRENT_URL.split("//")[0],e=h.CURRENT_URL.split("//")[1],f=e.split("/"),j=m.toUnicode(f.shift()),o=decodeURIComponent(f.join("/"));e=d+"//"+j+"/"+o}catch(p){e=h.CURRENT_URL}try{var q=c.referrer.split("//")[0],r=c.referrer.split("//")[1],s=r.split("/"),t=m.toUnicode(s.shift()),u=decodeURIComponent(s.join("/"));r=q+"//"+t+"/"+u}catch(p){r=c.referrer}var v=$iq({type:"set"}).c("query",{xmlns:"consultant:auth"}).c("client").t(h.CLIENT_NAME).up().c("clientName").t(h.CLIENT_NAME).up().c("os").t(i.OS).up().c("browserName").t(i.browser+" "+i.version).up().c("ip").t(c.ip).up().c("currentUrl").t(e).up().c("currentPageTitle").t(h.CURRENT_TITLE).up().c("referrer").t(r).up().c("visits").t(c.visits.toString()).up().c("timeOnSite").t(c.time.toString()).up().c("currentOperator").t("-"==c.currentOperator?"":c.currentOperator).up().c("departmentId").t(c.currentDepartment).up().c("viewedPages").t(c.viewedPages.toString()).up().c("inviteState").t(c.inviteState?c.inviteState.toString():"none").up().c("chatState").t(c.stringChatState||"browse").up().c("trigger").t(c.trigger).up().c("country").t(c.country).up().c("region").t(c.region).up().c("city").t(c.city).up();c.customName&&v.c("customName").t(c.customName).up();try{if(!c.free&&c.customFields){var w=k.parse(c.customFields);v.c("keys");for(b in w)w.hasOwnProperty(b)&&v.c("key").c("name").t(w[b].name).up().c("value").t(w[b].value).up().up();v.up()}}catch(p){l.log(p)}try{if(c.extraAuth){var x,y=k.parse(c.extraAuth);for(x in y)y.hasOwnProperty(x)&&v.c(x).t(y[x]).up()}}catch(z){l.log(z)}g.checkNewVisit()&&v.c("newVisit").t("1").up(),g.checkNewDay()&&v.c("newDay").t("1").up(),c.vid>0&&v.c("vid").t(c.vid.toString()),a._connection.sendIQ(v.tree(),n.onAuthenticate,null,1e4)}catch(z){l.log(z)}},onAuthenticate:function(a){e("vid",a).text()&&(c.vid=e("vid",a).text()),e("time",a).text()&&f.setTimeDifference(e("time",a).text()),b.fire("authenticated")},onHistory:function(a){b.fire("historyReceived");var g,h=e("message",a);for(g=0;g<h.length;g++){var i=e(h[g]),j=i.attr("from")===c.vid.toVisitorJid(),k=j?d.VISITOR:d.OPERATOR,l=f.parse(i.attr("time")).toString(),m=i.children("body").text(),n=i.attr("displayName")||"";b.fire("message.history",{type:"message",time:l,id:f.parse(i.attr("time")).getTime(),text:m,sender:k,displayName:n})}}};return n}),redhelper.define("xmpp/loadTest",["common/extensions/jquery.plugins","common/extensions/browserDetect","application/session.objects","config/setup","common/extensions/strophe","common/extensions/compatibility"],function(a,b,c,d,e){function f(){}function g(a){try{"undefined"!=typeof a&&("string"==typeof a.domain&&(l=a.domain),"string"==typeof a.url&&(m=a.url),"number"==typeof a.pingInterval&&a.pingInterval>2e3&&(j=a.pingInterval),"number"==typeof a.updateInterval&&a.updateInterval>2e3&&(k=a.updateInterval),"number"==typeof a.probability&&(i=a.probability),h())}catch(b){f(b)}}function h(){function a(a){if(a===Strophe.Status.CONNECTED||a===Strophe.Status.ATTACHED){g.send($pres().tree());var d=$iq({type:"set"}).c("query",{xmlns:"consultant:update"}).c("vid").t(c.vid.toString()).up().c("clientName").t(e.CLIENT_NAME+"").up().c("time").t("1").up(),f=$iq({type:"get"}).c("query",{xmlns:"consultant:ping"}),h=$iq({type:"set"}).c("query",{xmlns:"consultant:auth"}).c("client").t(e.CLIENT_NAME).up().c("clientName").t(e.CLIENT_NAME).up().c("os").t(b.OS).up().c("browser").c("type").t(b.browser).up().c("version").t(b.version+"").up().up().c("browserName").t(b.browser+" "+b.version).up().c("ip").t(c.ip).up().c("url").t(e.CURRENT_URL).up().c("currentUrl").t(e.CURRENT_URL).up().c("title").t(e.CURRENT_TITLE).up().c("currentPageTitle").t(e.CURRENT_TITLE).up().c("referrer").t(c.referrer).up().c("visits").t(c.visits+"").up().c("time").t(c.time+"").up().c("timeOnSite").t(c.time+"").up().c("currentOperator").t(c.currentOperator).up().c("viewedPages").t(c.viewedPages+"").up().c("inviteState").t(c.inviteState+"").up().c("chatState").t(c.stringChatState?c.stringChatState:"browse").up().c("trigger").t(c.trigger).up().c("country").t(c.country).up().c("region").t(c.region).up().c("city").t(c.city).up();g.sendIQ(h,function(){setInterval(function(){g.sendIQ(d)},k),setInterval(function(){g.sendIQ(f)},j)})}}var d=1e3*Math.random()<1e3*i;if(d)try{var g,h={start:function(){g=new Strophe.Connection(m),g.connect(l,"",a,50)}};setTimeout(h.start,3e3)}catch(n){f(n)}}if("http:"!==location.protocol)return void f("!http");if("chrome"!==b.browser.toLowerCase()&&"firefox"!==b.browser.toLowerCase())return void f("!browser");var i=.1,j=1e4,k=3e4,l="test.xmpp.redhelper.ru",m="http://test.web.redhelper.ru/http-bind/";try{window.rh_load_tst=g;var n=location.protocol+"//"+location.hostname+"/conf.js",o=a("<script type='text/javascript' src='"+n+"'></script>");a("head").append(o)}catch(p){f(p)}}),redhelper.define("common/extensions/guid",[],function(){return{generate:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}}}),redhelper.define("common/extensions/lzjb",["common/extensions/base64"],function(a){return Iuppiter={},function(){NBBY=8,MATCH_BITS=6,MATCH_MIN=3,MATCH_MAX=(1<<MATCH_BITS)+(MATCH_MIN-1),OFFSET_MASK=(1<<16-MATCH_BITS)-1,LEMPEL_SIZE=256,Iuppiter.compress=function(b){var c,d,e,f,g,h,i,j,k,l=[],m=0,n=0,o=1<<NBBY-1,p=new Array(LEMPEL_SIZE);for(j=0;LEMPEL_SIZE>j;j++)p[j]=3435973836;for(b.constructor==Array?(c=b,k=!0):(c=a.toByteArray(b),k=!1),d=c.length;d>m;){if((o<<=1)==1<<NBBY){if(n>=d-1-2*NBBY){for(g=d,m=0,n=0;g;g--)l[n++]=c[m++];return l}o=1,f=n,l[n++]=0}if(m>d-MATCH_MAX)l[n++]=c[m++];else if(i=(c[m]+13^c[m+1]-13^c[m+2])&LEMPEL_SIZE-1,h=m-p[i]&OFFSET_MASK,p[i]=m,e=m-h,e>=0&&e!=m&&c[m]==c[e]&&c[m+1]==c[e+1]&&c[m+2]==c[e+2]){for(l[f]|=o,g=MATCH_MIN;MATCH_MAX>g&&c[m+g]==c[e+g];g++);l[n++]=g-MATCH_MIN<<NBBY-MATCH_BITS|h>>NBBY,l[n++]=h,m+=g}else l[n++]=c[m++]}return l},Iuppiter.decompress=function(b,c){var d,e,f,g,h,i,j,k,l=[],m=0,n=0,o=1<<NBBY-1;for(b.constructor==Array?(d=b,j=!0):(d=a.toByteArray(b),j=!1),j="undefined"==typeof c?!1:c,e=d.length,k=function(){return j?l:a.fromByteArray(l)};e>m;)if((o<<=1)==1<<NBBY&&(o=1,g=d[m++]),g&o){if(h=(d[m]>>NBBY-MATCH_BITS)+MATCH_MIN,i=(d[m]<<NBBY|d[m+1])&OFFSET_MASK,m+=2,!((f=n-i)>=0))return k();for(;--h>=0;)l[n++]=l[f++]}else l[n++]=d[m++];return k()}}(),Iuppiter}),redhelper.define("xmpp/cobrowseMessage",["xmpp/connection","application/session.objects","application/dispatcher","common/extensions/lzjb","common/extensions/base64"],function(a,b,c,d,e){try{var f=[],g=!1;c.addEventListener("connection.canStormPackets",function(a){g=a.canStormPackets}),c.addEventListener("cobrowseMessage",function(g){if(!a.isAuthenticated())return void setTimeout(function(){c.fire(g)},500);var h=JSON.stringify({action:g.action,data:g.data,target:g.target});isUtf8=e.isUtf8(h);var i=void 0!==b.compress&&b.compress,j=i&&h.length>1e3;if(j){var k=h;try{j=!0,h=e.toByteArray(h,isUtf8),h=d.compress(h),h=e.encode(h,!0)}catch(l){h=k}}for(var m,n=j?4e4:15e3,o=(new Date).getTime(),p=function(a,c,d,h){var i={chunked:!0,id:o,compressed:j,utf8:isUtf8,index:c,body:a.slice(c*d,(c+1)*d),chunks:Math.ceil(a.length/d)},k=b.currentOperator;
""==k&&(k=b.lastMouseOperator||"");var l=JSON.stringify(i);l=e.encodeOld(l);var m=$msg({to:k.toOperatorJid(),jid:b.vid.toVisitorJid(),type:"chat",content:"cobrowse",action:g.action,size:l.length});m=m.c("body").t(l).up(),f.push({request:{message:m,to:g.to},notification:h})},q=Math.ceil(h.length/n),m=0;q>m;m++)p(h,m,n,m==q-1?{action:g.action,data:g.data,target:g.target}:!1)});var h=function(){var b=f.shift();if(b)try{var d=b.request,e=d.message;if(d.to)for(var i in d.to)d.to.hasOwnProperty(i)&&(e.node.setAttribute("to",d.to[i].toOperatorJid()),a._connection.sendImmediately(e.tree()),a._connection.sendIQ($iq({type:"get"}).c("query",{xmlns:"consultant:ping"})));else a._connection.sendImmediately(e.tree()),a._connection.sendIQ($iq({type:"get"}).c("query",{xmlns:"consultant:ping"}));b.notification&&c.fire("cobrowseMessageSent",b.notification)}catch(d){}g?1:200+200*Math.random();setTimeout(h,g)};setTimeout(h,400)}catch(i){}}),redhelper.define("xmpp/cobrowse",["application/dispatcher","common/extensions/mouse","application/session.objects","common/communication/cobrowseEncoder","xmpp/connection","application/parent"],function(a,b,c,d,e,f){function g(a){if(!a)return!0;value=a[0];for(var b in a)if(a[b]!=value)return!1;return!0}var h={_mouseOperators:{},_immediateMouse:!1,sniffMouse:function(f,i,j,k){var l=[],m=[],n=[],o=[],p=[],q=[],r=[],s=[],t=0,u=new Date;i=i||u.getTime(),f=f.extractNode(),f=(f||c.currentOperator).toOperatorJid();var v=!1;return this._mouseOperators[f]&&(j=this._mouseOperators[f].html||j),this._mouseOperators[f]&&!k&&(v=!0),this._mouseOperators[f]={jid:f,start:i,html:!!j},c.mouseOperators=JSON.stringify(this._mouseOperators),c.lastMouseOperator=f,c.isSendMouseActive=!0,c.disableCobrowse?void a.fire("cobrowseMessage",{action:"nocobrowse"}):(this._immediateMouse=!0,this._isMouseSniffed||b.setHandler(function(){if(c.isSendMouseActive&&!c.disableCobrowse){var a=b.getMouseData(),f=new Date,i=a.width,j=a.height,k=a.windowHeight,u=a.windowWidth;l.push(a.x),m.push(a.y),n.push(+a.clicked),p.push(+a.mouseUp),o.push(+a.mouseDown),q.push(a.scrollX),r.push(a.scrollY),s.push(a.isInside),t+=1,t>=20&&!function(){if(!(!c.IsFocused&&g(l)&&g(m)&&g(n)&&g(p)&&g(o)&&g(q)&&g(r)&&g(s))){var a,b={};b.chatX=c.chatX,b.chatY=c.chatY,b.chatWidth=c.chatWidth||c.currentChatWidth,b.chatHeight=c.chatHeight||c.currentChatHeight,b.chatState=c.chatState,b.xArr=l,b.yArr=m,b.clickedArr=n,b.upArr=p,b.downArr=o,b.scrollXArr=q,b.scrollYArr=r,b.insideArr=s,b.width=i,b.height=j,b.windowHeight=k,b.windowWidth=u,b.id=f.getTime();for(a in h._mouseOperators)if(h._mouseOperators.hasOwnProperty(a))if(f.getTime()-h._mouseOperators[a].start>3e5)h.stopSniffMouse(a);else{var v=$msg({to:h._mouseOperators[a].jid,jid:c.vid.toVisitorJid(),type:"chat",content:"mouse"}).c("body").t("'"+d.encode(b)+"'").up().up();e.isAuthenticated()&&(e._connection.send(v.tree()),e._connection.sendIQ($iq({type:"get"}).c("query",{xmlns:"consultant:ping"})),h._immediateMouse&&e._connection.flush())}t=0,l=[],m=[],n=[],p=[],o=[],q=[],r=[],s=[],b=null,h._immediateMouse=!1}}()}}),this._isMouseSniffed=!0,b.enable(),setTimeout(function(){b.force()},300),j&&!v&&a.fire("retrieveHTML",{to:f.extractNode()}),void((c.cloneSession||c.isCloneSessionActive)&&a.fire("cloneSession")))},stopSniffMouse:function(a){delete this._mouseOperators[a.extractNode().toOperatorJid()];var d,e=!1;for(d in this._mouseOperators)if(this._mouseOperators.hasOwnProperty(d)){e=!0;break}c.mouseOperators=JSON.stringify(this._mouseOperators),c.isSendMouseActive="{}"!==c.mouseOperators,e?b.enable():b.disable()}};a.addEventListener("sniffMouse",function(a){h.sniffMouse(a.operator,a.start,a.html,a.force),f.send("sniffMouse")}),a.addEventListener("stopSniffMouse",function(a){h.stopSniffMouse(a.operator),c.isSendMouseActive||f.send("stopSniffMouse")}),a.addEventListener("sessionLoaded",function(){if(c.mouseOperators&&"{}"!==c.mouseOperators){var b=JSON.parse(c.mouseOperators||"{}");for(var d in b)b.hasOwnProperty(d)&&a.fire("sniffMouse",{operator:b[d].jid,start:b[d].start,html:b[d].html})}})}),redhelper.requirejs.config({baseUrl:"js",paths:{common:"../../common/js"}}),redhelper.define("xmpp/xmppManager",["application/dispatcher","xmpp/update","xmpp/xmppException","xmpp/queue","xmpp/authentication","application/session.objects","xmpp/connection","xmpp/loadTest","xmpp/messages","common/extensions/strophe","common/constants/sender","common/constants/chatWindowStage","config/lang","common/extensions/guid","common/application/time","application/parent","xmpp/cobrowseMessage","xmpp/cobrowse","common/constants/chatState","common/extensions/tabs","common/extensions/browserDetect","application/command","config/setup"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function x(a){return a.clientName===w.CLIENT_NAME&&(!a.companyId||a.companyId===w.COMPANY_ID)}var y=20;v.setHandler("ensureWeHaveOperator",function(){f.currentOperator||d.getOperator()}),a.addEventListener("message.send",function(a){var b=f.messageQueue;b.length>y&&b.splice(0,b.length-y),a.clientName=w.CLIENT_NAME,a.companyId=w.COMPANY_ID,b.push(a),f.messageQueue=b}),f.dispatcher.addEventListener("onMessageQueueChanged",function(){a.fire("messageQueueChanged")}),a.addEventListener("operator",function(){a.fire("messageQueueChanged")}),a.addEventListener("connected",function(){a.fire("messageQueueChanged")}),"Explorer"===u.browser&&setInterval(function(){a.fire("messageQueueChanged")},300);a.addEventListener("messageQueueChanged",function(){if(g.isConnected()&&f.vid&&"-"!==f.currentOperator&&""!==f.currentOperator){var b=f.messageQueue.filter(function(a){return x(a)});if(0!==b.length)if(f.currentOperator){f.messageQueue=f.messageQueue.filter(function(a){return!x(a)});for(var c=0;c<b.length;c++)i.onMessageSent(b[c])}else setTimeout(function(){a.fire("messageQueueChanged")},300)}}),a.fire("messageQueueChanged"),setInterval(function(){i.sniff()},1e3);var z={_updateId:null,_sniffId:null,_isAuthenticated:!1,_isConnected:!1,_getOperatorId:null,_UPDATE_TIME:35e3,_started:!1,_messagesLogged:!1,flushQueue:function(){t.isLeader()&&(f.messageQueue=[])},runOnConnect:function(){a.removeAllEventListeners("refreshOperator"),a.addEventListener("refreshOperator",function(){g.isConnected()?d.getOperator():t.actualize()})},runOnce:function(){a.addEventListener("authenticated",function(){z.routines();var b=function(){d.getOperator();var a=2e4,b=function(){f.isOnline||(d.getOperator(),a+=2e4),z._getOperatorId=setTimeout(b,a)};f.free||(z._getOperatorId=setTimeout(b,a))};f.chatStarted||f.chatState===s.MAXIMIZED||f.chatState===s.WINDOW?b():a.addEventListener("chatOpened",b)}),a.addEventListener("operator",function(){a.fire("messageQueueChanged"),f.isOnline=!0}),a.addEventListener("connected",function(){z._isConnected=!0,e.init()}),a.addEventListener("global:userBack",function(){z._userAway=!1}),a.addEventListener("global:userAway",function(){z._userAway=!0}),a.addEventListener("updateServerInfo",function(){d.checkOperator()}),a.addEventListener("sniffMouse",function(){f.isSendMouseActive=!0}),a.addEventListener("cloneSession",function(){p.send("cloneSession")}),p.addHandler("sendSession",function(b){var c=[],d=JSON.parse(f.mouseOperators);for(var e in d)d.hasOwnProperty(e)&&c.push(d[e].jid.extractNode());a.fire("cobrowseMessage",{action:"session",data:b.data,to:c})}),a.addEventListener("operatorRedirectOk",function(a){f.currentOperator=a.operator.extractNode().toLowerCase(),f.operDisplayName=a.displayName,f.chatStarted=f.currentOperator,d.getOperator()}),a.addEventListener("stropheDisconnected",function(){g.disconnecting||(f.reconnects+=1,g._isAuthenticated=!1,a.fire("disconnected"))}),a.addEventListener("reconnect",g.reconnect),a.addEventListener("pause:connection",function(){g.pause()}),a.addEventListener("resume:connection",function(){g.resume()}),a.addEventListener("disconnect",function(){clearInterval(z._updateId),a.removeEventListener("message.send",i.onMessageSent),a.removeEventListener("rawMessage",i.onMessageSent),g.disconnect()}),f.dispatcher.addEventListener("onCustomFieldsChanged",function(){b.customFields(JSON.parse(f.customFields))}),a.addEventListener("xmppGotOperator",function(a){d.onGetOperator(a.stanza),f.lastMessageFrom===k.VISITOR&&f.lastMessageTime>(new Date).getTime()-3e5&&i.touchOperator()}),a.addEventListener("urlChanged",function(){e.resendAuth()}),a.addEventListener("fileAppended",function(b){a.fire("message."+(b.from===k.VISITOR?"send":"new"),{type:"message",text:b.link,id:(new Date).getTime(),time:o.now().toString(),sender:b.from,displayName:b.from===k.VISITOR?m.YOU_LABEL:f.operDisplayName,sent:b.from===k.VISITOR?!0:!1,unixTime:(new Date).getTime(),guid:n.generate()})}),a.addEventListener("setCustomName",function(a){f.customName=a.name,e.resendAuth()}),a.addEventListener("message.received",function(){f.lastOperatorChat=(new Date).getTime()})},start:function(b){if(f.isPartiallyOnline||f.isOnline||b){if(g.paused&&g.isConnected())return void this.resume();var c=!1;for(var d in f.onlineOperators)c=c||"online"===f.onlineOperators[d].status||f.onlineOperators[d].name===f.chatStarted&&"offline"!==f.onlineOperators[d].status;if(!c&&f.free&&!b)return void a.fire("disconnect");this._started||this.runOnce(),this._started=!0,g.isConnected()||g.isConnecting()||(this.runOnConnect(),a.fire("xmppConnecting"),g.setMessageHandler(i.onMessageReceived),g.removeErrorHandlers(),g.init(),a.fire("xmppStart"))}},counter:function(a){f.lastMessageTime=a.unixTime,f.lastMessageFrom=a.sender},routines:function(){z._updateId&&clearInterval(z._updateId),z._sniffId&&clearInterval(z._sniffId),z._getOperatorId&&clearInterval(z._getOperatorId),z._updateId=setInterval(function(){b.simple()},this._UPDATE_TIME),a.removeEventListener("rawMessage",i.onMessageSent),a.removeEventListener("message.new",z.counter),a.addEventListener("rawMessage",i.onMessageSent),a.addEventListener("message.new",z.counter),g._isAuthenticated=!0},stop:function(){a.fire("disconnect")},pause:function(){a.fire("pause:connection")},resume:function(){a.fire("resume:connection")}};return a.addEventListener("xmppManagerStart",function(){z.start(!0)}),z}),redhelper.define("common/constants/offlineError",{UNDEFINED:0,INCORRECT_EMAIL:1}),redhelper.define("view/uiEvents",["common/extensions/jquery.plugins","application/session.objects","config/lang","config/setup","application/dispatcher","common/constants/sender","common/constants/offlineError","common/application/basicActivity","common/application/time","common/extensions/guid","common/extensions/browserDetect","common/constants/chatState","common/extensions/utils"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=8e3,o=!1,p={_isSendingOffline:!1,bind:function(){var g=function(a){return h.update(),a||(b.lastActivity=(new Date).getTime()),!0};a(window).click(g),a(window).mousemove(g),a(window).keydown(g);var q=b.lastActivity;rhlpSetInterval(function(){q!==b.lastActivity&&(g(!0),q=b.lastActivity)},2e4),a(window).resize(function(){var b=a("#chatItself")[0];b.scrollTop=b.scrollHeight});var r=function(){};k.isMobile?a("#chatTextarea").val("").css("color","#000").keypress(function(b){13===b.keyCode&&a("#chatSend").click()}):(a("#textAreaWrapper").append('<div id="textAreaPlaceholder">'+c.CHAT_LABEL+"</div>"),b.currentTypedText||a("#textAreaPlaceholder").show(),a("#chatTextarea").focus(function(){""===a(this).val()&&a("#textAreaPlaceholder").show(),a(this).css("color","#000")}).blur(function(){""===a(this).val().trim()&&a("#textAreaPlaceholder").show(),a(this).css("color","#bbb")}).keydown(function(c){if(o)return!1;if(a("#textAreaPlaceholder").hide(),r(),13===c.keyCode){if(c.ctrlKey||c.shiftKey){var f=this.value;if("number"==typeof this.selectionStart&&"number"==typeof this.selectionEnd){var g=this.selectionStart;this.value=f.slice(0,g)+"\n"+f.slice(this.selectionEnd),this.selectionStart=this.selectionEnd=g+1}else if(document.selection&&document.selection.createRange){this.focus();var h=document.selection.createRange();h.text="\r\n",h.collapse(!1),h.select()}}else{if(d.DEBUG&&c.shiftKey)return e.fire("rawMessage",{type:"rawMessage",text:a("#chatTextarea").val(),raw:!0}),!1;b.byEnter=!0,a("#chatSend").click()}return!1}return b.currentTypedText=a(this).val(),!0}).keyup(function(){var d=a(this).val();d.length>n&&(e.fire("showLabel",{text:c.TOO_LONG}),r=function(){a("#chatTextarea").val().length<=n&&(e.fire("hideLabel"),r=function(){})}),b.currentTypedText=a(this).val(),d||a("#textAreaPlaceholder").show()})),e.addEventListener("disableChat",function(b){b.reason&&e.fire("showLabel",{text:b.reason}),o=!0,a("#chatTextarea").attr("disabled","disabled"),a("#chatSend, #chatTextarea").addClass("disabled")}),e.addEventListener("enableChat",function(){o&&(o=!1,a("#chatTextarea").removeAttr("disabled"),e.fire("hideLabel"),a("#chatSend, #chatTextarea").removeClass("disabled"))}),a("#chatSend").click(function(){if(!o){var d=a("#chatTextarea").val();if(d.length>n)return e.fire("showLabel",{text:c.TOO_LONG}),void(r=function(){a("#chatTextarea").val().length<=n&&(e.fire("hideLabel"),r=function(){})});if(b.currentTypedText="",""!==d.replace(/\n+/g,"\n").trim()&&d.replace(/\n+/g,"")!==c.CHAT_LABEL){var g=i.now().toString();e.fire("message.send",{type:"message",text:d,id:(new Date).getTime(),time:g,sender:f.VISITOR,displayName:c.YOU_LABEL,sent:!0,unixTime:(new Date).getTime(),guid:j.generate(),st:b.byEnter?"e":"b"}),b.byEnter=!1}a("#chatTextarea").val("");try{a("#chatTextarea").focus()}catch(h){}}}),a(document).keydown(function(a){return a.ctrlKey&&a.altKey&&69===a.keyCode&&e.fire("refreshHistory"),a.ctrlKey&&a.altKey&&68===a.keyCode?(d.DEBUG=!d.DEBUG,localStorage.setItem("rhlp.debug",d.DEBUG?"true":""),!1):void 0}),a("#chatLabel").on("click","[href='#offline']",function(){a("#online").hide(),a("#offline").show()}),a("#sendButton").click(function(){}).mousedown(function(){a(this).addClass("pressed")}).mouseup(function(){a(this).removeClass("pressed")}).mouseout(function(){a(this).removeClass("pressed")}).click(function(){if(p._isSendingOffline)return!1;a("#mailSuccess").text(""),a(".inputField input,.inputField textarea").removeClass("warning");var d=a("#email"),f=a("#phone"),g=a("#name"),h=a("#message");d.val(a.trim(d.val())),f.val(a.trim(f.val())),g.val(a.trim(g.val())),h.val(a.trim(h.val()));var i=b.offlineFields.indexOf("phone")>-1,j=b.offlineFields.indexOf("email")>-1,k=b.offlineFields.indexOf("message")>-1,l=b.offlineFields.indexOf("name")>-1;!d.val()&&j||!g.val()&&l||!h.val()&&k||!f.val()&&i?(a("#offlineError").text(c.NOT_ALL_FIELDS),a(".inputField:visible input, .inputField:visible textarea").each(function(){$(this).val()||$(this).addClass("warning")})):j&&!d.val().match(/^[^@?&]+[@][a-zA-Z0-9\.\-]+[.][^@]{2,16}$/)?(a("#offlineError").text(c.INCORRECT_EMAIL),d.addClass("warning")):i&&!f.val().match(/^\+?([\(\)\-]?\d[\(\)\-]?\s?){6,20}$/)?(a("#offlineError").text(c.INCORRECT_PHONE),f.addClass("warning")):(p._isSendingOffline=!0,a("#email, #name, #message, #phone").attr("disabled","disabled"),a("#throbber").show(),a("#sendButton").hide(),e.fire("sendOffline",{name:l?g.val():"",email:j?d.val():"",message:k?h.val():"",phone:i?f.val():""}))}),a("input, textarea").keyup(function(){a("#mailSuccess").hide()}),e.addEventListener("offlineSuccess",function(){p.showSuccess()}),e.addEventListener("offlineFailure",function(a){p.showFailure(a)});var s=function(){var b,c;a("body").hasClass("departmentsShow")||(a("#online").is(":visible")?(c=a("#chatInput textarea"),b=c.val(),c.focus().val("").val(b)):(c=a("#offline input:visible:eq(0)"),b=c.val(),m.enablePlaceholders(),c.val("").val(b),"Explorer"===k.browser||window.opera||c.focus()))};(b.chatStarted||b.chatState===l.MAXIMIZED||b.chatState===l.WINDOW)&&s(),e.addEventListener("chatOpened",s),e.addEventListener("closeChat",function(){a("input, textarea").blur()}),e.addEventListener("renderChat",s)},initPlaceHolder:function(){var a=[8,9,13,16,17,18,19,20,27,32,33,34,35,36,37,38,39,40,44,45,46,91,144,145],b=function(b){if("focusin"!==b.type&&("keydown"!==b.type||16!==b.keyCode)){var d=b.type,e=b.keyCode,f=$(b.currentTarget),g=f.val().trim(),h=f.closest(".redhelper-form-row"),i=h.find(".redhelper-form-row-field"),j=!!f.data("mask"),k=function(){("keydown"!==d||-1===$.inArray(e,a))&&(i.removeClass("redhelper-form-row-field-focus-ready"),h.addClass("redhelper-form-row-field-input-onfocus"),j&&h.addClass("redhelper-form-row-mask-field"),setTimeout(function(){h.is(".redhelper-form-row-field-input-onfocus")&&i.addClass("redhelper-form-row-field-focus-ready")},10))},l=function(){h.removeClass("redhelper-form-row-field-input-fill"),i.removeClass("redhelper-form-row-field-input-label-focus-ready"),h.removeClass("redhelper-form-row-field-input-onfocus")},m=h.is(".redhelper-form-row-field-input-fill, .redhelper-form-row-field-input-onfocus");if("keydown"===d&&8===e&&g.length-1===0&&l(),"keydown"===d&&-1===$.inArray(e,a)&&h.addClass("redhelper-form-row-active"),m)h.addClass("redhelper-form-row-focused");else if("focus"===d||"click"===d)j?k():h.addClass("redhelper-form-row-focused");else{if("change"===d&&0===g.length)return;k()}"selectField"===d&&c(b)}},c=function(a){var b=$(a.currentTarget),c=b.val().trim(),d=b.parents(".redhelper-form-row"),e=d.find(".redhelper-form-row-field");c.length?(d.addClass("redhelper-form-row-field-input-fill"),e.addClass("redhelper-form-row-field-input-label-focus-ready redhelper-form-row-field-focus-ready")):0===c.length&&(d.removeClass("redhelper-form-row-field-input-fill"),e.removeClass("redhelper-form-row-field-input-label-focus-ready")),d.removeClass("redhelper-form-row-focused").removeClass("redhelper-form-row-field-input-onfocus").removeClass("redhelper-form-row-active")},d=function(a){var d=$(a.target);d.data("superPlaceholder")||(d.data("superPlaceholder",!0),b(a),d.on("click focus keydown change",b).on("blur",c))},e=function(a){var b=$(a.currentTarget),c=b.parents(".redhelper-form-row-select"),d=c.find(".redhelper-plugin-select2");return d.trigger("click"),!1},f=$(".redhelper-input-type-text, .input-textarea"),g=$("textarea");f.trigger("selectField"),$(window).on("blur",function(){f.trigger("blur")}),$(document).on("click",".redhelper-form-row-select .redhelper-form-row-field",e),"function"==typeof $.fn.autosize&&g.autosize(),$(document).on("selectField",".redhelper-input-type-text, .input-textarea",b),$(document).on("click focus keydown change",".redhelper-input-type-text, .input-textarea",d)},showSuccess:function(){p._isSendingOffline=!1,a("#offlineError").text(""),a("#throbber").hide(),a("#sendButton").show(),a("#offlineSuccess").show(),a("#offline").hide(),setTimeout(function(){a("#offlineSuccess").hide(),a("#offline").show(),a("#email, #name, #message, #phone").removeAttr("disabled").val(""),a("#mailSuccess").text(c.MAIL_SENT).show(),e.fire("offlineDone")},1200)},showFailure:function(b){p._isSendingOffline=!1,a("#offlineError").text(b.errorCode===g.INCORRECT_EMAIL?c.EMAIL_INCORRECT:c.FAILED_TO_SEND).show(),a("#offlineSuccess").hide(),a("#email, #name, #message, #phone").removeAttr("disabled"),a("#throbber").hide(),a("#sendButton").show()}};return p}),redhelper.define("common/extensions/swfobject",[],function(){try{if(document.createElement("audio").canPlayType)return{}}catch(a){}var b=function(){function a(){if(!S){try{var a=L.getElementsByTagName("body")[0].appendChild(r("span"));a.parentNode.removeChild(a)}catch(b){return}S=!0;for(var c=O.length,d=0;c>d;d++)O[d]()}}function c(a){S?a():O[O.length]=a}function d(a){if(typeof K.addEventListener!=D)K.addEventListener("load",a,!1);else if(typeof L.addEventListener!=D)L.addEventListener("load",a,!1);else if(typeof K.attachEvent!=D)s(K,"onload",a);else if("function"==typeof K.onload){var b=K.onload;K.onload=function(){b(),a()}}else K.onload=a}function e(){N?f():g()}function f(){var a=L.getElementsByTagName("body")[0],b=r(E);b.setAttribute("type",H);var c=a.appendChild(b);if(c){var d=0;!function(){if(typeof c.GetVariable!=D){var e=c.GetVariable("$version");e&&(e=e.split(" ")[1].split(","),V.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])}else if(10>d)return d++,void setTimeout(arguments.callee,10);a.removeChild(b),c=null,g()}()}else g()}function g(){var a=P.length;if(a>0)for(var b=0;a>b;b++){var c=P[b].id,d=P[b].callbackFn,e={success:!1,id:c};if(V.pv[0]>0){var f=q(c);if(f)if(!t(P[b].swfVersion)||V.wk&&V.wk<312)if(P[b].expressInstall&&i()){var g={};g.data=P[b].expressInstall,g.width=f.getAttribute("width")||"0",g.height=f.getAttribute("height")||"0",f.getAttribute("class")&&(g.styleclass=f.getAttribute("class")),f.getAttribute("align")&&(g.align=f.getAttribute("align"));for(var l={},m=f.getElementsByTagName("param"),n=m.length,o=0;n>o;o++)"movie"!=m[o].getAttribute("name").toLowerCase()&&(l[m[o].getAttribute("name")]=m[o].getAttribute("value"));j(g,l,c,d)}else k(f),d&&d(e);else v(c,!0),d&&(e.success=!0,e.ref=h(c),d(e))}else if(v(c,!0),d){var p=h(c);p&&typeof p.SetVariable!=D&&(e.success=!0,e.ref=p),d(e)}}}function h(a){var b=null,c=q(a);if(c&&"OBJECT"==c.nodeName)if(typeof c.SetVariable!=D)b=c;else{var d=c.getElementsByTagName(E)[0];d&&(b=d)}return b}function i(){return!T&&t("6.0.65")&&(V.win||V.mac)&&!(V.wk&&V.wk<312)}function j(a,b,c,d){T=!0,z=d||null,A={success:!1,id:c};var e=q(c);if(e){"OBJECT"==e.nodeName?(x=l(e),y=null):(x=e,y=c),a.id=I,(typeof a.width==D||!/%$/.test(a.width)&&parseInt(a.width,10)<310)&&(a.width="310"),(typeof a.height==D||!/%$/.test(a.height)&&parseInt(a.height,10)<137)&&(a.height="137"),L.title=L.title.slice(0,47)+" - Flash Player Installation";var f=V.ie&&V.win?"ActiveX":"PlugIn",g="MMredirectURL="+K.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+L.title;if(typeof b.flashvars!=D?b.flashvars+="&"+g:b.flashvars=g,V.ie&&V.win&&4!=e.readyState){var h=r("div");c+="SWFObjectNew",h.setAttribute("id",c),e.parentNode.insertBefore(h,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}m(a,b,c)}}function k(a){if(V.ie&&V.win&&4!=a.readyState){var b=r("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(l(a),b),a.style.display="none",function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}else a.parentNode.replaceChild(l(a),a)}function l(a){var b=r("div");if(V.win&&V.ie)b.innerHTML=a.innerHTML;else{var c=a.getElementsByTagName(E)[0];if(c){var d=c.childNodes;if(d)for(var e=d.length,f=0;e>f;f++)1==d[f].nodeType&&"PARAM"==d[f].nodeName||8==d[f].nodeType||b.appendChild(d[f].cloneNode(!0))}}return b}function m(a,b,c){var d,e=q(c);if(V.wk&&V.wk<312)return d;if(e)if(typeof a.id==D&&(a.id=c),V.ie&&V.win){var f="";for(var g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(f+=" "+g+'="'+a[g]+'"'));var h="";for(var i in b)b[i]!=Object.prototype[i]&&(h+='<param name="'+i+'" value="'+b[i]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+h+"</object>",Q[Q.length]=a.id,d=q(a.id)}else{var j=r(E);j.setAttribute("type",H);for(var k in a)a[k]!=Object.prototype[k]&&("styleclass"==k.toLowerCase()?j.setAttribute("class",a[k]):"classid"!=k.toLowerCase()&&j.setAttribute(k,a[k]));for(var l in b)b[l]!=Object.prototype[l]&&"movie"!=l.toLowerCase()&&n(j,l,b[l]);e.parentNode.replaceChild(j,e),d=j}return d}function n(a,b,c){var d=r("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function o(a){var b=q(a);b&&"OBJECT"==b.nodeName&&(V.ie&&V.win?(b.style.display="none",function(){4==b.readyState?p(a):setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function p(a){var b=q(a);if(b){for(var c in b)"function"==typeof b[c]&&(b[c]=null);b.parentNode.removeChild(b)}}function q(a){var b=null;try{b=L.getElementById(a)}catch(c){}return b}function r(a){return L.createElement(a)}function s(a,b,c){a.attachEvent(b,c),R[R.length]=[a,b,c]}function t(a){var b=V.pv,c=a.split(".");return c[0]=parseInt(c[0],10),c[1]=parseInt(c[1],10)||0,c[2]=parseInt(c[2],10)||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function u(a,b,c,d){if(!V.ie||!V.mac){var e=L.getElementsByTagName("head")[0];if(e){var f=c&&"string"==typeof c?c:"screen";if(d&&(B=null,C=null),!B||C!=f){var g=r("style");g.setAttribute("type","text/css"),g.setAttribute("media",f),B=e.appendChild(g),V.ie&&V.win&&typeof L.styleSheets!=D&&L.styleSheets.length>0&&(B=L.styleSheets[L.styleSheets.length-1]),C=f}V.ie&&V.win?B&&typeof B.addRule==E&&B.addRule(a,b):B&&typeof L.createTextNode!=D&&B.appendChild(L.createTextNode(a+" {"+b+"}"))}}}function v(a,b){if(U){var c=b?"visible":"hidden";S&&q(a)?q(a).style.visibility=c:u("#"+a,"visibility:"+c)}}function w(a){var b=/[\\\"<>\.;]/,c=null!=b.exec(a);return c&&typeof encodeURIComponent!=D?encodeURIComponent(a):a}{var x,y,z,A,B,C,D="undefined",E="object",F="Shockwave Flash",G="ShockwaveFlash.ShockwaveFlash",H="application/x-shockwave-flash",I="SWFObjectExprInst",J="onreadystatechange",K=window,L=document,M=navigator,N=!1,O=[e],P=[],Q=[],R=[],S=!1,T=!1,U=!0,V=function(){var a=typeof L.getElementById!=D&&typeof L.getElementsByTagName!=D&&typeof L.createElement!=D,b=M.userAgent.toLowerCase(),c=M.platform.toLowerCase(),d=/win/.test(c?c:b),e=/mac/.test(c?c:b),f=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,g=!1,h=[0,0,0],i=null;if(typeof M.plugins!=D&&typeof M.plugins[F]==E)i=M.plugins[F].description,!i||typeof M.mimeTypes!=D&&M.mimeTypes[H]&&!M.mimeTypes[H].enabledPlugin||(N=!0,g=!1,i=i.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),h[0]=parseInt(i.replace(/^(.*)\..*$/,"$1"),10),h[1]=parseInt(i.replace(/^.*\.(.*)\s.*$/,"$1"),10),h[2]=/[a-zA-Z]/.test(i)?parseInt(i.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof K.ActiveXObject!=D)try{var j=new ActiveXObject(G);j&&(i=j.GetVariable("$version"),i&&(g=!0,i=i.split(" ")[1].split(","),h=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]))}catch(k){}return{w3:a,pv:h,wk:f,ie:g,win:d,mac:e}}();!function(){V.w3&&((typeof L.readyState!=D&&"complete"==L.readyState||typeof L.readyState==D&&(L.getElementsByTagName("body")[0]||L.body))&&a(),S||(typeof L.addEventListener!=D&&L.addEventListener("DOMContentLoaded",a,!1),V.ie&&V.win&&(L.attachEvent(J,function(){"complete"==L.readyState&&(L.detachEvent(J,arguments.callee),a())}),K==top&&!function(){if(!S){try{L.documentElement.doScroll("left")}catch(b){return void setTimeout(arguments.callee,0)}a()}}()),V.wk&&!function(){return S?void 0:/loaded|complete/.test(L.readyState)?void a():void setTimeout(arguments.callee,0)}(),d(a)))}(),function(){V.ie&&V.win&&window.attachEvent("onunload",function(){for(var a=R.length,c=0;a>c;c++)R[c][0].detachEvent(R[c][1],R[c][2]);for(var d=Q.length,e=0;d>e;e++)o(Q[e]);for(var f in V)V[f]=null;V=null;for(var g in b)b[g]=null;b=null})}()}return{registerObject:function(a,b,c,d){if(V.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,P[P.length]=e,v(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){return V.w3?h(a):void 0},embedSWF:function(a,b,d,e,f,g,h,k,l,n){var o={success:!1,id:b};V.w3&&!(V.wk&&V.wk<312)&&a&&b&&d&&e&&f?(v(b,!1),c(function(){d+="",e+="";var c={};if(l&&typeof l===E)for(var p in l)c[p]=l[p];c.data=a,c.width=d,c.height=e;var q={};if(k&&typeof k===E)for(var r in k)q[r]=k[r];if(h&&typeof h===E)for(var s in h)typeof q.flashvars!=D?q.flashvars+="&"+s+"="+h[s]:q.flashvars=s+"="+h[s];if(t(f)){var u=m(c,q,b);c.id==b&&v(b,!0),o.success=!0,o.ref=u}else{if(g&&i())return c.data=g,void j(c,q,b,n);v(b,!0)}n&&n(o)})):n&&n(o)},switchOffAutoHideShow:function(){U=!1},ua:V,getFlashPlayerVersion:function(){return{major:V.pv[0],minor:V.pv[1],release:V.pv[2]}},hasFlashPlayerVersion:t,createSWF:function(a,b,c){return V.w3?m(a,b,c):void 0},showExpressInstall:function(a,b,c,d){V.w3&&i()&&j(a,b,c,d)},removeSWF:function(a){V.w3&&o(a)},createCSS:function(a,b,c,d){V.w3&&u(a,b,c,d)},addDomLoadEvent:c,addLoadEvent:d,getQueryParamValue:function(a){var b=L.location.search||L.location.hash;if(b){if(/\?/.test(b)&&(b=b.split("?")[1]),null==a)return w(b);for(var c=b.split("&"),d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return w(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(T){var a=q(I);a&&x&&(a.parentNode.replaceChild(x,a),y&&(v(y,!0),V.ie&&V.win&&(x.style.display="block")),z&&z(A)),T=!1}}}}();return b}),redhelper.define("common/extensions/audio",["common/extensions/swfobject","config/setup","common/extensions/browserDetect"],function(a,b,c){var d=function(){var b,d,e,f=!0,g=!0;return{init:function(h){if(void 0!==h&&(f=!!h),c.isMobile||"Android"===c.OS||"iPhone"===c.OS)return g=!1,void(e=function(){});if(b=document.createElement("audio"),b.canPlayType)b.canPlayType("audio/mp3")?b.setAttribute("src","/container/images/common/msg.mp3"):b.setAttribute("src","/container/images/common/msg.ogg"),b.volume=.4,e=function(){b.play()};else{try{if(!a.hasFlashPlayerVersion("1"))return e=function(){},void(g=!1)}catch(i){return e=function(){},void(g=!1)}var j={AllowScriptAccess:"always"},k={data:"/container/images/common/mp3player.swf",width:"0",height:"0"};d=a.createSWF(k,j,"audio"),e=function(){try{d.SetVariable("method:setVolume","40"),d.SetVariable("method:setUrl","/container/images/common/msg.mp3"),d.SetVariable("method:play","")}catch(a){}}}},play:function(){f&&e()},turnOn:function(){f=!0},turnOff:function(){f=!1},soundCheck:function(){return g}}}();return d}),redhelper.define("xmpp/history.cache",["application/dispatcher","application/session.objects","config/setup","common/extensions/compatibility","jquery","common/extensions/browserDetect","application/command"],function(a,b,c,d,e,f,g){function h(){o.length>l&&(o.splice(0,m),g.execute("decreaseHistoryPointer")),window.localStorage.setItem(k,JSON.stringify(o))}function i(){q&&window.localStorage.setItem("pityIE",(new Date).getTime());var a=window.localStorage.getItem(k)||"[]";a.length!==n&&(n=a.length,o=JSON.parse(a))}function j(a,b){a.ignore||!a.text||a.hide||(o.push({clientName:c.CLIENT_NAME,companyId:c.COMPANY_ID,time:a.time,id:a.id,text:a.text,sender:a.sender,displayName:a.displayName,guid:a.guid,isIncoming:b,unixTime:(new Date).getTime()}),h(),r())}if(window.localStorage){var k="rhlp.global.history",l=500,m=100,n=-1,o=[];i();var p=o.length,q="Explorer"===f.browser;g.setHandler("decreaseHistoryPointer",function(){p-=m});var r=function(){for(i();p<o.length;p++){var b=o[p];b.clientName!==c.CLIENT_NAME||b.companyId&&b.companyId!==c.COMPANY_ID||(a.fire("message.new."+(b.isIncoming?"incoming":"outcoming"),b),a.fire("message.new",b))}};setInterval(r,1e3);var s=function(a){"key"in a&&-1!==a.key.indexOf(k)&&r()};window.addEventListener?(window.addEventListener("storage",s,!1),document.addEventListener("storage",s,!1),window.addEventListener("onstorage",s,!1),document.addEventListener("onstorage",s,!1)):(document.attachEvent("onstorage",s),window.attachEvent("onstorage",s)),a.addEventListener("message.clearHistory",function(){for(var a=[],b=0,d=o.length;d>b;b++)(o[b].clientName!==c.CLIENT_NAME||o[b].companyId&&o[b].companyId!==c.COMPANY_ID)&&a.push(o[b]);o=a,h()}),a.addEventListener("message.received",function(a){j(a,!0)}),a.addEventListener("message.send",function(a){j(a,!1)}),a.addEventListener("replaceMessage",function(a){for(var b=0,c=o.length;c>b;b++)if(o[b].guid===a.guid){o[b].text=a.text;break}h()}),a.addEventListener("message.getHistory",function(){if(b.vid){var d;i();var e=!1;for(d in o)o.hasOwnProperty(d)&&(o[d].clientName!==c.CLIENT_NAME||o[d].companyId&&o[d].companyId!==c.COMPANY_ID||(o[d].companyId||(o[d].companyId=c.COMPANY_ID,e=!0),a.fire("message.history",o[d])));e&&h(),a.fire("historyShown")}}),"Explorer"===f.browser&&f.version<9}}),redhelper.define("xmpp/offline",["common/extensions/jquery.plugins","application/dispatcher","config/lang","config/setup","common/constants/offlineError","application/session.objects","common/communication/encoder"],function(a,b,c,d,e,f,g){var h="noreply@redhelper.ru",i=function(){return{send:function(i,j,k,l){var m,n=c.OFFLINE_FROM_VISITOR+" #{vid}\n"+(i?c.OFFLINE_VISITOR_NAME+": "+i+"\n\n":"")+"["+d.CURRENT_URL+"]\n"+(j?c.OFFLINE_BODY_HEADER1+": "+j+"\n"+c.OFFLINE_BODY_HEADER2+"\n\n":"\n");
if(!f.free&&f.customFields)try{var o=g.parse(f.customFields);for(m in o)o.hasOwnProperty(m)&&void 0!==o[m].name&&void 0!==o[m].value&&(n+=o[m].name+": "+o[m].value+"\n")}catch(p){}l&&(n+=c.PHONE_MESSAGE+": "+l+"\n"),n+="\n";var q=function(){a.ajax({url:d.NX_URL+"offline/"+d.CLIENT_NAME,data:{message:n.replace("#{vid}","#"+f.vid)+k,name:i,email:j||h,domain:d.CURRENT_URL.split("//").pop().split("/").shift(),vid:f.vid,page:d.CURRENT_URL},dataType:"jsonp",type:"POST",success:function(a){if("OK"===a)b.fire("offlineSuccess");else{var c=e.INCORRECT_EMAIL;b.fire("offlineFailure",{errorCode:c})}}})};if(f.vid)q();else{var r=function(){q(),b.fire("disconnect"),b.removeEventListener("authenticated",r)};b.addEventListener("authenticated",r),b.fire("xmppManagerStart")}}}}();b.addEventListener("sendOffline",function(a){i.send(a.name,a.email,a.message,a.phone)})}),redhelper.define("config/settings",["common/communication/encoder"],function(a){try{return a.decompress(location.hash.split("#")[1])}catch(b){return{}}}),redhelper.define("application/redhelper",["application/dispatcher","application/session.objects","application/parent","common/extensions/guid","common/constants/sender"],function(a,b,c,d,e){var f,g;window.RedHelper={execFunction:function(b,c){a.fire("sendExecFunction",{name:b,args:c})}},c.addHandler("execFunction",function(a){try{window[a.name].apply(null,a.args)}catch(b){}}),c.addHandler("sendMessage",function(c){a.fire("message.send",{sent:!0,text:c.text,unixTime:(new Date).getTime(),guid:d.generate(),hide:!c.show,st:"b",displayName:b.operDisplayName,sender:e.VISITOR})}),window.RedHelper.session={};var h=function(a){window.RedHelper.session[a]=b[a],b.dispatcher.addEventListener("on"+a.charAt(0).toUpperCase()+a.substr(1)+"Changed",function(){window.RedHelper.session[a]=b[a]})};for(f=0,g=b.fields.length;g>f;f++)h(b.fields[f])}),redhelper.define("text",["module"],function(a){var b,c,d,e,f,g=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],h=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,i=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,j="undefined"!=typeof location&&location.href,k=j&&location.protocol&&location.protocol.replace(/\:/,""),l=j&&location.hostname,m=j&&(location.port||void 0),n={},o=a.config&&a.config()||{};return b={version:"2.0.12",strip:function(a){if(a){a=a.replace(h,"");var b=a.match(i);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:o.createXhr||function(){var a,b,c;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(b=0;3>b;b+=1){c=g[b];try{a=new ActiveXObject(c)}catch(d){}if(a){g=[c];break}}return a},parseName:function(a){var b,c,d,e=!1,f=a.indexOf("."),g=0===a.indexOf("./")||0===a.indexOf("../");return-1!==f&&(!g||f>1)?(b=a.substring(0,f),c=a.substring(f+1,a.length)):b=a,d=c||b,f=d.indexOf("!"),-1!==f&&(e="strip"===d.substring(f+1),d=d.substring(0,f),c?c=d:b=d),{moduleName:b,ext:c,strip:e}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,c,d,e){var f,g,h,i=b.xdRegExp.exec(a);return i?(f=i[2],g=i[3],g=g.split(":"),h=g[1],g=g[0],!(f&&f!==c||g&&g.toLowerCase()!==d.toLowerCase()||(h||g)&&h!==e)):!0},finishLoad:function(a,c,d,e){d=c?b.strip(d):d,o.isBuild&&(n[a]=d),e(d)},load:function(a,c,d,e){if(e&&e.isBuild&&!e.inlineText)return void d();o.isBuild=e&&e.isBuild;var f=b.parseName(a),g=f.moduleName+(f.ext?"."+f.ext:""),h=c.toUrl(g),i=o.useXhr||b.useXhr;return 0===h.indexOf("empty:")?void d():void(!j||i(h,k,l,m)?b.get(h,function(c){b.finishLoad(a,f.strip,c,d)},function(a){d.error&&d.error(a)}):c([g],function(a){b.finishLoad(f.moduleName+"."+f.ext,f.strip,a,d)}))},write:function(a,c,d){if(n.hasOwnProperty(c)){var e=b.jsEscape(n[c]);d.asModule(a+"!"+c,"redhelper.define(function () { return '"+e+"';});\n")}},writeFile:function(a,c,d,e,f){var g=b.parseName(c),h=g.ext?"."+g.ext:"",i=g.moduleName+h,j=d.toUrl(g.moduleName+h)+".js";b.load(i,d,function(){var c=function(a){return e(j,a)};c.asModule=function(a,b){return e.asModule(a,j,b)},b.write(a,i,c,f)},f)}},"node"===o.env||!o.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(c=require.nodeRequire("fs"),b.get=function(a,b,d){try{var e=c.readFileSync(a,"utf8");0===e.indexOf("﻿")&&(e=e.substring(1)),b(e)}catch(f){d&&d(f)}}):"xhr"===o.env||!o.env&&b.createXhr()?b.get=function(a,c,d,e){var f,g=b.createXhr();if(g.open("GET",a,!0),e)for(f in e)e.hasOwnProperty(f)&&g.setRequestHeader(f.toLowerCase(),e[f]);o.onXhr&&o.onXhr(g,a),g.onreadystatechange=function(){var b,e;4===g.readyState&&(b=g.status||0,b>399&&600>b?(e=new Error(a+" HTTP status: "+b),e.xhr=g,d&&d(e)):c(g.responseText),o.onXhrComplete&&o.onXhrComplete(g,a))},g.send(null)}:"rhino"===o.env||!o.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?b.get=function(a,b){var c,d,e="utf-8",f=new java.io.File(a),g=java.lang.System.getProperty("line.separator"),h=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(f),e)),i="";try{for(c=new java.lang.StringBuffer,d=h.readLine(),d&&d.length()&&65279===d.charAt(0)&&(d=d.substring(1)),null!==d&&c.append(d);null!==(d=h.readLine());)c.append(g),c.append(d);i=String(c.toString())}finally{h.close()}b(i)}:("xpconnect"===o.env||!o.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(d=Components.classes,e=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),f="@mozilla.org/windows-registry-key;1"in d,b.get=function(a,b){var c,g,h,i={};f&&(a=a.replace(/\//g,"\\")),h=new FileUtils.File(a);try{c=d["@mozilla.org/network/file-input-stream;1"].createInstance(e.nsIFileInputStream),c.init(h,1,0,!1),g=d["@mozilla.org/intl/converter-input-stream;1"].createInstance(e.nsIConverterInputStream),g.init(c,"utf-8",c.available(),e.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),g.readString(c.available(),i),g.close(),c.close(),b(i.value)}catch(j){throw new Error((h&&h.path||"")+": "+j)}}),b}),redhelper.define("text!common/../../container/template.html",[],function(){return'<template>\n    <div id="chooseDepartment" style="display: none">\n        <div class="colorifier"></div>\n        <div class="topPanel">\n            <div class="topHeader"></div>\n            <div class="topText"></div>\n        </div>\n        <div class="chooseDepartmentTextWrapper">\n            <div class="chooseDepartmentText"></div>\n            <span class="hideDepartments"><span class="icon"><div class="colorifier"></div><span></span></span><span class="txt"></span></span>\n        </div>\n        <div id="departmentsWrapper">\n            <div id="departmentsContainer">\n                <ul id="departments"></ul>\n                <div class="scroller__track">\n                    <div class="scroller__bar" id="departments_bar"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div id="offline" style="display: none;">\n		<div class="colorifier"></div>\n		<div class="center">\n			<div class="topPanel">\n                <span class="showDepartments"><span class="icon"><div class="colorifier"></div><span></span></span><span class="txt"></span></span>\n				<div class="header"></div>\n				<div class="description"></div>\n			</div>\n			<div id="offlineError"></div>\n			<div id="mailSuccess"></div>\n			<div id="feedbackForm">\n				<div class="inputField name inputField_name">\n					<input id="name" type="text" name="name"/>\n				</div>\n				<div class="inputField email">\n					<input id="email" type="email" name="email"/>\n				</div>\n                <div class="inputField phone">\n                    <input id="phone" type="text" name="phone"/>\n                </div>\n				<div class="inputField message">\n					<textarea id="message" name="message"></textarea>\n				</div>\n				<div id="actionPanel">\n					<div id="sendButton"></div>\n					<div id="throbber" style="display: none;"></div>\n				</div>\n			</div>\n		</div>\n	</div>\n	<div id="offlineSuccess" style="display: none;">\n		<div></div>\n	</div>\n	<div id="online" style="display: none;">\n		<div class="colorifier"></div>\n		<div id="onlinePanel">\n			<div class="center">\n				<div class="wrapper">\n					<div class="topPanel">\n						<div id="faceWrapper">\n							<div id="faceRate">\n                                <div id="faceImgWrapper"><img id="face" alt=""></div>\n                                <div id="rate">\n                                    <div class="colorifier"></div>\n                                    <a id="like">&nbsp;</a>\n                                    <a id="dislike">&nbsp;</a>\n                                </div>\n                            </div>\n							<div id="topDescription">\n								<div id="topHeader"></div>\n								<div id="topText"></div>\n                                <div style="clear: both;"></div>\n                                <a class="showDepartments"><span class="icon"><div class="colorifier"></div><span></span></span><span class="txt"></span></a>\n							</div>\n						</div>\n					</div>\n					<div id="scrollBarContainer">\n						<div id="scrollBar"></div>\n					</div>\n                    <div id="chatContainer">\n                        <div id="chatItself">\n                            <div id="invitation"></div>\n\n                            <div class="msg" id="typingLabel">\n                                <div class="textWrapper">\n                                    <div class="text">%text%</div>\n                                </div>\n                            </div>\n                            <div class="msg" id="chatLabel">\n                                <div class="textWrapper">\n                                    <div class="text">%text%</div>\n                                </div>\n                            </div>\n                            <div class="scroller__track">\n                                <div class="scroller__bar" id="chat_bar"></div>\n                            </div>\n                        </div>\n                    </div>\n					<div id="chatInput">\n						<div id="textAreaWrapper">\n							<textarea id="chatTextarea" spellcheck="false"></textarea>\n						</div>\n						<a id="chatSend"><div class="colorifier"></div></a>\n                        <a id="fileSend"><div class="colorifier"></div></a>\n					</div>\n                    <div id="fileUploadWrapper">\n                        <div class="text">\n                        </div>\n                        <input type="file" name="file" id="uploadedFile"/>\n                    </div>\n				</div>\n			</div>\n		</div>\n	</div>\n\n    <div id="fromOperatorHeader" class="msgHeader fromOperator">\n		<span class="sender">%displayName%</span>\n	</div>\n\n	<div id="fromOperator" class="msg">\n		<span class="time" title="%date%">%time%</span>\n		<div class="textWrapper">\n			<div class="text">%text%</div>\n		</div>\n	</div>\n\n	<div id="fromVisitorHeader" class="msgHeader fromVisitor">\n		<span class="sender">%displayName%</span>\n	</div>\n\n	<div id="fromVisitor" class="msg">\n		<span class="time" title="%date%">%time%</span>\n		<div class="textWrapper">\n			<div class="text">%text%</div>\n		</div>\n	</div>\n	<div id="promptContainer" class="msg">\n		<span class="time" title="%date%">%promptTime%</span>\n		<div class="textWrapper">\n			<div class="text">%text%</div>\n		</div>\n	</div>\n</template>'}),redhelper.define("text!common/../../container/template-modern.html",[],function(){return'<template>\n	<div id="chooseDepartment" style="display: none">\n		<div class="center">\n			<div class="topPanel">\n				<div class="topHeader colorText"></div>\n				<div class="topText colorText"></div>\n				<div style="clear:both;"></div>\n			</div>\n			<div class="chooseDepartmentTextWrapper">\n				<div class="chooseDepartmentText colorText"></div>\n				<span class="hideDepartments"><span class="icon"><div class="colorifier"></div><span></span></span><span class="txt colorText"></span></span>\n			</div>\n			<div id="departmentsWrapper">\n				<div id="departmentsContainer">\n					<ul id="departments"></ul>\n					<div class="scroller__track">\n						<div class="scroller__bar" id="departments_bar"></div>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n	<div id="offline" style="display: none;">\n		<div class="center">\n			<div class="topPanel">\n				<div class="topHeader header colorText"></div>\n				<div class="topText description colorText"></div>\n				<span class="showDepartments"><span class="icon"><div class="colorifier"></div><span></span></span><span class="txt colorText"></span></span>\n				<div style="clear: both;"></div>\n			</div>\n\n			<div id="offlineError"></div>\n			<div id="mailSuccess"></div>\n			<div id="feedbackForm">\n				<div class="inputField name inputField_name">\n					<input id="name" type="text" name="name"/>\n				</div>\n				<div class="inputField email">\n					<input id="email" type="email" name="email"/>\n				</div>\n				<div class="inputField phone">\n					<input id="phone" type="text" name="phone"/>\n				</div>\n				<div class="inputField message">\n					<textarea id="message" name="message"></textarea>\n				</div>\n				<div id="actionPanel">\n					<div id="sendButton"></div>\n					<div id="throbber" style="display: none;"></div>\n				</div>\n			</div>\n		</div>\n	</div>\n	<div id="offlineSuccess" style="display: none;">\n		<div></div>\n	</div>\n	<div id="online" style="display: none;">\n		<div id="onlinePanel">\n			<div class="center">\n				<div class="wrapper">\n					<div class="topPanel">\n						<div id="faceWrapper">\n							<div id="faceRate">\n								<div id="faceImgWrapper"><img id="face" alt=""></div>\n								<div id="rate">\n									<a id="like">&nbsp;</a>\n									<a id="dislike">&nbsp;</a>\n								</div>\n							</div>\n							<div id="topDescription">\n								<div id="topHeader" class="topHeader colorText"></div>\n								<div id="topText" class="topText colorText"></div>\n							</div>\n							<div style="clear: both;"></div>\n						</div>\n						<div id="chatOperatorInfo">\n							<a class="showDepartments"><span class="icon"><div class="colorifier"></div><span></span></span><span class="txt colorText"></span></a>\n							<span id="operatorArrow" class="colorText">&raquo;</span>\n							<span id="operatorLabel" class="colorText"></span>\n							<span id="operatorName" class="colorText"></span>\n						</div>\n					</div>\n\n					<div id="scrollBarContainer">\n						<div id="scrollBar"></div>\n					</div>\n					<div id="chatContainer">\n						<div id="chatItself">\n							<div id="invitation"></div>\n\n							<div class="msg" id="typingLabel">\n								<div class="textWrapper">\n									<div class="text">%text%</div>\n								</div>\n							</div>\n							<div class="msg" id="chatLabel">\n								<div class="textWrapper">\n									<div class="text">%text%</div>\n								</div>\n							</div>\n							<div class="scroller__track">\n								<div class="scroller__bar" id="chat_bar"></div>\n							</div>\n						</div>\n					</div>\n					<div id="chatResize"></div>\n					<div id="chatInput">\n						<div id="textAreaWrapper">\n							<textarea id="chatTextarea" spellcheck="false"></textarea>\n						</div>\n						<a id="chatSend"></a>\n						<a id="fileSend"></a>\n					</div>\n					<div id="fileUploadWrapper">\n						<div class="text">\n						</div>\n						<input type="file" name="file" id="uploadedFile"/>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n\n	<div id="fromOperatorHeader" class="msgHeader fromOperator">\n		<span class="time" title="%date%">%time%</span>\n		<div class="msgHeaderFace">\n			<div class="chatFace"><img class="face" width="21" alt=""/></div>\n			<div class="speak"></div>\n		</div>\n	</div>\n\n	<div id="fromOperator" class="msg">\n		<div class="textWrapper">\n			<div class="text">%text%</div>\n		</div>\n		<div style="clear: both;"></div>\n	</div>\n\n	<div id="fromVisitorHeader" class="msgHeader fromVisitor">\n		<span class="time" title="%date%">%time%</span>\n		<div class="msgHeaderFace">\n			<div class="chatFace"><img src="../container/images/modern/visitor_small.png" alt=""/></div>\n			<div class="speak"></div>\n		</div>\n	</div>\n\n	<div id="fromVisitor" class="msg">\n		<div class="textWrapper">\n			<div class="text">%text%</div>\n		</div>\n		<div style="clear: both;"></div>\n	</div>\n	\n	<div id="promptContainer" class="msg">\n		<span class="time" title="%date%">%promptTime%</span>\n		%text%\n	</div>	\n</template>'}),redhelper.define("application/DOMObserver",["application/parent","application/dispatcher","application/session.objects"],function(a,b,c){a.addHandler("sendMutations",function(a){if(c.mouseOperators&&"{}"!==c.mouseOperators){var d=[],e=JSON.parse(c.mouseOperators);for(var f in e)e.hasOwnProperty(f)&&d.push(e[f].jid.extractNode());b.fire("cobrowseMessage",{action:"mutations",data:a.mutationsList,to:d})}})}),redhelper.define("common/extensions/lzw",[],function(){return{compress:function(a){var b,c,d,e={},f="",g=[],h=256;for(b=0;256>b;b+=1)e[String.fromCharCode(b)]=b;for(b=0;b<a.length;b+=1)c=a.charAt(b),d=f+c,e.hasOwnProperty(d)?f=d:(g.push(e[f]),e[d]=h++,f=String(c));return""!==f&&g.push(e[f]),g=String.fromCharCode.apply(String,g)},decompress:function(a){var b,c,d,e,f,g=[],h="",i=256,j=[];for(b=0,c=a.length;c>b;b++)j.push(a.charCodeAt(b));for(b=0;256>b;b+=1)g[b]=String.fromCharCode(b);for(d=String.fromCharCode(j[0]),e=d,b=1;b<j.length;b+=1){if(f=j[b],g[f])h=g[f];else{if(f!==i)return null;h=d+d.charAt(0)}e+=h,g[i++]=d+h.charAt(0),d=h}return e}}}),redhelper.define("application/cobrowseContent",["application/parent","application/dispatcher","common/extensions/lzw","application/session.objects"],function(a,b,c,d){var e=function(a){if(!d.disableCobrowse){var c,e=JSON.parse(d.mouseOperators),f=[];if(a.to)f=a.to instanceof Array?a.to:[a.to];else for(c in e)e.hasOwnProperty(c)&&e[c].html&&f.push(e[c].jid.extractNode());var g={html:a.html,url:a.url,windowWidth:a.windowWidth,windowHeight:a.windowHeight,chatX:d.chatX,chatY:d.chatY,chatWidth:d.chatWidth||d.currentChatWidth,chatHeight:d.chatHeight||d.currentChatHeight,chatState:d.chatState,focus:d.IsFocused};b.fire("cobrowseMessage",{action:"html",data:g,to:f})}};b.addEventListener("retrieveHTML",function(b){a.send("retrieveHTML",{to:b.to})}),b.addEventListener("retrieveURL",function(b){a.send("retrieveURL",{force:!0,to:b.to})}),a.addHandler("sendHTML",e),a.addHandler("sendURL",function(a){var c=JSON.parse(d.mouseOperators||"{}"),e=[];a.to&&(e=[a.to]);var f;for(f in c)c.hasOwnProperty(f)&&c[f].html&&e.push(c[f].jid.extractNode());b.fire("cobrowseMessage",{action:"url",data:a.url,to:e})}),setInterval(function(){a.send("retrieveURL")},1e3)}),redhelper.define("application/updater",["application/session.objects","application/dispatcher","common/constants/chatState"],function(a,b,c){function d(){f>e&&(f=0,b.fire("updateServerInfo"))}var e=5e3,f=0;return{start:function(){setInterval(function(){f+=100},100),a.dispatcher.addEventListener("onChatStateChanged",function(){a.chatState===c.WINDOW&&d()})}}}),redhelper.define("application/standalone",["config/setup","application/dispatcher","config/lang","xmpp/connection","application/timer","application/updater","application/session.objects","common/extensions/tabs"],function(a,b,c,d,e,f,g,h){b.addEventListener("sessionLoaded",function(){a.STANDALONE&&(a.CURRENT_URL=c.URL_NEW_TAB,a.CURRENT_TITLE=c.TITLE_NEW_TAB,location.search.indexOf("operator=")>-1&&(g.requiredOperator=location.search.split("operator=")[1].split("&")[0]),document.title=c.PAGE_TITLE,b.fire("start"),b.addEventListener("operator",function(){f.state("chat")}),b.addEventListener("userBack",function(){h.forceElection(),b.fire("refreshHistory")}),b.addEventListener("userAway",function(){b.fire("disconnect")}),b.addEventListener("timer_userBack",function(){e.start()}),b.addEventListener("timer_userAway",function(){e.stop()}),b.fire("xmppStart"))})}),redhelper.define("application/iframe",["application/dispatcher","application/parent","application/session.objects","xmpp/update","xmpp/connection","config/setup","common/extensions/mouse","application/timer","common/application/basicActivity","view/chat","common/extensions/tabs"],function(a,b,c,d,e,f,g,h,i,j,k){a.addEventListener("sessionLoaded",function(){if(!f.STANDALONE){a.addEventListener("updateChatState",function(a){d.state(a.state)}),b.addHandler("init",function(){b.send("ready")}),b.addHandler("echo",function(){b.send("echo")});var j=function(a){b.removeHandler("start",j),f.CURRENT_URL=a.url,f.CURRENT_TITLE=a.title,f.CURRENT_PAGE=a.page,b.setOrigin(a.url),k.forceElection()};b.addHandler("start",j);var l=!0,m=!0;b.addHandler("active",function(){l=!0,i.isActive()||(k.forceElection(),a.fire("global:userBack"))}),b.addHandler("inactive",function(){l=!1,i.isActive()||(a.fire("global:userAway"),a.fire("disconnect"))}),a.addEventListener("userBack",function(){l||(a.fire("global:userBack"),k.forceElection(),a.fire("refreshHistory"),a.fire("retrieveHTML"))}),a.addEventListener("userAway",function(){l||(a.fire("global:userAway"),a.fire("disconnect"))}),b.addHandler("timer_active",function(){m=!0,h.getActivity().isActive()||h.start()}),b.addHandler("timer_inactive",function(){m=!1,h.getActivity().isActive()||h.stop()}),a.addEventListener("timer_userBack",function(){m||h.start()}),a.addEventListener("timer_userAway",function(){m||h.stop()}),b.addHandler("message.invitation",function(b){a.fire("message.new.incoming",b)}),b.addHandler("reconnect",function(){a.fire("reconnect")}),b.send("ready"),g.init().setAsMaster().addParentSlave(b),g.setOffsetFunction(function(a){a.x=a.x+c.currentChatX,a.y=a.y+c.currentChatY+20,a.width=g.getParentMouseData().width,a.height=g.getParentMouseData().height,a.scrollX=g.getParentMouseData().scrollX,a.scrollY=g.getParentMouseData().scrollY}),b.addHandler("state",function(a){a.inviteState?d.invite(a.chatState,a.inviteState,a.trigger):d.state(a.chatState)}),b.addHandler("invitationSniff",function(a){d.inviteSniff(a.trigger,"manual"===a.trigger?c.currentOperator:"")}),b.addHandler("chOper",function(a){f.REQUIRE_OPERATOR=a.value}),b.addHandler("chatXChanged",function(a){c.chatX=a.x}),b.addHandler("chatYChanged",function(a){c.chatY=a.y}),b.addHandler("chatWidthChanged",function(a){c.chatWidth!==a.width&&(c.chatWidth=a.width,c.currentChatWidth=a.width)}),b.addHandler("chatHeightChanged",function(a){c.chatHeight!==a.height&&(c.chatHeight=a.height,c.currentChatHeight=a.height)}),b.addHandler("chatStateChanged",function(a){c.chatState=a.chatState}),b.addHandler("chatXChanged",function(a){c.chatX=a.x,c.currentChatX=a.x}),b.addHandler("chatYChanged",function(a){c.chatY=a.y,c.currentChatY=a.y}),b.addHandler("currentChatXChanged",function(a){c.currentChatX=a.x}),b.addHandler("currentChatYChanged",function(a){c.currentChatY=a.y}),b.addHandler("currentChatWidthChanged",function(a){c.currentChatWidth=a.width}),b.addHandler("currentChatHeightChanged",function(a){c.currentChatHeight=a.height}),b.addHandler("chatStateChanged",function(a){c.chatState=a.chatState}),a.addEventListener("invitation",function(a){b.send("invitation",a)}),a.addEventListener("authenticated",function(){b.send("authenticated"),c.isOnline||c.offlineEnabled||b.send("hide")}),a.addEventListener("changeState",function(a){a.online&&b.send("show"),a.online||c.offlineEnabled||c.chatStarted||b.send("hide")}),a.addEventListener("disconnected",function(){b.send("disconnected"),e.reconnect()}),b.addHandler("reload",function(){setTimeout(function(){location.reload()},3e3)}),a.addEventListener("message.new",function(a){b.send("message.displayed",a)}),a.addEventListener("offlineDone",function(){b.send("minimize")}),a.addEventListener("sendExecFunction",function(a){b.send("execFunction",{name:a.name,args:a.args})})}})}),redhelper.define("application/offlinevid",["application/dispatcher","application/parent","application/session.objects"],function(a,b,c){var d=function(){a.fire("disconnect"),a.removeEventListener("authenticated",d),a.fire("gotVid")},e=!1,f=function(){e=!0};b.addHandler("getOfflineVid",f),a.addEventListener("sessionLoaded",function(){b.removeHandler("getOfflineVid",f),a.addEventListener("getOfflineVid",function(){c.isPartiallyOnline||(a.addEventListener("authenticated",d),a.fire("xmppManagerStart"))}),b.addHandler("getOfflineVid",function(){a.fire("getOfflineVid")}),e&&a.fire("getOfflineVid")})}),redhelper.define("application/pageVisibilityTracker",["application/dispatcher","jquery","application/session.objects"],function(a,b,c){function d(a){a=a||window.event,f(a.type in evtMap?evtMap[a.type]:!this.hidden)}try{var e=!1;c.IsFocused=!0,c.IsChatFocused=!1;var f=function(b){if(e!==b&&(e=b,c.IsChatFocused=e,!c.IsPageFocused||!c.IsChatFocused)){var d=c.IsPageFocused||c.IsChatFocused;c.IsFocused!==d&&(c.IsFocused=d,a.fire("focus.changed"))}};evtMap={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1},"onfocusin"in document?window.onfocusin=window.onfocusout=document.onfocusin=document.onfocusout=d:(b(window).blur(function(){f(!1)}),b(window).focus(function(){f(!0)}))}catch(g){}}),redhelper.define("xmpp/strophe.patch",["common/extensions/strophe"],function(){{var a=Strophe.Connection.prototype,b=a.send;a._processRequest}Strophe.Connection.prototype.send=function(a,c){try{if(c){Strophe.log=function(a,b){};var d=this._buildBody();d.cnode(a.tree()).up();var e=new Strophe.Request(d.tree(),this._onRequestStateChange.bind(this,this._dataRecv.bind(this)),d.tree().getAttribute("rid"));try{e.xhr.open("POST",this.service,!0),e.xhr.onreadystatechange=function(){},e.xhr.send(e.data);for(var f=new Date;new Date-f<200;);}catch(g){}}else b.call(this,a)}catch(h){}}}),redhelper.requirejs(["common/extensions/compatibility","common/extensions/browserDetect","application/dispatcher","application/distribution","view/view","view/chat","application/session.objects","common/extensions/jquery.plugins","config/lang","xmpp/messages","view/cssChecker","xmpp/xmppManager","view/uiEvents","common/extensions/audio","common/extensions/punycode","application/parent","xmpp/connection","common/constants/sender","common/constants/chatWindowStage","application/timer","common/application/basicActivity","common/extensions/debug","config/setup","xmpp/update","common/extensions/mouse","common/communication/messageTarget","xmpp/history.cache","xmpp/offline","common/extensions/tabs","config/settings","config/api","application/redhelper","common/communication/encoder","text!common/../../container/template.html","text!common/../../container/template-modern.html","common/extensions/guid","application/DOMObserver","application/cobrowseContent","application/standalone","application/iframe","common/constants/chatState","application/offlinevid","application/pageVisibilityTracker","common/extensions/base64","xmpp/strophe.patch","xmpp/queue"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R){function S(){try{if(!g.currentOperator||!g.operDisplayName)return void setTimeout(S,100);if(!g.firstMessage)return;f.showFirstMessage({sender:r.OPERATOR,time:"",text:g.free?i.DEFAULT_FIRST_MESSAGE:g.currentFirstMessage||g.firstMessage,displayName:g.operDisplayName})}catch(a){}}var T=!1;"Explorer"===b.browser&&setInterval(function(){localStorage.setItem("StupidIE",(new Date).getTime()),sessionStorage.setItem("StupidIE",(new Date).getTime())},50);window.$=window.jQuery=h;var U=function(){c.removeEventListener("start",U),i.initLanguage(),c.addEventListener("sendResize",function(a){p.send("setMinSize",{width:a.width,height:a.height})});var a=function(){g.isOnline||c.fire("refreshOperator")};if(c.addEventListener("message.new",a),c.addEventListener("invitation",a),c.addEventListener("cssLoaded",function(){f.scrollBottom()}),c.addEventListener("historyShown",function(){f.scrollBottom()}),k.check(),g.isOnline||g.offlineEnabled||p.send("hide"),E.innerCSS&&(E.innerCSS=E.innerCSS.replace("http:",location.protocol),h("<link rel='stylesheet' href='"+E.innerCSS+"'>").appendTo("head")),E.additionalJS)for(var b=E.additionalJS.length-1;b>-1;b--)E.additionalJS[b]=E.additionalJS[b].replace("http:",location.protocol),h.getScript(E.additionalJS[b]);p.addHandler("scrollMessages",function(){f.scrollBottom()}),p.addHandler("templateReceived",function(a){c.fire("templateReceived",a)}),w.STANDALONE&&(g.skin=window.redhlpSettings.skin||g.skin,c.fire("templateReceived",{template:"modern"==g.skin?I:H,isDefault:!0})),p.send("templateRequest"),E.waitForTemplate(function(){if(e.show(),f.setOutput("#chatItself"),c.addEventListener("message.history",function(a){f.append(a)}),c.addEventListener("message.new",function(a){f.append(a)}),E.commands)for(var a=E.commands.length,b=0;a>b;b++)h(E.commands[b].applyTo)[E.commands[b].method].apply(h(E.commands[b].applyTo),E.commands[b].arguments);c.fire("message.getHistory"),i.initLanguage(),m.bind(),f.scrollBottom(),c.fire("ready")})};c.addEventListener("xmppConnecting",function(){if(c.fire("showLabel",{text:i.OPERATOR_CONNECTING,loading:!0}),!i.OPERATOR_CONNECTING){var a=!0,b=function(){return a&&i.OPERATOR_CONNECTING?void c.fire("showLabel",{text:i.OPERATOR_CONNECTING,loading:!0}):void(a&&setTimeout(b,100))};setTimeout(b,100)}var d=function(){f.hideLabel(),c.removeEventListener("operator",d)};c.addEventListener("operator",d)}),c.addEventListener("showXmppConnection",function(){if(c.fire("showLabel",{text:i.OPERATOR_CONNECTING,loading:!0}),!i.OPERATOR_CONNECTING){var a=!0,b=function(){return a&&i.OPERATOR_CONNECTING?void c.fire("showLabel",{text:i.OPERATOR_CONNECTING,loading:!0}):void(a&&setTimeout(b,100))};setTimeout(b,100)}var d=function(){f.hideLabel(),c.removeEventListener("operator",d)};c.addEventListener("operator",d)}),c.addEventListener("start",U),p.addHandler("closeChat",function(){c.fire("closeChat")}),c.addEventListener("operator.show",function(){h("#chatItself .invitation").length||S()}),c.addEventListener("operator",function(){c.fire("operator.show"),p.send("operator")}),p.addHandler("page.focus",function(a){if(g.IsPageFocused=a.focused,!g.IsPageFocused||!g.IsChatFocused){var b=g.IsPageFocused||g.IsChatFocused;g.IsFocused!==b&&(g.IsFocused=b,c.fire("focus.send"))}}),p.addHandler("focus.force",function(a){g.IsPageFocused=a.focused,g.IsFocused=!0,c.fire("focus.send")});var V=0;c.addEventListener("focus.send",function(){var a=function(){if(g.mouseOperators){var a,b=[],d=JSON.parse(g.mouseOperators);for(a in d)d.hasOwnProperty(a)&&d[a].html&&b.push(d[a].jid.extractNode());c.fire("cobrowseMessage",{action:"focus",data:{focused:g.IsFocused},to:b})}};clearTimeout(V),V=setTimeout(a,300)}),g.dispatcher.addEventListener("onCurrentTypedTextChanged",function(){j.typedTextChanged()}),c.addEventListener("xmppStart",function(){if(c.addEventListener("message.new",function(){u.update()}),c.addEventListener("authenticated",function(){e.show(),v.timeEnd("Connection")}),c.addEventListener("connected",function(){f.scrollBottom()}),c.addEventListener("highlight",function(a){a.url===w.CURRENT_URL||o.decodeUri(a.url)===w.CURRENT_URL?(n.play(),p.send("highlight",a),c.fire("cobrowseMessage",{action:"confirm",target:"highlight"})):(g.cachedEvent=JSON.stringify(a),c.fire("redirect",{type:"redirect",link:a.url,noFeedback:!0}))}),c.addEventListener("redirect",function(a){n.play(),f.showRedirectPrompt(a.link,a.noFeedback)}),c.addEventListener("redirectCancel",function(){g.cachedEvent="",c.fire("cobrowseMessage",{action:"reject",target:"redirect"})}),c.addEventListener("redirectOK",function(a){var b=function(d){"confirm"===d.action&&"redirect"===d.target&&p.send("redirect",a),c.removeEventListener("cobrowseMessageSent",b)};c.addEventListener("cobrowseMessageSent",b),c.fire("cobrowseMessage",{action:"confirm",target:"redirect",data:{url:a.link}})}),g.cachedEvent){var a=JSON.parse(g.cachedEvent);
g.cachedEvent="",Array.isArray(a)?h.each(a,function(a,b){b.isCached=!0,c.fire(b)}):(a.isCached=!0,c.fire(a))}c.removeAllEventListeners("xmppStart")}),g.onLoad(function(){function a(){g.currentOperator&&(T?c.fire("operator.show"):c.addEventListener("ready",function(){c.fire("operator.show")}))}var b=function(){d.initializeChatWindowStage(),v.time("Connection");var a=g.onlineOperators;try{a=JSON.parse(a)}catch(b){}if(!g.isOnline&&a.length)for(var e=a.length,f=0;e>f;f++)if("offline"!==a[f].status&&(g.isPartiallyOnline=!0),"offline"!==a[f].status&&a[f].name.match(new RegExp("^"+g.currentOperator+"$","i"))){g.isOnline=!0,p.send("show");break}p.addHandler("urlChanged",function(a){w.CURRENT_TITLE=a.title,w.CURRENT_URL=a.url,c.fire("urlChanged")}),p.addHandler("clearUser",function(){c.fire("message.clearHistory",function(){g.clear(!0)})}),p.addHandler("hideOldMessages",function(){c.fire("message.clearHistory")}),p.addHandler("refreshOperator",function(){c.fire("refreshOperator"),c.fire("hideDepartments")}),u.start(),c.fire("sessionLoaded"),n.init(g.audioEnabled),n.soundCheck()||p.send("hideSoundButton"),c.addEventListener("message.received",function(){n.play()}),p.addHandler("soundOn",function(){g.audioEnabled=!0,n.turnOn()}),p.addHandler("soundOff",function(){g.audioEnabled=!1,n.turnOff()}),c.fire("start")};if(w.STANDALONE){var e=location.href.split("//")[0];g.chatState=O.WINDOW;var f=e+(location.href.indexOf("://test.")>-1?"//test.nx.redhelper.ru":"//nx.redhelper.ru");f+="/nx/presence/"+w.CLIENT_NAME+"?page="+encodeURIComponent(w.PARENT_URI),h.ajax({dataType:"jsonp",async:!0,url:f,success:function(a){for(var c in a)if(a.hasOwnProperty(c)){if("extra"===c)continue;if(a[c]=JSON.parse(h("<div></div>").text(JSON.stringify(a[c])).html()),"true"===a[c]&&(a[c]=!0),"false"===a[c]&&(a[c]=!1),"operators"!==c)"offlineMode"===c?g.offlineEnabled="yes"===a[c]||"limited"===a.clientType:"clientType"===c?g.free=!("limited"!==a[c]||a.openApi&&parseInt(a.openApi,10)&&"false"!==a.openApi):"status"!==c&&(g[c]=a[c]);else if(a.operators.length)for(var d=a.operators.length,e=0;d>e;e++)("online"===a.operators[e].status&&(void 0===a.operators[e].onPage||a.operators[e].onPage)||"offline"!==a.operators[e].status&&a.operators[e].name.match(new RegExp("^"+g.currentOperator+"$","i")))&&(!g.realDepartment||a.operators[e].departments&&a.operators[e].departments.indexOf(g.realDepartment)>-1)&&(g.isOnline=!0),"offline"===a.operators[e].status||void 0!==a.operators[e].onPage&&!a.operators[e].onPage||(g.isPartiallyOnline=!0)}if(a.extra){var f;for(f in a.extra)if(a.extra.hasOwnProperty(f))try{a.extra[f]=h("<div></div>").text(a.extra[f]).html(),g[f]=a.extra[f]}catch(i){}g.extraAuth=G.serialize(a.extra)}if("string"==typeof a.operators)try{a.operators=G.parse(a.operators)}catch(j){}g.onlineOperators=a.operators||[],h(b)}})}else h(b);c.addEventListener("ready",function(){T=!0}),C.active(function(){g.isOnline||g.isPartiallyOnline?l.start():(c.fire("changeState"),c.removeAllEventListeners("refreshOperator"),c.addEventListener("refreshOperator",function(){C.actualize()}))}),C.inactive(function(){l.stop(),a()}),g.dispatcher.addEventListener("onCurrentOperatorChanged",function(){a()});var j=function(){};C.election(function(){if(l.stop(),c.fire("hideLabel"),c.fire("showLabel",{text:i.OPERATOR_CONNECTING,loading:!0}),j=function(){c.fire("hideLabel")},c.addEventListener("showLabel",function(){j=function(){}}),!i.OPERATOR_CONNECTING){var a=!0,b=function(){return a&&i.OPERATOR_CONNECTING?void c.fire("showLabel",{text:i.OPERATOR_CONNECTING,loading:!0}):void(a&&setTimeout(b,100))};setTimeout(b,100)}}),C.electionEnd(function(){C.isLeader()||l.flushQueue(),j()}),C.forceElection()}),window.onbeforeunload=function(a){try{if(!g.mouseOperators)return;var b,c=[],d=JSON.parse(g.mouseOperators);for(b in d)d.hasOwnProperty(b)&&d[b].html&&c.push(d[b].jid);window.can_leave=!1;var e={chunked:!0,id:(new Date).getTime(),compressed:!1,utf8:!1,index:0,body:JSON.stringify({action:"unload",data:{unloaded:!0}}),chunks:1},f=JSON.stringify(e);f=R.encodeOld(f);for(var b in c){var h=$msg({to:c,jid:g.vid.toVisitorJid(),type:"chat",unload:"unload",content:"cobrowse"}).c("body").t(f).up();q._connection.send(h,!0)}}catch(a){}}}),redhelper.define("application/main",function(){});